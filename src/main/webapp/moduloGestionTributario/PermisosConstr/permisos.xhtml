<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="/WEB-INF/template/template.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:poue="http://primefaces.org/ui/extensions"
                xmlns:dlg="http://xmlns.jcp.org/jsf/composite/dialog">
    <ui:param name="tittle" value="PERMISOS"/>
    <ui:define name="content">
        <div class="ui-g ui-fluid">
            <div class="ui-g-12">


                <!--        id="tab"-->
                <h:form id="mainForm" >
                    <p:tabView id="tvRecaudaciones">
                        <p:ajax event="tabChange" listener="#{permisoView.onChangeTab}"/>
                        <p:tab id="cobroGenerales"  title="Cobros Generales">
                            <div class="ui-g-6">
                                <dlg:consultaPredioGeneral predio="#{permisoView.predio}" id="prediosConsulta"
                                                           consultar="#{permisoView.consultar()}"
                                                           tipoCons="#{permisoView.tipoCons}"
                                                           consultarModel="#{permisoView.validarClaveOtroCanton()}"
                                                           predioModel="#{permisoView.predioModel}"                                                      
                                                           tipo="#{permisoView.esUrbano}"
                                                           update="prediosConsulta,mainForm"/>
                            </div>
                            <div class="ui-g-6">
                                <p:fieldset  legend="Predio #{permisoView.predio.claveCat}" rendered="#{permisoView.predio ne null and permisoView.predio.id ne null}" 
                                             style="font-size: 12px;" >
                                    <p:panelGrid columns="3" layout="grid"  style="text-align: center;"
                                                 columnClasses="ui-g-4, ui-g-4, ui-g-4" styleClass="ui-panelgrid-blank form-group">
                                        <p:panelGrid columns="1" style="width: 100%">
                                            <h:outputText  value="Avaluo ConstrucciÃ³n:" class="FontBold"/>
                                            <h:outputText value="#{permisoView.predio.avaluoConstruccion}">
                                                <f:convertNumber type="currency" currencySymbol="$ " currencyCode="USD" locale="es_EC"/>
                                            </h:outputText>
                                        </p:panelGrid>
                                        <p:panelGrid columns="1" style="width: 100%">
                                            <h:outputText value="Avaluo Solar:" class="FontBold"/>
                                            <h:outputText value="#{permisoView.predio.avaluoSolar}">
                                                <f:convertNumber type="currency" currencySymbol="$ " currencyCode="USD" locale="es_EC"/>
                                            </h:outputText>
                                        </p:panelGrid>
                                        <p:panelGrid columns="1" style="width: 100%">
                                            <h:outputText  value="Avaluo Municipal:" class="FontBold"/>
                                            <h:outputText value="#{permisoView.predio.avaluoMunicipal}">
                                                <f:convertNumber type="currency" currencySymbol="$ " currencyCode="USD" locale="es_EC"/>
                                            </h:outputText>                                    
                                        </p:panelGrid>
                                    </p:panelGrid>
                                </p:fieldset>
                            </div>

                            <p:panelGrid columns="2" layout="grid"
                                         columnClasses="ui-g-6, ui-g-6" styleClass="ui-panelgrid-blank form-group">
                                <p:tree value="#{permisoView.root2}" var="node" draggable="true" 
                                        dynamic="false" skipChildren="true" selectionMode="single" 
                                        selection="#{permisoView.selectedNode}"
                                        filterBy="#{node.nombreTransaccion}" filterMatchMode="contains"
                                        style=" width: 100%; font-weight: bold; overflow: auto; font-size: 13px;">
                                    <p:ajax event="select" listener="#{permisoView.onNodeSelect}" update="mainForm:tvRecaudaciones:dtRubros"/>
                                    <p:treeNode ><h:outputText value="#{node.id}-#{node.nombreTransaccion}" /></p:treeNode>
                                </p:tree>
                                <p:panelGrid columns="1" styleClass="ui-panel-grid-blank">
                                    <p:dataTable id="dtRubros" var="rubro"
                                                 value="#{permisoView.cobrosGenerales.tipoLiquidacion.renRubrosLiquidacionCollection}"
                                                 selectionMode="single" 
                                                 selection="#{permisoView.rubroSelect}" rowKey="#{rubro.id}"
                                                 style="text-align: center;" emptyMessage="Item no posee rubros."
                                                 scrollable="true" scrollHeight="100">
                                        <f:facet name="header">RUBROS POR TITULOS</f:facet>
                                        <p:ajax event="rowSelect" listener="#{permisoView.onRowSelect()}"/>
                                        <p:column headerText="Id" width="5%"> #{rubro.id} </p:column>
                                        <p:column headerText="Descripcion" width="85%" style="text-align: left; font-weight: bold;">#{rubro.descripcion} </p:column>

                                        <p:column headerText="Valor" width="10%"> #{rubro.valor} </p:column>
                                    </p:dataTable>
                                    <p:fieldset id="panelDetalle" legend="DETALLE DE TRANSACCION" style=" height: 200px;">
                                        <p:dataTable id="dtDetalle" var="det" value="#{permisoView.rubrosSeleccionado}" scrollable="true"
                                                     scrollHeight="100" style="text-align: center;"
                                                     rowIndexVar="index" emptyMessage="Sin elementos seleccionados...">
                                            <p:column headerText="Descripcion" width="60%" style="text-align: left;"> #{det.descripcion} </p:column>
                                            <p:column headerText="Cantidad" width="10%"><p:outputLabel value="#{det.cantidad}" /></p:column>
                                            <p:column headerText="Valor" width="10%"><h:outputText value="#{det.valor}">
                                                    <f:convertNumber pattern="#0.00" locale="pt_BR"/>
                                                </h:outputText>
                                            </p:column>
                                            <p:column headerText="Total" width="10%"><h:outputText value="#{det.valorTotal}">
                                                    <f:convertNumber pattern="#0.00" locale="pt_BR"/>
                                                </h:outputText>
                                            </p:column>
                                            <p:column headerText="Accion" width="10%">
                                                <p:commandLink title="Eliminar" update="dtDetalle" actionListener="#{permisoView.deleteRubrosDetalle(index)}">
                                                    <i class="fa fa-fw fa-remove" style="color: red; font-size: 1.5em"></i>
                                                </p:commandLink>
                                            </p:column>
                                        </p:dataTable>
                                        <h:panelGrid columns="2" styleClass="noBorder" style="margin: 0 auto;">
                                            <p:outputLabel value="Valor Total: $" style="font-weight: bold; font-size: 14px;"/>
                                            <p:inputText value="#{permisoView.cobrosGenerales.totalPago}" readonly="true" style="font-weight: bold; font-size: 14px;"/>
                                        </h:panelGrid>
                                    </p:fieldset>
                                    <p:fieldset id="panelInfoAdc" legend="INFORMACION ADICIONAL" style=" height: 280px;" >
                                        <h:panelGrid style="width: 100%;"  styleClass="ui-panelgrid-blank form-group">
                                            <p:panelGrid columns="2" layout="grid" >

                                                <p:inputText value="#{permisoView.ciRucCobros}" placeholder="No. Identificacion"  style="width: auto;" maxlength="10">

                                                </p:inputText>


                                                <p:inputText value="#{permisoView.cobrosGenerales.comprador.apellido}" size="30" 
                                                             readonly="#{not empty permisoView.cobrosGenerales.comprador.id}" 

                                                             placeholder="Apellidos" 
                                                             onkeydown="this.value = this.value.toUpperCase();" />

                                                <p:inputText value="#{permisoView.cobrosGenerales.comprador.nombre}" size="30" 
                                                             readonly="#{not empty permisoView.cobrosGenerales.comprador.id}" 

                                                             placeholder="Nombres" 
                                                             onkeydown="this.value = this.value.toUpperCase();" />

                                                <p:inputText value="#{permisoView.cobrosGenerales.comprador.razonSocial}" size="30" 
                                                             readonly="#{not empty permisoView.cobrosGenerales.comprador.id}" 

                                                             placeholder="Razon Social" 
                                                             onkeydown="this.value = this.value.toUpperCase();" />

                                                <p:inputText value="#{permisoView.cobrosGenerales.comprador.nombreComercial}" size="30" 
                                                             readonly="#{not empty permisoView.cobrosGenerales.comprador.id}" 

                                                             placeholder="Nombre Comercial" 
                                                             onkeydown="this.value = this.value.toUpperCase();" />
                                                <p:column>
                                                    <p:commandButton value="Buscar" process="@this" styleClass="btnStyle" style="font-size: 12px; width: auto;" icon="ui-icon-search" 
                                                                     actionListener="#{permisoView.showDlgEntes(1)}" update="panelInfoAdc"/>
                                                    <p:spacer width="10" />
                                                    <p:commandButton value="Limpiar" style="font-size: 12px; width: auto;" icon="ui-icon-refresh" actionListener="#{permisoView.limpiarDatosContribuyente()}" update="panelInfoAdc"/>
                                                </p:column>
                                            </p:panelGrid>



                                            <p:row>
                                                <p:column colspan="4">
                                                    <p:outputLabel value="Observacion: " style="font-weight: bold; font-size: 14px;"/>
                                                    <p:inputTextarea value="#{permisoView.cobrosGenerales.observacion}" rows="3" style="width: 100%; font-size: 14px; font-weight: bold;"/>
                                                </p:column>
                                            </p:row>
                                            <!--AGREGADO-->
                                            <p:row>
                                                <p:column colspan="4">
                                                    <p:outputLabel value="UbicaciÃ³n: " style="font-weight: bold; font-size: 14px;"/>
                                                </p:column>
                                            </p:row>
                                            <p:row>
                                                <p:column colspan="4"><p:inputTextarea value="#{permisoView.cobrosGenerales.ubicacion}" rows="1" style="width: 100%; font-size: 14px; font-weight: bold;"/></p:column>
                                            </p:row>

                                            <p:row>

                                                <center>
                                                    <br></br>
                                                    <p:commandButton value="Ingresar" styleClass="btnStyle" icon="ui-icon-circle-arrow-e"
                                                                     process="@form" 
                                                                     style="font-size: 13px; width: auto;" 
                                                                     actionListener="#{permisoView.seleccionarLiquidacion()}"/>
                                                </center>

                                            </p:row>
                                        </h:panelGrid>
                                    </p:fieldset>
                                </p:panelGrid>
                            </p:panelGrid>
                        </p:tab>

                        <p:tab id="tituloCredito" title="Titulos de Credito">
                            <p:dataTable id="dtLiquidaciones" reflow="true" paginator="true" lazy="true" rows="10" rowsPerPageTemplate="10,50,100" paginatorPosition="top"
                                         paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {CurrentPageReport} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                         value="#{permisoView.titulosCredito}" var="titulo" emptyMessage="No se encontraron elementos..." style="text-align: center;"
                                         selectionMode="single" rowKey="#{titulo.id}" selection="#{permisoView.liquidacion}" filterEvent="enter">
                                <p:ajax event="rowSelect" update="mainForm:tvRecaudaciones:opLiquidacionesEmitidas"/>
                                <p:column  headerText="id LiquidaciÃ³n" width="50" filterBy="#{titulo.idLiquidacion}" filterStyle="width: 60%;">
                                    <h:outputText value="#{titulo.idLiquidacion}" />
                                </p:column>
                                <p:column  headerText="Liquidacion" width="200"  >
                                    <h:outputText value="#{titulo.tipoLiquidacion.nombreTitulo}" />
                                </p:column>
                                <p:column headerText="No. Liq." width="70" filterBy="#{titulo.numLiquidacion}" sortBy="#{titulo.numLiquidacion}" filterStyle="width: 80%;">
                                    <h:outputText value="#{titulo.numLiquidacion}" />
                                </p:column>
                                <p:column headerText="Anio" width="50" filterBy="#{titulo.anio}" sortBy="#{titulo.anio}" filterStyle="width: 60%;">
                                    <h:outputText value="#{titulo.anio}"/>
                                </p:column>
                                <p:column headerText="Predio" width="200" >
                                    <h:outputText value="#{titulo.predio == null ? titulo.claveCatastralRural: titulo.predio.claveCat }" />
                                </p:column>
                                <p:column headerText="Validador" width="100" >
                                    <h:outputText value="#{titulo.usuarioValida}" />
                                </p:column>
                                <p:column headerText="Fecha emision" width="200" >
                                    <h:outputText value="#{titulo.fechaIngreso}" >
                                        <f:convertDateTime type="date" pattern="dd-MM-yyyy HH:mm"/>
                                    </h:outputText>
                                </p:column>
                                <p:column  headerText="Identificacion" width="100" filterBy="#{titulo.comprador.identificacion}" filterStyle="width: 80%;">
                                    <h:outputText  value="#{titulo.vendedorRuralIdentificacion}" rendered="#{permisoView.renderAlcabalaSolicitante(titulo)}"/>
                                    <h:outputText  value="#{titulo.comprador.identificacion}" rendered="#{!permisoView.renderAlcabalaSolicitante(titulo)}"/>
                                </p:column>
                                <p:column headerText="Solicitante" width="250">
                                    <h:outputText  value="#{titulo.vendedorRural}" rendered="#{permisoView.renderAlcabalaSolicitante(titulo)}"/>
                                    <h:outputText  value="#{titulo.comprador ne null?titulo.comprador.nombreCompleto: (titulo.observacion.contains('|')?titulo.observacion.substring(0,titulo.observacion.indexOf('|')):titulo.nombreComprador)}" rendered="#{!permisoView.renderAlcabalaSolicitante(titulo)}"/>
                                </p:column>

                                <p:column headerText="Valor Emitido" width="60"><h:outputText value="#{titulo.totalPago}" style="font-weight: bold;"/></p:column>                              
                                <p:column headerText="Estado" width="65"><h:outputText value="#{ !titulo.validada ? 'Sin validar' : titulo.estadoLiquidacion.descripcion}" style="font-weight: bold;"/></p:column>
                                <p:column headerText="****" width="65" style="text-align: center;">

                                    <p:commandLink actionListener="#{permisoView.imprimir(titulo)}" title="#{titulo.idLiquidacion}" process="@this" >

                                        <i class="fa fa-fw fa-print" style="font-size: 1.5em;" />
                                    </p:commandLink>
                                </p:column>


                                <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                                    <p:commandButton value="SI" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
                                    <p:commandButton value="NO" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
                                </p:confirmDialog>
                            </p:dataTable>
                            <p:contextMenu id="opLiquidacionesEmitidas" for="dtLiquidaciones" rendered="false">
                                <p:menuitem value="Detalle" icon="ui-icon-comment" oncomplete="PF('dlgDetalle').show();" update="formDetEmision"  process="@this" actionListener="#{permisoView.calculosAdicionales()}"/>
                            </p:contextMenu>

                        </p:tab>
                        <p:tab id="tituloCreditoPagado" title="Titulos de Creditos - Pagados">
                            <p:dataTable id="dtLiquidacionesPagadas" reflow="true" paginator="true" lazy="true" rows="10" rowsPerPageTemplate="10,50,100" paginatorPosition="top"
                                         paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {CurrentPageReport} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                         value="#{permisoView.titulosCreditoPagado}" var="tituloPagado" emptyMessage="No se encontraron elementos..." style="text-align: center;"
                                         selectionMode="single" rowKey="#{tituloPagado.id}" selection="#{permisoView.liquidacion}" filterEvent="enter">
                                <p:ajax event="rowSelect" update="mainForm:tvRecaudaciones:opLiquidacionesPagadas"/>
                                <p:column id="tipoLiquidacionPagada" headerText="Prefijo" width="50" filterBy="#{tituloPagado.tipoLiquidacion.prefijo}" filterStyle="width: 60%;">
                                    <p:outputLabel value="#{tituloPagado.tipoLiquidacion.prefijo}" style="font-weight: bold;"/>
                                </p:column>
                                <p:column headerText="No. Liq." width="70" filterBy="#{tituloPagado.numLiquidacion}" sortBy="#{tituloPagado.numLiquidacion}" filterStyle="width: 80%;">
                                    <p:outputLabel value="#{tituloPagado.numLiquidacion}" style="font-weight: bold;"/>
                                </p:column>
                                <p:column headerText="No. Comprobante" width="100" filterBy="#{tituloPagado.numComprobante}" filterStyle="width: 80%;">
                                    <p:outputLabel value="#{tituloPagado.numComprobante}" style="font-weight: bold;"/>
                                </p:column>
                                <p:column headerText="Anio" width="50" filterBy="#{tituloPagado.anio}" sortBy="#{tituloPagado.anio}" filterStyle="width: 60%;">
                                    <p:outputLabel value="#{tituloPagado.anio}" style="font-weight: bold;"/>
                                </p:column>
                                <!--                        <p:column id="predioPagado" headerText="Predio" width="200">
                                                            <p:outputLabel value="#{tituloPagado.predio.claveCat}" style="font-weight: bold;"/>
                                                        </p:column>-->
                                <p:column id="identificacionPagada" headerText="Identificacion" width="120" filterBy="#{tituloPagado.comprador.identificacion}" filterStyle="width: 80%;">
                                    <p:outputLabel style="font-weight: bold; font-size: 13px;" value="#{tituloPagado.comprador.identificacion}"/>
                                </p:column>
                                <p:column headerText="Solicitante" width="300">
                                    #{tituloPagado.comprador ne null?tituloPagado.comprador.nombreCompleto: (tituloPagado.observacion.contains('|')?tituloPagado.observacion.substring(0,tituloPagado.observacion.indexOf('|')):tituloPagado.nombreComprador)}
                                </p:column>
                                <p:column headerText="Valor" width="75"><p:outputLabel value="#{tituloPagado.totalPago}" style="font-weight: bold;"/></p:column>
                                <p:column headerText="Saldo" width="75"><p:outputLabel value="#{tituloPagado.saldo}" style="font-weight: bold;"/></p:column>
                                <p:column headerText="Estado" width="75"><p:outputLabel value="#{tituloPagado.estadoLiquidacion.descripcion}" style="font-weight: bold;"/></p:column>

                                <!--AGREGADO-->
                                <p:column headerText="Imprimir" width="65" style="text-align: center;">
                                    <p:commandLink actionListener="#{permisoView.imprimir(tituloPagado)}" 
                                                   title="#{titulo.idLiquidacion}" process="@this">
                                        <i class="fa fa-fw fa-print" style="font-size: 1.5em;" />
                                    </p:commandLink>
                                </p:column>
                            </p:dataTable>
                            <p:menuitem value="Detalle Pago" oncomplete="PF('dlgDetallePago').show();" update="formDetPago" icon="ui-icon-calculator" rendered="#{permisoView.liquidacion ne null}" process="@this"/>
                            <p:contextMenu id="opLiquidacionesPagadas" for="dtLiquidacionesPagadas" rendered="false">
                                <p:menuitem value="Detalle" icon="ui-icon-comment" oncomplete="PF('dlgDetalle').show();" update="formDetEmision" rendered="#{permisoView.liquidacion ne null}" process="@this" actionListener="#{permisoView.calculosAdicionales()}"/>
                                <!--<p:menuitem value="Detalle Pago" oncomplete="PF('dlgDetallePago').show();" update="formDetPago" icon="ui-icon-calculator" rendered="#{permisoView.liquidacion ne null}" process="@this"/>-->
                            </p:contextMenu>
                        </p:tab>
                    </p:tabView>
                    <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                        <p:commandButton value="Si" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
                        <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
                    </p:confirmDialog>
                </h:form>


            </div>
        </div>

        <p:dialog widgetVar="dlgReportesRecaudador" header="Reportes Recaudador" resizable="false" modal="true" position="center" height="350">
            <h:form id="reporteRecaudaciones">
                <h:outputText value="Fecha cierre: " style="font-weight: bolder;font-size: 14px"/>
                <p:calendar value="#{permisoView.fechaCierre}" navigator="true"/>
                <p:panelGrid styleClass="noBorder" columns="1" style="width: 100%;text-align: center">
                    <h:outputText value="#{permisoView.tipoReporte eq 1?'Cierre de Caja':permisoView.tipoReporte eq 2?'Recaudaciones Por Transaccion': permisoView.tipoReporte eq 3?'Resumen Cheques':''}" style="font-weight: bolder;font-size: 14px"/>
                    <h:outputText value="Fecha Reporte: " style="font-weight: bolder;font-size: 14px"/>
                    <p:calendar value="#{permisoView.fechaReporte}" mode="inline" />
                    <p:commandButton value="Generar Reporte" icon="ui-icon-print" styleClass="btnStyle" actionListener="#{permisoView.generarReporteCajero()}" style="float: end"/>
                </p:panelGrid>
            </h:form>
        </p:dialog>


        <p:dialog header="Detalle Pago" widgetVar="dlgDetallePago" resizable="false" closeOnEscape="true" modal="true" width="80%" position="center">
            <h:form id="formDetPago">
                <p:panelGrid style="width: 100%;">
                    <p:row>
                        <p:column>
                            <p:outputLabel value="N. Liquidacion"/><br/>
                            <p:outputLabel value="#{permisoView.liquidacion.numLiquidacion}" style="font-weight: bold; font-size: 12px;"/>
                        </p:column>
                        <p:column>
                            <p:outputLabel value="Tipo de Pago"/><br/>
                            <p:outputLabel value="#{permisoView.liquidacion.tipoLiquidacion.prefijo} - #{permisoView.liquidacion.tipoLiquidacion.nombreTitulo}" style="font-weight: bold; font-size: 12px;"/>
                        </p:column>
                        <p:column>
                            <p:outputLabel value="Solicitante"/><br/>
                            <p:outputLabel value="#{permisoView.liquidacion.comprador.identificacion}-#{permisoView.liquidacion.comprador.apellido} #{permisoView.liquidacion.comprador.nombre} #{permisoView.liquidacion.comprador.razonSocial} #{permisoView.liquidacion.comprador.nombreComercial}" style="font-weight: bold; font-size: 12px;"/>
                        </p:column>
                    </p:row>
                </p:panelGrid>
                <center>
                    <p:commandButton value="Aceptar" styleClass="btnStyle" oncomplete="PF('dlgComprobante').hide();" icon="ui-icon-circle-close"/>
                </center>
                <p:outputLabel value="Total a pagar: #{permisoView.liquidacion.totalPago}" style="font-size: 14px; font-weight: bold"/>
                <br/>
<!--                <dialog:detallePago liquidacion="#{permisoView.liquidacion}"/>-->
                <center><p:commandButton value="Aceptar" oncomplete="PF('dlgDetallePago').hide();" styleClass="btnStyle"/></center>
            </h:form>
        </p:dialog>

        <p:dialog header="Detalle Emision" widgetVar="dlgDetalle" resizable="false" closeOnEscape="true" modal="true" width="80%" position="center">
            <h:form id="formDetEmision">
                <dlg:detalleLiquidacion liquidacion="#{permisoView.liquidacion}" mostrarCantidad="true" mostrarObservacion="true" />
                <center><p:commandButton value="Aceptar" oncomplete="PF('dlgDetalle').hide();" styleClass="btnStyle"/></center>
            </h:form>
        </p:dialog>

        <p:dialog widgetVar="dlgSolicitante" header="Contribuyentes" width="800" height="400" resizable="false" closable="true" closeOnEscape="true" modal="true">
            <h:form id="frmSolicitante">
                <div align="right">
                    <p:commandButton id="btnNuevo" value="Refrescar"  icon="fa fa-refresh" style="height: 30px" actionListener="#{permisoView.refrescar()}" >

                    </p:commandButton>
                </div>
                <p:dataTable var="s" value="#{permisoView.solicitantes}" style="width: 100%;text-align: center;" lazy="true"
                             paginator="true" rows="10" filterEvent="enter" paginatorPosition="top"
                             selectionMode="single" selection="#{permisoView.cobrosGenerales.comprador}" rowKey="#{s.id}">
                    <p:column headerText="CI/RUC" sortBy="#{s.identificacion}" width="150" filterBy="#{s.identificacion}" filterStyle="width: 90%;">
                        <h:outputText value="#{s.identificacion}"/>
                    </p:column>

                    <p:column headerText="Apellidos" filterBy="#{s.apellido}" sortBy="#{s.apellido}" filterStyle="width: 95%;">
                        <h:outputText value="#{s.apellido}" style="text-transform: uppercase"/>
                    </p:column>
                    <p:column headerText="Nombres" filterBy="#{s.nombre}" sortBy="#{s.nombre}" filterStyle="width: 95%;">
                        <h:outputText value="#{s.nombre}" style="text-transform: uppercase"/>
                    </p:column>
                    <p:column headerText="Razon Social" filterBy="#{s.razonSocial}" sortBy="#{s.razonSocial}" filterStyle="width: 95%;">
                        <h:outputText value="#{s.razonSocial}" style="text-transform: uppercase"/>
                    </p:column>
                    <f:facet name="footer">
                        <p:commandButton value="Seleccionar" icon="ui-icon-plus" actionListener="#{permisoView.seleccionar()}" style="height: 30px"/>
                    </f:facet>
                </p:dataTable>
            </h:form>
        </p:dialog>

        <p:dialog id="dlgComprobante" widgetVar="dlgComprobante" header="Comprobante de Pago" appendTo="@(body)" width="75%" responsive="true" closable="true" closeOnEscape="true" position="center" modal="true" resizable="false">
            <h:form id="frmComprobante">
                <p:panelGrid style="width: 100%;">
                    <p:row>
                        <p:column>
                            <p:outputLabel value="N. Liquidacion"/><br/>
                            <p:outputLabel value="#{permisoView.liquidacion.numLiquidacion}" style="font-weight: bold; font-size: 12px;"/>
                        </p:column>
                        <p:column>
                            <p:outputLabel value="Tipo de Pago"/><br/>
                            <p:outputLabel value="#{permisoView.liquidacion.tipoLiquidacion.prefijo} - #{permisoView.liquidacion.tipoLiquidacion.nombreTitulo}" style="font-weight: bold; font-size: 12px;"/>
                        </p:column>
                        <p:column>
                            <p:outputLabel value="Solicitante"/><br/>
                            <p:outputLabel value="#{permisoView.liquidacion.comprador.identificacion}-#{permisoView.liquidacion.comprador.apellido} #{permisoView.liquidacion.comprador.nombre} #{permisoView.liquidacion.comprador.razonSocial} #{permisoView.liquidacion.comprador.nombreComercial}" style="font-weight: bold; font-size: 12px;"/>
                        </p:column>
                    </p:row>
                </p:panelGrid>
                <center>
                    <p:commandButton value="Aceptar" styleClass="btnStyle" oncomplete="PF('dlgComprobante').hide();" icon="ui-icon-circle-close"/>
                </center>
            </h:form>
        </p:dialog>

        <p:dialog id="dlgEditContribuyente" widgetVar="dlgEditContribuyente" header="Edicion de Contribuyente" appendTo="@(body)" width="75%" responsive="true" closable="true" closeOnEscape="true" modal="true" resizable="false">
            <h:form id="frmEditContribuyente">
                <p:panelGrid style="width: 100%;">
                    <p:row>
                        <p:column>
                            <p:outputLabel value="N. Liquidacion"/><br/>
                            <p:outputLabel value="#{permisoView.liquidacion.numLiquidacion}" style="font-weight: bold; font-size: 12px;"/>
                        </p:column>
                        <p:column>
                            <p:outputLabel value="N. Comprobante"/><br/>
                            <p:outputLabel value="#{permisoView.liquidacion.numComprobante}" style="font-weight: bold; font-size: 12px;"/>
                        </p:column>
                        <p:column>
                            <p:outputLabel value="Tipo de Pago"/><br/>
                            <p:outputLabel value="#{permisoView.liquidacion.tipoLiquidacion.prefijo} - #{permisoView.liquidacion.tipoLiquidacion.nombreTitulo}" style="font-weight: bold; font-size: 12px;"/>
                        </p:column>
                        <p:column>
                            <p:outputLabel value="Valor"/><br/>
                            <p:outputLabel value="#{permisoView.liquidacion.totalPago}" style="font-weight: bold; font-size: 12px;"/>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column>
                            <p:outputLabel value="SOLICITANTE: " style="font-weight: bold; font-size: 12px;"/>
                        </p:column>
                        <p:column colspan="3">
                            <p:outputLabel value="#{permisoView.liquidacion.comprador.identificacion}-#{permisoView.liquidacion.comprador.apellido} #{permisoView.liquidacion.comprador.nombre} #{permisoView.liquidacion.comprador.razonSocial} #{permisoView.liquidacion.comprador.nombreComercial}" style="font-weight: bold; font-size: 12px;"/>
                            <p:spacer width="15"/>
                            <p:commandButton value="Buscar" oncomplete="PF('dlgSolicitante').show();" update="frmSolicitante"/>
                        </p:column>
                    </p:row>
                </p:panelGrid>
                <br/>
                <center>
                    <p:commandButton value="Guardar Cambios" actionListener="#{permisoView.actualizarLiquidacion()}" oncomplete="PF('dlgEditContribuyente').hide();" styleClass="btnStyle" update="mainForm:tvRecaudaciones:dtLiquidaciones"/>
                    <p:spacer width="25"/>
                    <p:commandButton value="Cancelar" styleClass="btnStyle" oncomplete="PF('dlgEditContribuyente').hide();"/>
                </center>
            </h:form>
        </p:dialog>

        <p:dialog id="dlgAnulacion" widgetVar="dlgAnulacion" header="Anular Liquidacion" appendTo="@(body)" width="75%" responsive="true" closable="true" closeOnEscape="true" position="center" modal="true" resizable="false">
            <h:form id="frmAnulacion">
                <p:panelGrid style="width: 100%;">
                    <p:row>
                        <p:column colspan="4"><p:outputLabel value="DETALLE DEL TITULO DE CREDITO QUE SE VA A ANULAR" style="font-weight: bold; font-size: 12px;"/></p:column>
                    </p:row>
                    <p:row>
                        <p:column>
                            <p:outputLabel value="Liquidacion"/><br/>
                            <p:outputLabel value="#{permisoView.liquidacion.idLiquidacion}" style="font-weight: bold; font-size: 12px;"/>
                        </p:column>
                        <p:column>
                            <p:outputLabel value="Valor"/><br/>
                            <p:outputLabel value="#{permisoView.liquidacion.totalPago}" style="font-weight: bold; font-size: 12px;"/>
                        </p:column>
                        <p:column>
                            <p:outputLabel value="Tipo de Pago"/><br/>
                            <p:outputLabel value="#{permisoView.liquidacion.tipoLiquidacion.prefijo} - #{permisoView.liquidacion.tipoLiquidacion.nombreTitulo}" style="font-weight: bold; font-size: 12px;"/>
                        </p:column>
                        <p:column>
                            <p:outputLabel value="Solicitante"/><br/>
                            <p:outputLabel value="#{permisoView.liquidacion.comprador.identificacion}-#{permisoView.liquidacion.comprador.apellido} #{permisoView.liquidacion.comprador.nombre} #{permisoView.liquidacion.comprador.razonSocial} #{permisoView.liquidacion.comprador.nombreComercial}" style="font-weight: bold; font-size: 12px;"/>
                        </p:column>
                    </p:row>
                </p:panelGrid><br/>
                <center>
                    <p:commandButton value="Anular" styleClass="btnStyle" actionListener="#{permisoView.anularTituloReporte()}" oncomplete="PF('dlgAnulacion').hide();" update="mainForm:tvRecaudaciones:dtLiquidaciones">
                        <p:confirm header="ConfirmaciÃ³n" message="Realizar la anulacion?" icon="ui-icon-alert" />
                    </p:commandButton>
                    <p:spacer width="25"/>
                    <p:commandButton value="Cancelar" styleClass="btnStyle" oncomplete="PF('dlgAnulacion').hide();"/>
                </center>
            </h:form>
        </p:dialog>

        <p:dialog widgetVar="dlgValorRubro" header="Detalle del rubro" resizable="false" modal="true">
            <h:form id="formValores" prependId="false">

                <h:panelGrid styleClass="noBorder" columns="1" id="pngValoresRubro">
                    <h:panelGrid styleClass="noBorder" columns="2" rendered="#{permisoView.rubroSelect.tipoValor.prefijo eq 'SOL' or permisoView.rubroSelect.tipoValor.prefijo eq 'CON'}">
                        <p:outputLabel value="Cantidad:" style="font-weight: bolder;"/>
                        <p:inputText id="cant_rubro" value="#{permisoView.rubroSelect.cantidad}" type="num">
                            <p:ajax event="blur" listener="#{permisoView.encerarValor()}" update="formValores" process="formValores,pngValoresRubro" />
                        </p:inputText>
                    </h:panelGrid>

                    <!--
                   TIPOS DE VALORES PARA OCULTAR
                     SOL (SOLAR)
                     AVA (AVALUO)
                     CON (X CONDOMINIO O DEPARTAMENTO)
                     SBU (VALOR PORCENTUAL AL SBU)                                       
                    -->
                    <h:panelGrid styleClass="noBorder" columns="2" rendered="#{permisoView.rubroSelect.tipoValor.prefijo eq 'AVA'}">
                        <p:outputLabel value="Avaluo:" style="font-weight: bolder;"  />
                        <p:inputText id="avaluo_rubro" value="#{permisoView.rubroSelect.valorCalculo}" type="number">
                            <p:ajax event="blur" listener="#{permisoView.encerarValor()}" update="formValores" process="formValores,pngValoresRubro" />
                        </p:inputText>
                    </h:panelGrid>
                    <h:panelGrid styleClass="noBorder" columns="2" >
                        <p:outputLabel value="AÃ±os:" style="font-weight: bolder;"/>
                        <p:inputText id="anio_d" value="#{permisoView.aniosPublicos}" placeholder="20XX-20XX">
                            <p:ajax event="blur" listener="#{permisoView.encerarValor()}" update="formValores" process="formValores,pngValoresRubro" />
                        </p:inputText>
                    </h:panelGrid>
                    <!--                    <h:panelGrid styleClass="noBorder" columns="2" >
                                            <p:outputLabel value="AÃ±osp:" style="font-weight: bolder;" />
                                            <p:inputText id="anio_h" value="#{permisoView.aniosPrivado}" placeholder="20XX-20XX" >
                                            </p:inputText>
                                        </h:panelGrid>-->
                    <h:panelGrid styleClass="noBorder" columns="2" >
                        <p:outputLabel value="Valor:" style="font-weight: bolder;" />
                        <p:inputText id="valor_rubro" value="#{permisoView.rubroSelect.valor}" readonly="true" >

                        </p:inputText>
                    </h:panelGrid>
                </h:panelGrid>
                <center style="margin-top: 10px; margin-bottom: 10px;">
                    <p:commandButton id="btn_detalle_rubro" value="Aceptar" styleClass="btnStyle" process="formValores,pngValoresRubro"
                                     icon="ui-icon-check" actionListener="#{permisoView.guardaRubro()}" update="mainForm:tvRecaudaciones:panelInfoAdc"/>
                </center>
            </h:form>
        </p:dialog>
        <p:dialog widgetVar="dlgNumeroLiquidacion" header="Codigo de liquidacion generado" resizable="false" modal="true">
            <h:form id="formLiq">

                <h:panelGrid styleClass="noBorder" columns="1" >
                    <p:outputLabel value="#{permisoView.liquidacion.idLiquidacion} " style="font-weight: bold; font-size: 25px; text-align: center;" />
                </h:panelGrid>
                <center>
                    
                    <p:commandButton value="Imprimir" styleClass="btnStyle" style="width: auto;"
                                     actionListener="#{permisoView.imprimir(permisoView.liquidacion)}"/>
                    
                    <p:spacer width="10"/>
                    
                    <p:commandButton value="Cerrar" styleClass="btnStyle"
                                     oncomplete="PF('dlgNumeroLiquidacion').hide();" update=":mainForm"
                                     action="#{permisoView.resetForm()}"/>
                </center>
            </h:form>
        </p:dialog>

        <p:dialog widgetVar="dlgEspeciesDisp" header="Especies Disponibles" resizable="false" modal="true">
            <h:form id="formEspecies">
                <p:panelGrid styleClass="noBorder" columns="4" style="font-size: 16px;">
                    Cantidad:
                    <p:inputNumber value="#{permisoView.rubroSelect.cantidad}" decimalPlaces="0">
                        <p:ajax event="change" update="formEspecies" listener="#{permisoView.updateValoresEspecies()}"/>
                    </p:inputNumber>
                    Disponibles:
                    <p:inputText value="#{permisoView.acta.disponibles}"  readonly="true" style="background-color: #fce1b1"/>
                    Desde:
                    <p:inputText value="#{permisoView.acta.desdeTemp}" readonly="true" style="background-color: #fce1b1"/>
                    Hasta:
                    <p:inputText value="#{permisoView.acta.hastaTemp}" readonly="true" style="background-color: #fce1b1"/>
                    V.Uni.:
                    <p:inputNumber value="#{permisoView.rubroSelect.valor}" decimalPlaces="2"/>
                    V.Total:
                    <p:inputNumber value="#{permisoView.rubroSelect.valorTotal}" decimalPlaces="2"/>
                </p:panelGrid>
                <div align="center">
                    <p:commandButton value="Aceptar" styleClass="btnStyle" icon="ui-icon-check" actionListener="#{permisoView.guardaRubro()}"/>
                </div>
            </h:form>
        </p:dialog>

        <p:dialog header="Seleccionar Predio" widgetVar="selPredio" modal="true" resizable="false" width="700">
            <h:form id="formPredSel">
                <p:dataTable id="dtSelPred" paginator="true" style="text-align: center;" emptyMessage="No se encontro Movimientos" filterEvent="enter"
                             rows="10" value="#{permisoView.propiedades}" var="pl" paginatorPosition="top">
                    <p:column headerText="No Predio" filterBy="#{pl.numPredio}" filterStyle="width: 90%" width="100">
                        <p:outputLabel value="#{pl.numPredio}"/>
                    </p:column>
                    <p:column headerText="Cod. Predial" width="200">
                        <p:outputLabel value="#{pl.codigoPredialCompleto}"/>
                    </p:column>
                    <p:column headerText="Urbanizacion">
                        <p:outputLabel value="#{pl.ciudadela.nombre}"/>
                    </p:column>
                    <p:column headerText="MZ" filterBy="#{pl.urbMz}" width="50" filterStyle="width: 95%" filterMatchMode="exact">
                        <p:outputLabel value="#{pl.urbMz}"/>
                    </p:column>
                    <p:column headerText="SL" filterBy="#{pl.urbSolarnew}" width="50" filterStyle="width: 95%" filterMatchMode="exact">
                        <p:outputLabel value="#{pl.urbSolarnew}"/>
                    </p:column>
                    <p:column headerText="Selec." width="50">
                        <p:commandLink actionListener="#{permisoView.seleccionaPredio(pl)}">
                            <p:graphicImage value="/css/homeIconsImages/ir.png" height="16"/>
                        </p:commandLink>
                    </p:column>
                </p:dataTable>
            </h:form>
        </p:dialog>

        <p:dialog id="dlgNuevoCliente" header="Ingreso de Cliente" widgetVar="dlgNewClient" modal="true" resizable="false" closeOnEscape="false" position="center">
            <h:form  id="formNewClient">
                <p:panelGrid styleClass="noBorder" style="width: 100%">
                    <p:row>
                        <p:column style="text-align: right"><p:outputLabel value="Tipo Persona:" style="font-weight: bolder"/></p:column>
                        <p:column>
                            <p:selectOneMenu value="#{permisoView.tipoEnte}" style="width: 160px;">
                                <f:selectItem itemLabel="Natural" itemValue="1" />
                                <f:selectItem itemLabel="JurÃ­dica" itemValue="2" />
                                <!--                                <f:selectItem itemLabel="Excepcionales" itemValue="3" />-->
                                <p:ajax update="tabNewEnte"/>
                            </p:selectOneMenu>
                        </p:column>
                    </p:row>
                </p:panelGrid>
                <p:tabView id="tabNewEnte" style="width: 520px;height: 400px">
                    <p:tab title="Datos Principales">
                        <p:panelGrid styleClass="noBorder" style="width: 100%">
                            <p:row>
                                <p:column colspan="4">
                                    <p:outputLabel value="NOTA: CAMPOS OBLIGATORIOS (*)" style="font-weight: bolder;color: #0033FF"/>
                                </p:column>
                            </p:row>
                            <p:row rendered="#{permisoView.tipoEnte==3}">
                                <p:column colspan="4">
                                    <p:selectBooleanCheckbox value="#{permisoView.excepcionalEmpresa}" itemLabel="EXCEPCIONALES JURIDICO:" style="float: left; font-weight: bold; font-size: 12px;">
                                        <p:ajax update="tabNewEnte" process="@this"/>
                                    </p:selectBooleanCheckbox>
                                </p:column>
                            </p:row>
                            <p:row>
                                <p:column>
                                    <p:outputLabel value="#{permisoView.tipoEnte==1?'(*)CÃ©dula:':permisoView.tipoEnte==2?'(*)R.U.C.:':permisoView.tipoEnte==3?'(*)IdentificaciÃ³n:':''}" style="font-weight: bolder"/>
                                </p:column>
                                <p:column>
                                    <p:inputText value="#{permisoView.registroEnte.identificacion}" rendered="#{permisoView.tipoEnte==1 or permisoView.tipoEnte==2}">
                                        <p:ajax event="blur" listener="#{permisoView.existeCedula()}" update="formNewClient"/>
                                    </p:inputText>
                                    <p:inputText readonly="true" value="Lo asigna el sistema" disabled="#{permisoView.tipoEnte==3}" rendered="#{permisoView.tipoEnte==3}"/>
                                </p:column>
                                <p:column>
                                    <p:outputLabel value="Fec. Nacimiento:" rendered="#{permisoView.tipoEnte==1 or managedEnte.tipoEnte==3}" style="font-weight: bolder"/>
                                    <p:outputLabel value="Fec. ConstituciÃ³n:" rendered="#{permisoView.tipoEnte==2}" style="font-weight: bolder"/>
                                </p:column>
                                <p:column>
                                    <p:calendar value="#{permisoView.registroEnte.fechaNacimiento}" placeholder="DÃA-MES-AÃO" maxdate="sysdate" pattern="dd-MM-yyyy" mask="true" />
                                </p:column>
                            </p:row>
                            <p:row>
                                <p:column>
                                    <p:outputLabel value="(*)Nombres:" rendered="#{permisoView.tipoEnte==1 or (permisoView.tipoEnte==3 and !permisoView.excepcionalEmpresa)}" style="font-weight: bolder"/>
                                    <p:outputLabel value="(*)RazÃ³n Social:" rendered="#{permisoView.tipoEnte==2 or (permisoView.tipoEnte==3 and permisoView.excepcionalEmpresa)}" style="font-weight: bolder"/>
                                </p:column>
                                <p:column colspan="3">
                                    <p:inputText value="#{permisoView.registroEnte.nombre}" rendered="#{permisoView.tipoEnte==1 or (permisoView.tipoEnte==3 and !permisoView.excepcionalEmpresa)}" style="width: 100%"/>
                                    <p:inputText value="#{permisoView.registroEnte.razonSocial}" rendered="#{permisoView.tipoEnte==2 or (permisoView.tipoEnte==3 and permisoView.excepcionalEmpresa)}" style="width: 100%"/>
                                </p:column>
                            </p:row>
                            <p:row>
                                <p:column>
                                    <p:outputLabel value="(*)Apellidos:" rendered="#{permisoView.tipoEnte==1 or (permisoView.tipoEnte==3 and !permisoView.excepcionalEmpresa)}" style="font-weight: bolder"/>
                                    <p:outputLabel value="Nombre Comercial:" rendered="#{permisoView.tipoEnte==2 or (permisoView.tipoEnte==3 and permisoView.excepcionalEmpresa)}" style="font-weight: bolder"/>
                                </p:column>
                                <p:column colspan="3">
                                    <p:inputText value="#{permisoView.registroEnte.apellido}" rendered="#{permisoView.tipoEnte==1 or (permisoView.tipoEnte==3 and !permisoView.excepcionalEmpresa)}" style="width: 100%"/>
                                    <p:inputText value="#{permisoView.registroEnte.nombreComercial}" rendered="#{permisoView.tipoEnte==2 or (permisoView.tipoEnte==3 and permisoView.excepcionalEmpresa)}" style="width: 100%"/>
                                </p:column>
                            </p:row>
                            <p:row>
                                <p:column>
                                    <p:outputLabel value="DirecciÃ³n:" style="font-weight: bolder"/>
                                </p:column>
                                <p:column colspan="3">
                                    <p:inputText value="#{permisoView.registroEnte.direccion}" style="width: 100%"/>
                                </p:column>
                            </p:row>
                        </p:panelGrid>
                    </p:tab>
                </p:tabView>
                <div align="center">
                    <p:commandButton value="Guardar" icon="ui-icon-disk" actionListener="#{permisoView.guardarEnte()}"/>
                </div>
            </h:form>
        </p:dialog>

        <p:dialog widgetVar="dlgAnular" header="Escribir Observaciones para Anular la Emision"
                  height="500" width="500" responsive="true" closable="true" closeOnEscape="true"
                  modal="true" appendTo="@(body)" >

            <h:form id="frmAnular">
                <p:outputLabel value="Seleccione el Documento a Adjuntar"
                               style="font-size: 18px; font-weight: bold;" />
                <p:fileUpload fileUploadListener="#{permisoView.handleFileDocumentBySave}" dragDropSupport="false"
                              multiple="false" mode="advanced"
                              uploadLabel="Subir" cancelLabel="Cancelar"

                              label="Seleccionar" skinSimple="true"
                              sizeLimit="350000000" sequential="true"
                              allowTypes="/(\.|\/)(pdf|xlsx|docx|xls|doc)$/" />

<!--                <p:dataTable id="dtDocumentosAnexos"  value="#{permisoView.geDocumentosList}" var="pp" reflow="true"
                             paginator="true" rows="5" paginatorPosition="top" style="width: 100%"
                             emptyMessage="No existen documentos Asociados">
                    <p:column headerText="Fecha Creacion">
                        <h:outputText value="#{pp.fechaCreacion}"/>
                    </p:column>
                    <p:column headerText="Descripcion">
                        <h:outputText value="#{pp.nombre}"/>
                    </p:column>
                    <p:column headerText="Tipo Archivo">
                        <h:outputText value="#{pp.descripcion}" />

                    </p:column>
                    <p:column headerText="Accion" style="text-align: center" >

                        <p:commandLink actionListener="#{permisoView.inactivarDocumento(pp)}" update="frmAnular">
                            <p:graphicImage value="/css/homeIconsImages/trash.png"/>
                        </p:commandLink>
                    </p:column>

                </p:dataTable>-->
                <br></br>
                <center>
                    <h:panelGrid columns="8">
                        <p:inputTextarea id="obsservacion21" value="#{permisoView.observacion}"
                                         rows="10" cols="50" style="width: 98%; text-transform: uppercase" />
                    </h:panelGrid>

                    <p:commandButton value="Aceptar"
                                     process="@all" actionListener="#{permisoView.anularLiquidacion()}"  update="mainForm:tvRecaudaciones:dtLiquidaciones"  >
                        <p:confirm header="Confirmacion" message="Esta seguro de anular la liquidacion" icon="ui-icon-alert" />
                    </p:commandButton>
                </center>


            </h:form>
        </p:dialog>




    </ui:define>
</ui:composition>