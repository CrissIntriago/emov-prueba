<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="/WEB-INF/template/template.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:poue="http://primefaces.org/ui/extensions"
                xmlns:dialog="http://xmlns.jcp.org/jsf/composite/dialog"
                xmlns:dlg="http://xmlns.jcp.org/jsf/composite/dialog">
    <ui:param name="tittle" value="CERTIFICADOS"/>
    <ui:define name="content">
        <div class="ui-g ui-fluid">
            <div class="ui-g-12">
                <h:form id="mainForm" prependId="false">
                    <p:fieldset id="reportFilset" legend="** Tipo de certificado **" style="font-size: 14px;  width: 50%; margin: auto;">
                        <p:selectOneMenu value="#{planeamientoUrbMB.tipoPersona}" style="width:425px;  font-weight: bold;" >
                            <f:selectItem itemLabel="NATURAL" itemValue="NATURAL"/>
                            <f:selectItem itemLabel="JURIDICA" itemValue="JURIDICA"/>
                        </p:selectOneMenu>
                        <p:selectOneMenu value="#{planeamientoUrbMB.reporte}" style="width:425px;  font-weight: bold;" filter="true" filterMatchMode="contains">
                            <f:selectItem itemLabel="Seleccione..." itemValue="#{null}" />

                            <f:selectItem itemLabel="1.- ACTUALIZACION DE PERMISO DE CONSTRUCCION CON PLANOS INDUSTRIAL" itemValue="ACTUALIZACION DE PERMISO DE CONSTRUCCION CON PLANOS INDUSTRIAL"/>
                            <f:selectItem itemLabel="2.- ACTUALIZACION DE PERMISO DE CONSTRUCCION CON PLANOS RESIDENCIAL" itemValue="ACTUALIZACION DE PERMISO DE CONSTRUCCION CON PLANOS RESIDENCIAL"/>
                            <f:selectItem itemLabel="3.- APROBACION DE PLANOS INDUSTRIAL" itemValue="APROBACION DE PLANOS INDUSTRIAL"/>
                            <f:selectItem itemLabel="4.- APROBACION DE PLANOS RESIDENCIAL" itemValue="APROBACION DE PLANOS RESIDENCIAL"/>
                            <f:selectItem itemLabel="5.- CERTIFICADO DE AFECTACION" itemValue="CERTIFICADO DE AFECTACION"/>
                            <f:selectItem itemLabel="6.- CERTIFICADO DE INSPECCION FINAL DE OBRA MENOR" itemValue="CERTIFICADO DE INSPECCION FINAL DE OBRA MENOR"/>
                            <f:selectItem itemLabel="7.- CERTIFICADO USO DE SUELO" itemValue="CERTIFICADO USO DE SUELO"/>
                            <f:selectItem itemLabel="8.- COMPRA DE EXCEDENTE" itemValue="COMPRA DE EXCEDENTE"/>
                            <f:selectItem itemLabel="9.- COMPRA DE EXCEDENTE DE PREDIOS INDUSTRIAL" itemValue="COMPRA DE EXCEDENTE DE PREDIOS INDUSTRIAL"/>
                            <f:selectItem itemLabel="10.- CONSULTA DE USO DE SUELO" itemValue="CONSULTA DE USO DE SUELO"/>
                            <f:selectItem itemLabel="11.- FACTIBILIDAD Y PERMISO DE LETREROS Y VALLAS" itemValue="FACTIBILIDAD Y PERMISO DE LETREROS Y VALLAS"/>
                            <f:selectItem itemLabel="12.- FRACCIONAMIENTO DE PREDIO INDUSTRIAL" itemValue="FRACCIONAMIENTO DE PREDIO INDUSTRIAL"/>
                            <f:selectItem itemLabel="13.- FRACCIONAMIENTO DE PREDIO RESIDENCIAL" itemValue="FRACCIONAMIENTO DE PREDIO RESIDENCIAL"/>
                            <f:selectItem itemLabel="14.- INSPECCION FINAL" itemValue="INSPECCION FINAL"/>
                            <f:selectItem itemLabel="15.- INSPECCION FINAL PARA URBANIZACIONES" itemValue="INSPECCION FINAL PARA URBANIZACIONES"/>
                            <f:selectItem itemLabel="16.- LICENCIA URBANISTICA INDUSTRIAL" itemValue="LICENCIA URBANISTICA INDUSTRIAL"/>
                            <f:selectItem itemLabel="17.- LICENCIA URBANISTICA RESIDENCIAL" itemValue="LICENCIA URBANISTICA RESIDENCIAL"/>
                            <f:selectItem itemLabel="18.- LINEA DE FABRICA PARA ANTENAS RADIO BASE O TORRETAS" itemValue="LINEA DE FABRICA PARA ANTENAS RADIO BASE O TORRETAS"/>
                            <f:selectItem itemLabel="19.- MODIFICACION DE PLANOS INDUSTRIAL" itemValue="MODIFICACION DE PLANOS INDUSTRIAL"/>
                            <f:selectItem itemLabel="20.- MODIFICACION DE PLANOS RESIDENCIAL" itemValue="MODIFICACION DE PLANOS RESIDENCIAL"/>
                            <f:selectItem itemLabel="21.- PERMISO DE CONSTRUCCION CON PLANOS INDUSTRIAL" itemValue="PERMISO DE CONSTRUCCION CON PLANOS INDUSTRIAL"/>
                            <f:selectItem itemLabel="22.- PERMISO DE CONSTRUCCION CON PLANOS RESIDENCIAL - BIFAMILIAR JURIDICA" itemValue="PERMISO DE CONSTRUCCION CON PLANOS RESIDENCIAL - BIFAMILIAR JURIDICA"/>
                            <f:selectItem itemLabel="23.- PERMISO DE CONSTRUCCION CON PLANOS RESIDENCIAL" itemValue="PERMISO DE CONSTRUCCION CON PLANOS RESIDENCIAL"/>
                            <f:selectItem itemLabel="24.- PERMISO DE CONSTRUCCION CON PLANOS RESIDENCIAL UNIFAMILIAR" itemValue="PERMISO DE CONSTRUCCION CON PLANOS RESIDENCIAL UNIFAMILIAR"/>
                            <f:selectItem itemLabel="25.- PERMISO DE CONSTRUCCION MENOR" itemValue="PERMISO DE CONSTRUCCION MENOR"/>
                            <f:selectItem itemLabel="26.- PERMISO DE CONSTRUCCION PARA ANTENAS RADIO BASE O TORRETAS" itemValue="PERMISO DE CONSTRUCCION PARA ANTENAS RADIO BASE O TORRETAS"/>
                            <f:selectItem itemLabel="27.- REGISTRO DE SOLAR INDUSTRIAL" itemValue="REGISTRO DE SOLAR INDUSTRIAL"/>
                            <f:selectItem itemLabel="28.- REGISTRO DE SOLAR RESIDENCIAL" itemValue="REGISTRO DE SOLAR RESIDENCIAL"/>                            
                            <f:selectItem itemLabel="29.- REGULARIZACION DE PERMISO DE CONSTRUCCION CON PLANOS EN ZONA INDUSTRIAL" itemValue="REGULARIZACION DE PERMISO DE CONSTRUCCION CON PLANOS EN ZONA INDUSTRIAL"/>
                            <f:selectItem itemLabel="30.- REGULARIZACION DE PERMISO DE CONSTRUCCION CON PLANOS EN ZONA RESIDENCIAL" itemValue="REGULARIZACION DE PERMISO DE CONSTRUCCION CON PLANOS EN ZONA RESIDENCIAL"/>
                            <f:selectItem itemLabel="31.- REGULARIZACION PERMISO CONSTRUCCION CON PLANOS EN ZONA COMERCIAL" itemValue="REGULARIZACION PERMISO CONSTRUCCION CON PLANOS EN ZONA COMERCIAL"/>
                            <f:selectItem itemLabel="32.- REGULARIZACION PERMISO CONSTRUCCION OBRA MENOR" itemValue="REGULARIZACION PERMISO CONSTRUCCION OBRA MENOR"/>
                            <f:selectItem itemLabel="33.- SOLICITUD DE REAVALUO" itemValue="SOLICITUD DE REAVALUO"/>
                            <f:selectItem itemLabel="34 - UNIFICACION DE PREDIO INDUSTRIAL" itemValue="UNIFICACION DE PREDIO INDUSTRIAL"/>
                            <f:selectItem itemLabel="35.- UNIFICACION DE PREDIO RESIDENCIAL" itemValue="UNIFICACION DE PREDIO RESIDENCIAL"/>


                            <p:ajax update="mainForm" process="mainForm" />

                        </p:selectOneMenu>
                        <br/>
                        <br/>
                        <br/>

                        <div class="card">
                            <dialog:consultaCodigoPredial id="consulta" tipoConsulta="#{planeamientoUrbMB.tipoConsulta}"
                                                          changeRadio="#{planeamientoUrbMB.onChangeRadio}"
                                                          updateConsulta="consulta,mainForm"
                                                          predioModel="#{planeamientoUrbMB.predioModel}"
                                                          contribuyenteConsulta="#{planeamientoUrbMB.contribuyenteConsulta}"
                                                          nombreComprador="#{planeamientoUrbMB.nombreContribuyente}"
                                                          identificacion="#{planeamientoUrbMB.identificacion}"
                                                          renderConsultaDirecta="true"
                                                          consultarEmisiones="#{planeamientoUrbMB.consultarEmi()}"
                                                          esUrbano="#{planeamientoUrbMB.tipoBusqueda}"
                                                          updateFrmSolicitante=":frmSolicitante"
                                                          tipoPredio="true"/>    
                            <p:fieldset legend="Datos del predio">
                                <p:panelGrid columns="2" layout="grid" styleClass="ui-panelgrid-blank form-group"
                                             columnClasses="ui-grid-col-4,ui-grid-col-8">
                                    <h:panelGroup>
                                        <p:outputLabel value="DATOS DEL BENEFICIARIO: " style="font-weight: bolder;"/>
                                        <p:spacer width="10"/>
                                        <h:outputText value="#{planeamientoUrbMB.propietario.nombreCompleto}" style="font-family: Times New Roman" />
                                        <br></br><br></br>
                                        <p:outputLabel value="IDENTIFICACIÓN: " style="font-weight: bolder;"/>
                                        <p:spacer width="10"/>
                                        <h:outputText value="#{planeamientoUrbMB.propietario.identificacion}" style="font-family: Times New Roman" />
                                        <br></br><br></br>
                                        <p:outputLabel value="EDAD:" style="font-weight: bolder;"/>
                                        <p:spacer width="10"/>
                                        <p:outputLabel value="#{planeamientoUrbMB.propietario.edad}" style="font-family: Times New Roman"/>
                                        <br></br><br></br>
                                        <p:outputLabel value="FECHA DE NACIMIENTO:" style="font-weight: bolder;"/>
                                        <p:spacer width="10"/>
                                        <h:outputText value="#{planeamientoUrbMB.propietario.fechaNacimiento}" style="font-family: Times New Roman">
                                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                                        </h:outputText>
                                        <br></br><br></br>
                                        <p:outputLabel value="CONDICIÓN CIUDADANA: " style="font-weight: bolder;"/>
                                        <p:spacer width="10"/>
                                        <p:outputLabel value="#{planeamientoUrbMB.propietario.condicionCiudadano eq null?'':planeamientoUrbMB.propietario.condicionCiudadano}" style="font-family: Times New Roman"/>
                                    </h:panelGroup>
                                    <h:panelGroup>

                                        <br></br> 
                                        <p:dataTable id="prediosUrbanos" value="#{planeamientoUrbMB.prediosConsulta}" var="exo" scrollHeight="350" 
                                                     editable="true" editMode="cell"
                                                     rows="20" paginator="true" emptyMessage="No se ha seleccionado ningun elemento" rowIndexVar="index" 
                                                     rowsPerPageTemplate="20,50,100" paginatorPosition="top"
                                                     paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {CurrentPageReport} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}">

                                            <p:column width="2" headerText="***">
                                                <p:rowToggler />
                                            </p:column>
                                            <p:column headerText="Código Unico" width="10"><p:outputLabel value="#{exo.numPredio}"/></p:column> 
                                            <p:column headerText="Clave Predial" width="15"><p:outputLabel value="#{exo.claveCat}"/></p:column>
                                            <p:column headerText="Propietario" width="45"><p:outputLabel value="#{exo.nombrePropietarios}"/></p:column>
                                            <p:column headerText="Avaluo Municipal" width="10" sortBy="#{urbano.avaluoMunicipal}">
                                                <h:outputText value="#{exo.avaluoMunicipal}" style="float: right">
                                                    <f:convertNumber pattern="¤#,##0.00" currencySymbol="" locale="EN_US"/>
                                                </h:outputText>
                                            </p:column>
                                            <p:column headerText="Base Imponible" width="10">
                                                <p:outputLabel value="#{exo.baseImponible}" style="float: right">
                                                    <f:convertNumber pattern="¤#,##0.00" currencySymbol="$" locale="EN_US"/>
                                                </p:outputLabel>
                                            </p:column>

                                            <p:rowExpansion>
                                                <p:dataTable var="i" value="#{planeamientoUrbMB.getLiquidacionesByPredio(exo)}" emptyMessage="No existen deudas" >
                                                    <p:column headerText="AÑO" width="20"><p:outputLabel value="#{i.anio}"/></p:column> 
                                                    <p:column headerText="CONTRIBUYEBTE" width="60"><p:outputLabel value="#{i.nombreComprador}"/></p:column> 
                                                    <p:column headerText="VALOR TITULO" width="10">
                                                        <p:outputLabel value="#{i.totalPago}">
                                                            <f:convertNumber pattern="¤#,##0.00" currencySymbol="$" locale="EN_US"/>
                                                        </p:outputLabel>
                                                    </p:column> 
                                                    <p:column headerText="SALDO" width="10">
                                                        <p:outputLabel value="#{i.saldo}">
                                                            <f:convertNumber pattern="¤#,##0.00" currencySymbol="$" locale="EN_US"/>
                                                        </p:outputLabel>
                                                    </p:column>
                                                </p:dataTable>
                                            </p:rowExpansion>

                                        </p:dataTable>
                                    </h:panelGroup>
                                </p:panelGrid>
                            </p:fieldset>
                        </div>

                        <div class="card">
                            <p:outputLabel value="Solicitante" style="font-weight: bold" /><br/><br/>
                            <p:panelGrid columns="1" layout="grid" styleClass="ui-panelgrid-blank form-group" id="idBeneficiacio">
                                <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                    <p:outputLabel value="Identificación:" style="font-weight: bold"/>
                                    <div class="ui-inputgroup"> 
                                        <p:inputText value="#{planeamientoUrbMB.solicitante.identificacion}" 
                                                     placeholder="Ingrese la Identificación" style="width: 100%" 
                                                     readonly="#{iniciarTramiteVentanillaMB.tramite.solicitante.id ne null}"
                                                     onkeypress="if (event.keyCode == 13) {
                                                                 return false;
                                                             }">
                                        </p:inputText>
                                        <p:spacer width="5" />
                                        <p:commandButton icon="fa fa-search" title="Buscar Solicitante" 
                                                         actionListener="#{planeamientoUrbMB.searchBeneficiario(true)}">
                                            <p:ajax event="dialogReturn" update="idBeneficiacio"
                                                    listener="#{planeamientoUrbMB.selectBeneficiario}"/>
                                        </p:commandButton>
                                        <p:remoteCommand name="buscar" actionListener="#{planeamientoUrbMB.searchBeneficiario(true)}"  />
                                        <p:spacer width="5" />
                                        <p:commandButton  icon="fa fa-trash" update="idBeneficiacio"
                                                          actionListener="#{planeamientoUrbMB.limpiarDatosSolicitante()}" >
                                        </p:commandButton>
                                    </div>
                                </h:panelGroup>
                                <h:panelGroup layout="block" style="width: 100%;" class="panelInput">
                                    <p:outputLabel value="Nombres:" style="font-weight: bold"/>
                                    <p:inputText id="nombre_solicitante" style="width: 100%;" value="#{planeamientoUrbMB.solicitante.nombre}"
                                                 onkeypress="focusNextOnEnter(event, 'razonSocial')" readonly="true"/>
                                </h:panelGroup>
                                <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                    <p:outputLabel value="Apellidos:" style="font-weight: bold"/>
                                    <p:inputText id="apellido_solicitante" style="width: 100%;" value="#{planeamientoUrbMB.solicitante.apellido}"
                                                 onkeypress="focusNextOnEnter(event, 'razonSocial')" readonly="true"/>
                                </h:panelGroup>
                                <h:panelGroup layout="block" style="width: 100%;" class="panelInput" 
                                              rendered="#{planeamientoUrbMB.solicitante.identificacion.length() eq 13}">
                                    <p:outputLabel value="Razon Social:" style="font-weight: bold"/>
                                    <p:inputText id="razonSocial" style="width: 100%;" value="#{planeamientoUrbMB.solicitante.razonSocial}"
                                                 onkeypress="focusNextOnEnter(event, 'razonSocial')" readonly="true"/>
                                </h:panelGroup>
                                <h:panelGroup layout="block" style="width: 100%;" class="panelInput"
                                              rendered="#{planeamientoUrbMB.solicitante.identificacion.length() eq 13}">
                                    <p:outputLabel value="Nombre Comercial:" style="font-weight: bold"/>
                                    <p:inputText id="nombre" style="width: 100%;" value="#{planeamientoUrbMB.solicitante.nombreComercial}"
                                                 onkeypress="focusNextOnEnter(event, 'nombre')" readonly="true"/>
                                </h:panelGroup>
                                <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                    <p:outputLabel value="Dirección:" style="font-weight: bold"/>
                                    <p:inputText id="direccion" style="width: 100%;" value="#{planeamientoUrbMB.solicitante.direccion}"
                                                 onkeypress="focusNextOnEnter(event, 'direccion')"/>
                                </h:panelGroup>
                                <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                    <p:outputLabel value="Correo:" style="font-weight: bold"/>
                                    <p:inputText id="correo" style="width: 100%;" value="#{planeamientoUrbMB.solicitante.email}"
                                                 onkeypress="focusNextOnEnter(event, 'email')"/>
                                </h:panelGroup>
                                <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                    <p:outputLabel value="Teléfono:" style="font-weight: bold"/>
                                    <p:inputText id="telefono" style="width: 100%;" value="#{planeamientoUrbMB.solicitante.celular}"
                                                 onkeypress="focusNextOnEnter(event, 'celular')"/>
                                </h:panelGroup>
                                <h:panelGroup>
                                    <center>
                                        <p:commandButton value="Actualizar" icon="fa fa-refresh" style="width: auto"
                                                         actionListener="#{planeamientoUrbMB.actualizarSolicitante()}"/>
                                    </center>
                                </h:panelGroup>
                            </p:panelGrid>
                        </div>

                        <p:fieldset rendered="#{planeamientoUrbMB.reporte eq 'REGISTRO DE SOLAR INDUSTRIAL' or planeamientoUrbMB.reporte eq 'REGISTRO DE SOLAR RESIDENCIAL'}">                         
                            <p:panelGrid layout="grid" columns="2" styleClass="ui-panelgrid-blank">

                                <p:panelGrid columns="1" layout="grid" style="width: 100%">
                                    <p:outputLabel value="Num. Tramite"/>
                                    <p:inputText value="#{planeamientoUrbMB.numTramite}"/>
                                </p:panelGrid>
                                <p:panelGrid columns="1" layout="grid" style="width: 100%">
                                    <p:outputLabel value="Num Expendiente:"/>
                                    <p:inputText value="#{planeamientoUrbMB.numExpendiente}"/>
                                </p:panelGrid>                              
                                <p:panelGrid columns="1" layout="grid" style="width: 100%">
                                    <p:outputLabel value="Croki" class="FontBold"/>
                                    <p:fileUpload fileUploadListener="#{planeamientoUrbMB.handleFileUploadCroki}"
                                                  multiple="true"
                                                  mode="advanced" 
                                                  update="mainForm"
                                                  uploadLabel="Subir"
                                                  cancelLabel="Cancelar"
                                                  label="Seleccionar"  immediate="true"
                                                  sizeLimit="350000000"
                                                  sequential="true"
                                                  oncomplete="PF('dlgSubida').hide()"
                                                  fileLimit="10" allowTypes="/(\.|\/)(gif|jpe?g|png)$/" />
                                </p:panelGrid>

                                <p:panelGrid columns="1" layout="grid" style="width: 100%">
                                    <p:outputLabel value="Planimetrico" class="FontBold"/>
                                    <p:fileUpload fileUploadListener="#{planeamientoUrbMB.handleFileUploadPlanimetrico}"
                                                  multiple="true"
                                                  mode="advanced" 
                                                  update="mainForm"
                                                  uploadLabel="Subir"
                                                  cancelLabel="Cancelar"
                                                  label="Seleccionar"  immediate="true"
                                                  sizeLimit="350000000"
                                                  sequential="true"
                                                  oncomplete="PF('dlgSubida').hide()"
                                                  fileLimit="10" allowTypes="/(\.|\/)(gif|jpe?g|png)$/" />
                                </p:panelGrid>

                            </p:panelGrid>
                        </p:fieldset>




                        <div class="card">
                            <p:outputLabel value="Observaciones" style="font-weight: bold"/>
                            <p:panelGrid columns="1" layout="grid" styleClass="ui-panelgrid-blank form-group">
                                <h:panelGroup>
                                    <p:inputTextarea id="detalle" style="width: 100%;" value="#{planeamientoUrbMB.observaciones}"
                                                     onkeypress="focusNextOnEnter(event, 'detalle')" readonly="false" rows="5">
                                    </p:inputTextarea>
                                </h:panelGroup>
                            </p:panelGrid>
                            <p:outputLabel value="Conclusiones" style="font-weight: bold"/>
                            <p:panelGrid columns="1" layout="grid" styleClass="ui-panelgrid-blank form-group">
                                <h:panelGroup>
                                    <p:inputTextarea id="conclusiones" style="width: 100%;" value="#{planeamientoUrbMB.conclusiones}"
                                                     onkeypress="focusNextOnEnter(event, 'conclusiones')" readonly="false" rows="5">
                                    </p:inputTextarea>
                                </h:panelGroup>
                            </p:panelGrid>
                        </div>
                        <br/>
                        <br/>
                        <center>

                            <p:commandButton value="Generar PDF" icon="ui-icon-print" styleClass="btnStyle" 
                                             actionListener="#{planeamientoUrbMB.generarReporte(false)}" style="float: end; width: auto;"/>                    
                            <p:spacer width="10" />
                            <p:commandButton value="Generar EXCEL" icon="ui-icon-print" styleClass="btnStyle"  
                                             actionListener="#{planeamientoUrbMB.generarReporte(true)}" style="float: end;width: auto;"/>
                        </center>
                    </p:fieldset>

                    <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                        <p:commandButton value="Si" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
                        <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
                    </p:confirmDialog>
                </h:form>
            </div>
        </div>       


    </ui:define>
</ui:composition>