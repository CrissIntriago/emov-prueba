<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="/WEB-INF/template/template.xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:r="http://primefaces.org/ui"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:comp="http://xmlns.jcp.org/jsf/composite/comp"
                xmlns:dialog="http://xmlns.jcp.org/jsf/composite/dialog"
                xmlns:dlg="http://xmlns.jcp.org/jsf/composite/dialog">
    <ui:define name="content">
        <div class="ui-g ui-fluid">
            <div class="ui-g-12">         
                <div class="car card-w-title" style="background: #00796b;">
                    <comp:ventaComisaria solicitudVentanilla="#{liquidacionInquilinatoMB.solicitud}" task="#{liquidacionInquilinatoMB.tarea}" tramite="#{liquidacionInquilinatoMB.tramite}"/>
                </div>                
                <h:form id="mainForm" prependId="false" >

                    <p:tabView prependId="false">
                        <!--                        <p:ajax event="tabChange" listener="# {liquidacionInquilinatoMB.onTabChange}" />                     -->
                        <p:tab title="Registro" id="id_registro">
                            <div style="width: 51%; margin: auto;" >                        
                                <dialog:consultaPredioGeneral predio="#{liquidacionInquilinatoMB.predio}" id="prediosConsulta"
                                                              consultar="#{liquidacionInquilinatoMB.consultar()}"
                                                              tipoCons="#{liquidacionInquilinatoMB.tipoCons}"                                                      
                                                              tipo="#{liquidacionInquilinatoMB.esUrbano}"
                                                              update="mainForm"/>
                            </div>
                            <br/> <br/>
                            <div style="width: 50%; margin: auto; margin-top: 8%;">
                                <p:fieldset legend="Informacion Adicional" id="datoInfor">
                                    <p:panelGrid columns="3" layout="grid"  styleClass="ui-panelgrid-blank form-group">
                                        <p:panelGrid columns="1">
                                            <p:outputLabel value="Avaluo Municipal: " class="FontBold"/>
                                            <p:inputText style="width: 100%" value="#{liquidacionInquilinatoMB.predio.avaluoMunicipal}" readonly="true">
                                                <f:convertNumber type="currency" currencySymbol="$ " currencyCode="USD" locale="es_EC"/>
                                            </p:inputText>
                                        </p:panelGrid>
                                        <p:panelGrid columns="1">
                                            <p:outputLabel value="Sector Predio: " class="FontBold"/>
                                            <p:selectOneMenu id="listaCatalogos" value="#{liquidacionInquilinatoMB.catalogo}" converter="#{utilConverter}" style="width: 200px;">
                                                <f:selectItem itemLabel="Seleccione" itemValue="#{null}"/>
                                                <f:selectItems value="#{liquidacionInquilinatoMB.listaSecotrPredio}" var="al" itemLabel="#{al.nombre}" itemValue="#{al}"/>
                                                <p:ajax listener="#{liquidacionInquilinatoMB.cargarItmes()}" process="listaCatalogos" update="listaAlquiler"/>
                                            </p:selectOneMenu>
                                        </p:panelGrid>
                                        <p:panelGrid columns="1"  id="listaAlquiler">
                                            <p:outputLabel value="Descripción del alquiler: " class="FontBold"/>
                                            <p:selectOneMenu  value="#{liquidacionInquilinatoMB.comisaria.alquiler}" converter="#{utilConverter}" style="width: 200px;">
                                                <f:selectItem itemLabel="Seleccione" itemValue="#{null}"/>
                                                <f:selectItems value="#{liquidacionInquilinatoMB.listaAlquiler}" var="al" itemLabel="#{al.texto}" itemValue="#{al}"/>
                                            </p:selectOneMenu>
                                        </p:panelGrid>
                                        <p:panelGrid columns="1">
                                            <p:outputLabel value="Año de inquilinato:" class="FontBold"/>
                                            <p:inputText style="width: 100%" value="#{liquidacionInquilinatoMB.comisaria.anioInquilinato}" >
                                                <p:keyFilter mask="num"/>
                                            </p:inputText>
                                        </p:panelGrid>

                                        <h:panelGroup layout="block">
                                            <p:outputLabel value="Cedula: " class="FontBold"/>
                                            <p:inputText id="identificacionComple" style="width: 85%" value="#{liquidacionInquilinatoMB.comisaria.ente.identificacionCompleta}" readonly="true"/>
                                            <p:commandLink  process="@this" update="identificacionComple,nombres,telefono,email,direccion"  
                                                            actionListener="#{liquidacionInquilinatoMB.buscarInquilino()}" style="width: auto;">
                                                <i class="fa fa-search" style="font-size: 1.5em; margin-right: 8px;"></i>
                                            </p:commandLink>
                                        </h:panelGroup>
                                        <p:panelGrid columns="1">
                                            <p:outputLabel  value="Nombres: " class="FontBold"/>
                                            <p:inputText id="nombres" style="width: 100%" value="#{liquidacionInquilinatoMB.comisaria.ente.nombreCompleto}" readonly="true"/>
                                        </p:panelGrid>

                                        <p:panelGrid columns="1">
                                            <p:outputLabel value="Telefono "  class="FontBold"/>
                                            <p:inputText  id="telefono" style="width: 100%" value="#{liquidacionInquilinatoMB.comisaria.ente.telefono}" readonly="true"/>
                                        </p:panelGrid>
                                        <p:panelGrid columns="1">
                                            <p:outputLabel value="Correo: "  class="FontBold"/>
                                            <p:inputText id="email" style="width: 100%" value="#{liquidacionInquilinatoMB.comisaria.ente.email}" readonly="true"/>
                                        </p:panelGrid>
                                        <p:panelGrid columns="1">
                                            <p:outputLabel value="Dirección: "   class="FontBold"/>
                                            <p:inputText id="direccion" style="width: 100%" readonly="true" value="#{liquidacionInquilinatoMB.comisaria.ente.direccion}"/>
                                        </p:panelGrid>
                                    </p:panelGrid>
                                </p:fieldset>




                                <br/>
                                <center>
                                    <p:commandButton  value="Registrar" icon="fa fa-save" style="width: auto;" actionListener="#{liquidacionInquilinatoMB.save()}" update="mainForm"/>    
                                </center>                           

                            </div>
                        </p:tab>
                        <p:tab title="Liquidar" id="liquidacion" >
                            <p:fieldset legend="Liquidación"> 
                                <div style="width: 80%;margin: auto;">
                                    <p:dataTable  expandableRowGroups="true" id="datos" widgetVar="datos" paginatorPosition="bottom" var="liqui"
                                                  value="#{liquidacionInquilinatoMB.detalleLazy}" rows="20" paginator="true" 
                                                  paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                                  currentPageReportTemplate="Mostrando {startRecord}-{endRecord} de {totalRecords}"                                                                                    
                                                  rowsPerPageTemplate="20,25,35,50,100" lazy="true"
                                                  emptyMessage="No existen datos con el criterio de busqueda especificado">

                                        <p:column headerText="Clave Catastral" filterBy="#{liqui.inquilinatoCarpeta.predio.claveCat}" filterMatchMode="exact" style="text-align: center;">
                                            <p:outputLabel value="#{liqui.inquilinatoCarpeta.predio.claveCat}"/>
                                        </p:column>

                                        <p:column headerText="Tipo Predio" filterBy="#{liqui.inquilinatoCarpeta.predio.tipoPredio}" filterMatchMode="exact" width="50" style="text-align: center;">
                                            <p:outputLabel value="#{liqui.inquilinatoCarpeta.predio.tipoPredio}"/>
                                        </p:column>

                                        <p:column headerText="Año" filterBy="#{liqui.anio}" width="50" style="text-align: center;">
                                            <p:outputLabel value="#{liqui.anio}"/>
                                        </p:column>

                                        <p:column headerText="Tipo" filterBy="#{liqui.tipo.nombre}" filterMatchMode="contains" style="text-align: center;">
                                            <p:outputLabel value="#{liqui.tipo.nombre}"/>
                                        </p:column>

                                        <p:column headerText="Detalle" filterBy="#{liqui.observacion}" filterMatchMode="contains" style="text-align: center;">
                                            <p:outputLabel value="#{liqui.observacion}"/>
                                        </p:column>
                                        <p:column headerText="Identificación" filterBy="#{liqui.inquilinatoCarpeta.propietario.identificacionCompleta}" 
                                                  filterMatchMode="contains" style="text-align: center;">
                                            <p:outputLabel value="#{liqui.inquilinatoCarpeta.propietario.identificacionCompleta}"/>
                                        </p:column>
                                        <p:column headerText="Inquilino" filterBy="#{liqui.inquilinatoCarpeta.propietario.nombreCompleto}" filterMatchMode="contains" style="text-align: center;">
                                            <p:outputLabel value="#{liqui.inquilinatoCarpeta.propietario.nombreCompleto}"/>
                                        </p:column>

                                        <p:column headerText="*****" width="150" style="text-align: center;">
                                            <p:commandButton disabled="#{liqui.liquidacion ne null}" icon="fa fa-check" actionListener="#{liquidacionInquilinatoMB.liquidar(liqui)}"/>
                                            <p:spacer width="10"/>
                                            <p:commandButton  icon="fa fa-search" actionListener="#{liquidacionInquilinatoMB.visualizar(liqui.liquidacion)}"/>
                                            <p:spacer width="10"/>
                                            <p:commandButton disabled="#{liqui.liquidacion eq null}"  icon="fa fa-print" actionListener="#{liquidacionInquilinatoMB.imprimir(liqui.liquidacion)}"/>
                                        </p:column>

                                    </p:dataTable>
                                </div>

                            </p:fieldset>
                        </p:tab>


                        <p:tab title="Solcitud Inpescción" id="solicitudInspeccion" rendered="false">
                            <p:fieldset legend="Registrar solicitud"> 
                                <h:panelGroup > 
                                    <div style="margin-top: 30px; margin-bottom: 30px;">
                                        <p:outputLabel value="Solicitud Inspección: " class="FontBold"/> <p:spacer width="10"/>
                                        <p:commandButton process="@this" icon="fa fa-save" value="Generar Solicitud "  oncomplete="PF('dlgoInspeccion').show()" update="fmInpeccion"
                                                         actionListener="#{liquidacionInquilinatoMB.inspeccionNew(null)}" style="width: auto;"/>    
                                    </div>                                   
                                </h:panelGroup>
                                <p:panelGrid layout="grid" columns="2" styleClass="ui-panelgrid-blank form-group">
                                    <p:panelGrid columns="1">
                                        <p:outputLabel value="No. Solcitud" />
                                        <p:inputText readonly="true" value="#{liquidacionInquilinatoMB.inspeccion.noSolicitud}"/>
                                    </p:panelGrid>
                                    <p:panelGrid columns="1">
                                        <p:outputLabel value="Porcentaje de Descuento"/>
                                        <p:selectOneMenu value="#{liquidacionInquilinatoMB.comisaria.porDescuento}">
                                            <f:selectItem itemLabel="Seleccione" itemValue="#{null}"/>
                                            <f:selectItems value="#{liquidacionInquilinatoMB.listaDescuentos}" var="i" itemLabel="#{i.valor}" itemValue="#{i.valor}"/>
                                        </p:selectOneMenu>
                                    </p:panelGrid>                                                                                  
                                </p:panelGrid>   
                                <p:panelGrid columns="1" style="width: 100%" styleClass="ui-panelgrid-blank form-group">
                                    <h:panelGroup>
                                        <p:outputLabel value="Responsable:" class="FontBold"/>                                          
                                        <p:commandLink  process="@this" oncomplete="PF('dlogoServidores').show()" update="fmrServidores"  
                                                        actionListener="#{liquidacionInquilinatoMB.cargarLazyServidor(3)}" style="width: auto;">
                                            <i class="fa fa-search" style="font-size: 1.5em; margin-right: 8px;"></i>
                                        </p:commandLink>
                                    </h:panelGroup>                                            
                                    <p:inputText readonly="true"  id="responsable"
                                                 value="#{liquidacionInquilinatoMB.comisaria.responsableServ eq null?'':liquidacionInquilinatoMB.comisaria.responsableServ.nombreCompleto}"/>
                                </p:panelGrid>
                                <p:panelGrid columns="1" style="width: 100%" styleClass="ui-panelgrid-blank form-group">
                                    <p:outputLabel value="Observación: " class="FontBold" /> 
                                    <p:inputTextarea rows="5" cols="8" value="#{liquidacionInquilinatoMB.comisaria.observacion}" style="width: 100%" />
                                </p:panelGrid>
                            </p:fieldset>
                        </p:tab>

                        <p:tab title="Carpetas" id="consulta" rendered="false">
                            <div style="width: 80%;margin: auto;">
                                <p:dataTable  expandableRowGroups="true" id="dataList" widgetVar="dataList" paginatorPosition="bottom" var="item"
                                              value="#{liquidacionInquilinatoMB.lazy}" rows="20" paginator="true" 
                                              paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                              currentPageReportTemplate="Mostrando {startRecord}-{endRecord} de {totalRecords}"                                                                                    
                                              rowsPerPageTemplate="20,25,35,50,100" lazy="true"

                                              emptyMessage="No existen datos con el criterio de busqueda especificado">
                                    <f:facet name="header">
                                        Inquilinato
                                        <p:commandLink  actionListener="#{liquidacionInquilinatoMB.consultarComisaria()}" update="dataList">
                                            <i class="fa fa-refresh" style="font-size: 1.5em; margin-right: 8px; color: white;"></i>
                                        </p:commandLink>
                                    </f:facet>

                                    <p:ajax event="rowToggle" update="dtDetalleInquilinato" listener="#{liquidacionInquilinatoMB.historialLiquidaciones(item)}"/>
                                    <p:column style="width:2rem">
                                        <p:rowToggler/>
                                    </p:column>

                                    <p:column headerText="Fecha Creaciòn">
                                        <p:outputLabel value="#{item.fechaCrea}">
                                            <f:convertDateTime pattern="yyyy-MM-dd"/>
                                        </p:outputLabel>
                                    </p:column>
                                    <p:column headerText="Clave Catastral" filterBy="#{item.predio.claveCat}" style="text-align: center;">
                                        <p:outputLabel value="#{item.predio.claveCat}"/> 
                                    </p:column>

                                    <p:column headerText="Tipo Predio" filterBy="#{item.predio.tipoPredio}" width="50" style="text-align: center;">
                                        <p:outputLabel value="#{item.predio.tipoPredio}"/> 
                                    </p:column>

                                    <p:column headerText="Identificación" filterBy="#{item.propietario.identificacionCompleta}" style="text-align: center;">
                                        <p:outputLabel value="#{item.propietario.identificacionCompleta}"/> 
                                    </p:column>

                                    <p:column headerText="Inquilino" filterBy="#{item.propietario.nombreCompleto}" style="text-align: center;">
                                        <p:outputLabel value="#{item.propietario.nombreCompleto}"/> 
                                    </p:column>

                                    <p:column headerText="Estado" filterBy="#{item.estado}" style="text-align: center;">
                                        <f:facet name="filter">
                                            <p:selectOneMenu onchange="PF('dataList').filter()" styleClass="custom-filter">
                                                <f:converter converterId="javax.faces.Boolean" />
                                                <f:selectItem itemLabel="Todos" itemValue=""/>
                                                <f:selectItem itemLabel="ACTIVO" itemValue="true" />
                                                <f:selectItem itemLabel="INACTIVO" itemValue="false" />
                                            </p:selectOneMenu>
                                        </f:facet>
                                        <p:outputLabel value="#{item.estado?'ACTIVO':'INACTIVO'}"/> 
                                    </p:column>

                                    <p:column headerText="*****" style="width: 6%;">
                                        <p:commandButton icon="fa fa-edit" />
                                    </p:column>

                                    <p:rowExpansion >
                                        <p:dataTable id="dtDetalleInquilinato"  
                                                     value="#{liquidacionInquilinatoMB.historialInquilinato}" 
                                                     style="width: 100%;"
                                                     var="hi" rows="5" 
                                                     paginator="true" paginatorPosition="top"
                                                     currentPageReportTemplate="Mostrando {startRecord}-{endRecord} de {totalRecords}"
                                                     paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                                     widgetVar="dtDetalleInquilinato">
                                            <f:facet name="header">
                                                Historico
                                            </f:facet>


                                            <p:column headerText="Año" filterBy="#{hi.anio}" width="50" style="text-align: center;">
                                                <p:outputLabel value="#{hi.anio}"/>
                                            </p:column>

                                            <p:column headerText="Detalle" filterBy="#{hi.observacion}" filterMatchMode="contains" style="text-align: center;">
                                                <p:outputLabel value="#{hi.observacion}"/>
                                            </p:column>

                                            <p:column headerText="Estado" filterBy="#{hi.liquidacion.estadoLiquidacion.descripcion}" filterMatchMode="contains" style="text-align: center;">
                                                <p:outputLabel value="#{hi.liquidacion.estadoLiquidacion.descripcion}"/>
                                            </p:column>

                                            <p:column headerText="*****" width="150" style="text-align: center;">
                                                <p:commandButton disabled="#{hi.liquidacion ne null}" icon="fa fa-check" actionListener="#{liquidacionInquilinatoMB.liquidar(hi)}"/>
                                                <p:spacer width="10"/>
                                                <p:commandButton  icon="fa fa-search" actionListener="#{liquidacionInquilinatoMB.visualizar(hi.liquidacion)}"/>
                                                <p:spacer width="10"/>
                                                <p:commandButton disabled="#{hi.liquidacion eq null}"  icon="fa fa-print" actionListener="#{liquidacionInquilinatoMB.imprimir(hi.liquidacion)}"/>
                                            </p:column>

                                        </p:dataTable>
                                    </p:rowExpansion>
                                </p:dataTable>
                            </div>




                        </p:tab>
                    </p:tabView>         
                </h:form>
            </div>
        </div>

        <p:dialog id="dlgoInspeccion" widgetVar="dlgoInspeccion"  position="center" draggable="false" header="Formulario de Inspección " width="600"
                  modal="true" showEffect="fade" hideEffect="fade" resizable="false" height="550" >
            <h:form id="fmInpeccion" prependId="false">
                <center>
                    <h2 style="font-weight: bold; color: blue;">No.Predio: #{liquidacionInquilinatoMB.predio.numPredio}</h2>
                    <hr style="color: blue; background: blue;"/>
                </center>                
                <p:panelGrid columns="2" styleClass="ui-panelgrid-blank form-group" layout="grid">
                    <p:panelGrid columns="1" style="width: 100%">
                        <p:outputLabel value="Tipo Predio:" class="FontBold"/>
                        <p:inputText  required="true" style="width: 100%;" value="#{liquidacionInquilinatoMB.predio.tipoPredio eq null?'':(liquidacionInquilinatoMB.predio.tipoPredio eq 'U'?'URBABNO':'RURAL')}" 
                                      readonly="true"/>
                    </p:panelGrid>
                    <p:panelGrid columns="1" style="width: 100%">
                        <p:outputLabel value="Clave Catastral:" class="FontBold"/>
                        <p:inputText required="true" style="width: 100%;" value="#{liquidacionInquilinatoMB.predio.claveCat}" readonly="true"/>
                    </p:panelGrid>

                    <p:panelGrid columns="1" style="width: 100%">
                        <p:outputLabel value="Fecha:" class="FontBold"/>
                        <p:calendar value="#{liquidacionInquilinatoMB.inspeccion.fecha}" navigator="true" locale="es"/>
                    </p:panelGrid>
                    <p:panelGrid columns="1" style="width: 100%">
                        <p:outputLabel value="Hora:" class="FontBold"/>
                        <p:calendar value="#{liquidacionInquilinatoMB.inspeccion.hora}" pattern="HH:MM" locale="es"/>
                    </p:panelGrid>   


                    <p:panelGrid columns="1" style="width: 100%">
                        <p:outputLabel value="Delegado de Inpección:" class="FontBold"/>   
                        <h:panelGroup>
                            <p:inputText required="true" style="width: 80%;" value="#{liquidacionInquilinatoMB.inspeccion.delegado.nombreCompleto}"/>
                            <p:commandLink process="@this" oncomplete="PF('dlogoServidores').show()" update="fmrServidores"  actionListener="#{liquidacionInquilinatoMB.cargarLazyServidor(2)}" style="width: auto;">
                                <i class="fa fa-search" style="font-size: 1.5em; margin-right: 8px;"></i>
                            </p:commandLink>
                        </h:panelGroup>
                    </p:panelGrid>
                    <p:panelGrid columns="1" style="width: 100%">
                        <p:outputLabel value="Comisario:" class="FontBold"/>
                        <h:panelGroup>
                            <p:inputText required="true" style="width: 80%;" value="#{liquidacionInquilinatoMB.inspeccion.comisario.persona.nombreCompleto}"/>
                            <p:commandLink  process="@this" oncomplete="PF('dlogoServidores').show()" update="fmrServidores"  actionListener="#{liquidacionInquilinatoMB.cargarLazyServidor(1)}" style="width: auto;">
                                <i class="fa fa-search" style="font-size: 1.5em; margin-right: 8px;"></i>
                            </p:commandLink>
                        </h:panelGroup>
                    </p:panelGrid>
                </p:panelGrid>
                <p:panelGrid columns="1" styleClass="ui-panelgrid-blank form-group" layout="grid">

                    <p:panelGrid columns="1" style="width: 100%">
                        <p:outputLabel value="Lugar:" class="FontBold"/>
                        <p:inputText value="#{liquidacionInquilinatoMB.inspeccion.lugar}" style="width: 100%;"/>
                    </p:panelGrid>
                </p:panelGrid>
                <p:panelGrid columns="2" styleClass="ui-panelgrid-blank form-group" layout="grid">

                    <p:panelGrid columns="1" style="width: 100%">
                        <p:outputLabel value="Motivo:" class="FontBold"/>                    
                        <p:inputTextarea required="true" rows="5" cols="8" value="#{liquidacionInquilinatoMB.inspeccion.motivo}" style="width: 100%;"/>
                    </p:panelGrid>
                    <p:panelGrid columns="1" style="width: 100%">
                        <p:outputLabel value="Observación:" class="FontBold"/>
                        <p:inputTextarea required="true" rows="5" cols="8" value="#{liquidacionInquilinatoMB.inspeccion.observacion}" style="width: 100%;"/>
                    </p:panelGrid>

                </p:panelGrid>
                <br/>
                <center>
                    <p:commandButton value="Registrar" icon="fa fa-save" style="width: auto;" update="fmInpeccion"  actionListener="#{liquidacionInquilinatoMB.saveInspeccion()}"/>
                </center>
            </h:form>           
        </p:dialog>
        <p:dialog id="dlogoServidores" widgetVar="dlogoServidores" width="50%" position="center" draggable="false" header="Formulario de Inspección"
                  modal="true" showEffect="fade" hideEffect="fade" resizable="false" >
            <h:form id="fmrServidores" prependId="false">
                <p:dataTable  expandableRowGroups="true" id="dataServidores" widgetVar="dataServidores" paginatorPosition="bottom" var="servidor"
                              value="#{liquidacionInquilinatoMB.lazyServidor}" rows="20" paginator="true" 
                              paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                              currentPageReportTemplate="Mostrando {startRecord}-{endRecord} de {totalRecords}"                                                                                    
                              rowsPerPageTemplate="20,25,35,50,100" lazy="true"
                              emptyMessage="No existen datos con el criterio de busqueda especificado">
                    <f:facet name="header">
                        Servidores                      
                    </f:facet>
                    <p:column headerText="Indentificación" width="100" filterBy="#{servidor.persona.identificacionCompleta}" filterMatchMode="contains">
                        <center>
                            <h:outputText value="#{servidor.persona.identificacionCompleta}"/>
                        </center>
                    </p:column>
                    <p:column headerText="Nombres" filterBy="#{servidor.persona.nombreCompleto}" filterMatchMode="contains">
                        <h:outputText value="#{servidor.persona.nombreCompleto}"/>
                    </p:column>
                    <p:column headerText="*****" width="50">
                        <center>
                            <p:commandButton icon="fa fa-check" actionListener="#{liquidacionInquilinatoMB.seleccionar(servidor)}" update="fmInpeccion,fmrServidores,mainForm" 
                                             oncomplete="PF('dlogoServidores').hide()" />
                        </center>
                    </p:column>
                </p:dataTable>
            </h:form>
        </p:dialog>

        <p:dialog id="dlogoNumSolcitud" widgetVar="dlogoNumSolcitud" width="20%" position="center" draggable="false" header="Formulario de Inspección"
                  modal="true" showEffect="fade" hideEffect="fade" resizable="false">
            <h:form id="fmNumSolicitud" prependId="false">
                <center>
                    <h:outputText value="SOLICITUD : #{liquidacionInquilinatoMB.inspeccion.noSolicitud}" style="font-size: 20px;font-weight: bold;color: blue;"/>
                    <br/><br/>
                    <p:commandButton value="Aceptar" actionListener="#{liquidacionInquilinatoMB.closeDialogos()}" style="width: auto; margin-top: 3%;"  update="mainForm"/>
                </center>
            </h:form>
        </p:dialog>

        <p:dialog id="dlogovisulizacion" widgetVar="dlogovisulizacion" width="50%" position="center" draggable="false" header="Visualización"
                  modal="true" showEffect="fade" hideEffect="fade" resizable="false">
            <h:form id="frmVisualizaiion" prependId="false">
                <p:fieldset legend="Predio"> 
                    <p:panelGrid columns="3" columnClasses="ui-g-4, ui-g-4, ui-g-4" layout="grid" styleClass="ui-panelgrid-blank">
                        <p:panelGrid columns="1" style="width: 100%;">
                            <p:outputLabel value="Clave Catastral: " class="FontBold"/>
                            <p:inputText value="#{liquidacionInquilinatoMB.comisaria.numPredio}" style="width: 100%;" readonly="true"/>
                        </p:panelGrid>   
                        <p:panelGrid columns="1" style="width: 100%;">
                            <p:outputLabel value="No.Predio:" class="FontBold"/>
                            <p:inputText value="#{liquidacionInquilinatoMB.comisaria.clavePreial}" style="width: 100%;" readonly="true"/>
                        </p:panelGrid>   
                        <p:panelGrid columns="1" style="width: 100%;">
                            <p:outputLabel value="Avaluo Muinipal: " class="FontBold"/>
                            <p:inputText value="#{liquidacionInquilinatoMB.comisaria.avaluoMunicipal}" style="width: 100%;" readonly="true">
                                <f:convertNumber type="currency" currencySymbol="$ " currencyCode="USD" locale="es_EC"/>
                            </p:inputText>
                        </p:panelGrid>                          
                    </p:panelGrid>
                </p:fieldset>
                <p:fieldset legend="Información Adicional:">
                    <p:panelGrid columns="4" layout="grid" styleClass="ui-panelgrid-blank">
                        <p:panelGrid columns="1" style="width: 100%;">
                            <p:outputLabel value="Nombres: " class="FontBold"/>
                            <p:inputText value="#{liquidacionInquilinatoMB.comisaria.ente.nombre}" style="width: 100%;" readonly="true"/>
                        </p:panelGrid>
                        <p:panelGrid columns="1" style="width: 100%;">
                            <p:outputLabel value="Apellidos: " class="FontBold"/>
                            <p:inputText value="#{liquidacionInquilinatoMB.comisaria.ente.apellido}" style="width: 100%;" readonly="true"/>
                        </p:panelGrid>
                        <p:panelGrid columns="1" style="width: 100%;">
                            <p:outputLabel value="Descripción Alquiler: " class="FontBold"/>
                            <p:inputText value="#{liquidacionInquilinatoMB.comisaria.alquiler.texto.toUpperCase()}" style="width: 100%;" readonly="true"/>
                        </p:panelGrid>
                        <p:panelGrid columns="1" style="width: 100%;">
                            <p:outputLabel value="Año Inquilinato: " class="FontBold"/>
                            <p:inputText value="#{liquidacionInquilinatoMB.comisaria.anioInquilinato}" style="width: 100%;" readonly="true"/>
                        </p:panelGrid>
                    </p:panelGrid>
                </p:fieldset>
                <!--rendered="# {liquidacionInquilinatoMB.comisaria.inspeccion ne null}"-->
                <p:fieldset legend="solicitud de Inspección NO. #{liquidacionInquilinatoMB.comisaria.inspeccion.noSolicitud}" rendered="#{liquidacionInquilinatoMB.comisaria.inspeccion ne null}"  >
                    <p:panelGrid columns="2" columnClasses="ui-g-6,ui-g-6" layout="grid" styleClass="ui-panelgrid-blank">                       
                        <p:panelGrid columns="1" style="width: 100%;"> 
                            <p:outputLabel value="Motivo: " class="FontBold"/>
                            <p:inputText value="#{liquidacionInquilinatoMB.comisaria.inspeccion.motivo}" style="width: 100%;" readonly="true"/>
                        </p:panelGrid >
                        <p:panelGrid columns="1" style="width: 100%;">
                            <p:outputLabel value="Comisario: " class="FontBold"/>
                            <p:inputText value="#{liquidacionInquilinatoMB.comisaria.inspeccion.comisario.persona.nombreCompleto}" style="width: 100%;" readonly="true"/>
                        </p:panelGrid>
                        <p:panelGrid columns="1" style="width: 100%;">
                            <p:outputLabel value="Delegado: " class="FontBold"/>
                            <p:inputText value="#{liquidacionInquilinatoMB.comisaria.inspeccion.delegado.nombreCompleto}" style="width: 100%;" readonly="true"/>
                        </p:panelGrid>
                        <p:panelGrid columns="1" style="width: 100%;">
                            <p:outputLabel value="Observación: " class="FontBold"/>
                            <p:inputText value="#{liquidacionInquilinatoMB.comisaria.inspeccion.observacion}" style="width: 100%;" readonly="true"/>
                        </p:panelGrid>
                    </p:panelGrid>
                </p:fieldset>

                <center>
                    <p:commandButton value="Aceptar" oncomplete="PF('dlogovisulizacion').hide()" style="width: auto; margin-top: 3%;"  update="frmVisualizaiion"/>
                </center>
            </h:form>
        </p:dialog>





        <p:dialog widgetVar="dlgSolicitante" header="LISTADO DE CONTRIBUYENTES" appendTo="@(body)" width="70%" responsive="true" closable="true" closeOnEscape="true" modal="true" position="center">
            <h:form id="frmSolicitante">

                <div align="right">
                    <p:commandButton title="Nuevo" actionListener="#{liquidacionInquilinatoMB.nuevoCliente()}"  value="Nuevo" icon="fa fa-plus"/>

                </div>

                <div align="center">
                    <p:dataTable var="s" value="#{liquidacionInquilinatoMB.lazyCliente}" style="width: 98%;text-align: center;" lazy="true" 
                                 paginator="true" rows="10" filterEvent="enter" paginatorPosition="top"
                                 selection="#{liquidacionInquilinatoMB.clienteSeleccion}" rowKey="#{s.id}">
                        <p:ajax event="rowSelect" update="frmSolicitante:btnSeleccionar" />
                        <p:ajax event="rowUnselect"  update="frmSolicitante:btnSeleccionar" />
                        <p:ajax event="rowSelectRadio"  update="frmSolicitante:btnSeleccionar" />
                        <p:column headerText="*" selectionMode="single" style="width:30px;text-align:center" />
                        <p:column headerText="CI/RUC" width="150" filterBy="#{s.identificacionCompleta}" filterStyle="width: 90%;">
                            <h:outputText value="#{s.identificacionCompleta}"/>
                        </p:column>
                        <p:column headerText="Nombres" filterBy="#{s.nombreCompleto}"  filterStyle="width: 95%;">
                            <h:outputText value="#{s.nombreCompleto}" style="text-transform: uppercase"/>
                        </p:column>
                        <p:column headerText="Razon Social" filterBy="#{s.razonSocial}" sortBy="#{s.razonSocial}" filterStyle="width: 95%;">
                            <h:outputText value="#{s.razonSocial}" style="text-transform: uppercase"/>
                        </p:column>
                    </p:dataTable> 
                </div>
                <br></br>
                <center>
                    <p:commandButton id="btnSeleccionar" value="Seleccionar" icon="ui-icon-plus" actionListener="#{liquidacionInquilinatoMB.seleccionar()}"
                                     style="height: 30px" update="mainForm"/>
                </center>
            </h:form>
        </p:dialog>

        <p:dialog widgetVar="dlgLiquidacion" id="dlgLiquidacion" header="LIQUIDACIÓN DE INQUILINATO" width="70%" responsive="true" closable="true" closeOnEscape="true" modal="true" position="center">
            <h:form id="formDialogoLiquidacion" prependId="false">
                <p:panelGrid columns="2" columnClasses="ui-panelgrid-blank" layout="grid" style="width: 100%;">
                    <p:fieldset legend="Información">
                        <p:panelGrid columns="2" layout="grid" style="width: 100%;">
                            <p:panelGrid columns="1" style="width: 100%;">
                                <p:outputLabel value="Predio:" class="FontBold"/>
                                <p:inputText readonly="true" value="#{liquidacionInquilinatoMB.liquidacion.predio.claveCat}" style="width: 100%;"/>
                            </p:panelGrid>
                            <p:panelGrid columns="1" style="width: 100%;">
                                <p:outputLabel value="Tipo Predio:" class="FontBold"/>
                                <p:inputText readonly="true" value="#{liquidacionInquilinatoMB.liquidacion.predio.tipoPredio}" style="width: 100%;"/>
                            </p:panelGrid>
                            <p:panelGrid columns="1" style="width: 100%;">
                                <p:outputLabel value="Avaluo:" class="FontBold"/>
                                <p:inputText readonly="true" value="#{liquidacionInquilinatoMB.liquidacion.predio.avaluoMunicipal}" style="width: 100%;"/>
                            </p:panelGrid>
                            <p:panelGrid columns="1" style="width: 100%;">
                                <p:outputLabel value="Indentificación:" class="FontBold"/>
                                <p:inputText readonly="true" value="#{liquidacionInquilinatoMB.liquidacion.comprador.identificacionCompleta}" style="width: 100%;"/>
                            </p:panelGrid>

                            <p:panelGrid columns="1" style="width: 100%;">
                                <p:outputLabel value="Contribuyente:" class="FontBold"/>
                                <p:inputText value="#{liquidacionInquilinatoMB.liquidacion.comprador.nombreCompleto}" style="width: 100%;"/>
                            </p:panelGrid>
                        </p:panelGrid>
                        <p:panelGrid columns="1" columnClasses="ui-panelgrid-blank" layout="grid" style="width: 100%;">
                            <p:outputLabel value="Observación:" class="FontBold"/>
                            <p:inputTextarea rows="5" cols="12" value="#{liquidacionInquilinatoMB.liquidacion.observacion}" style="width: 100%"/>
                        </p:panelGrid>

                    </p:fieldset>
                    <p:fieldset legend="Rubros">
                        <center> <h2>Año de Inquilinitao - #{liquidacionInquilinatoMB.liquidacion.anio}</h2></center>
                        <br/>
                        <p:dataTable  id="dtRubros" widgetVar="dtRubros" reflow="true" value="#{liquidacionInquilinatoMB.rubros}"  
                                      var="itemrubros" rowIndexVar="indice" style="width: 100%;margin: auto;"  editable="true" editMode="cell">
                            <p:column headerText="Seleccionar" width="10%">
                                <center>     
                                    <p:selectBooleanCheckbox value="#{itemrubros.cobrar}">
                                        <p:ajax listener="#{liquidacionInquilinatoMB.calcularPago()}" 
                                                update="dtRubros,totalLiquidacion"/>
                                    </p:selectBooleanCheckbox>
                                </center>
                            </p:column>
                            <p:column headerText="Descripción" >
                                <h:outputText value="#{itemrubros.descripcion}" />
                            </p:column>
                            <p:column headerText="Valor" style="width: 20%; text-align: right">
                                <p:cellEditor disabled="true">
                                    <f:facet name="input">
                                        <p:inputNumber value="#{itemrubros.valorCalculo}">

                                        </p:inputNumber>
                                    </f:facet>
                                    <f:facet name="output">
                                        <h:outputText value="#{itemrubros.valorCalculo}">                                                    
                                            <f:convertNumber pattern="#0.00" locale="pt_BR"/>
                                        </h:outputText>
                                    </f:facet>
                                </p:cellEditor>                                  
                            </p:column>
                        </p:dataTable> 
                        <h:panelGroup layout="block">
                            <div align="right">
                                <h:outputText  value="Total a cancelar: " style="font-weight: bold;" />
                                <p:outputLabel  value=" " style="font-weight: bold; font-size: 14px;font-weight: bold;"/>
                                <p:inputText id="totalLiquidacion" value="#{liquidacionInquilinatoMB.liquidacion.totalPago}"
                                             readonly="true" style="width: auto; text-align: right;font-size: 14px;background: yellow;font-weight: bold;">
                                    <f:convertNumber maxFractionDigits="2"  minFractionDigits="2" />                                            
                                </p:inputText>
                            </div>
                        </h:panelGroup>
                    </p:fieldset>
                </p:panelGrid>

                <center>
                    <p:commandButton value="Generar" style="width: auto;" icon="fa fa-save" actionListener="#{liquidacionInquilinatoMB.generarLiquidacion()}"/>
                    <p:spacer width="10"/> 
                    <p:commandButton value="Cancelar" style="width: auto;background: red;" icon="fa fa-close" oncomplete="PF('dlgLiquidacion').hide()"
                                     update="formDialogoLiquidacion"/>
                </center>

            </h:form>
        </p:dialog>

        <p:dialog widgetVar="dlgNumeroLiquidacion" header="Codigo de liquidacion generado" resizable="false" modal="true">
            <h:form id="formLiq">

                <h:panelGrid styleClass="noBorder" columns="1" >
                    <p:outputLabel value="#{liquidacionInquilinatoMB.liquidacion.idLiquidacion} " style="font-weight: bold; font-size: 25px; text-align: center;" />
                </h:panelGrid>

                <center>
                    <p:commandButton value="Imprimir" styleClass="btnStyle" actionListener="#{liquidacionInquilinatoMB.imprimir(liquidacionInquilinatoMB.liquidacion)}" update="mainForm"/>
                    <p:spacer width="10"/>
                    <p:commandButton value="Subir Documento" oncomplete="PF('dlogoTitulo').show()" update="formTitulo" style="width: auto; margin-top: 3%;" />
                    <p:spacer width="10"/>
                    <p:commandButton value="Aceptar" actionListener="#{liquidacionInquilinatoMB.opendlg()}"  style="width: auto; margin-top: 3%;" 
                                     update="frmDlgObser"/>
                </center>
            </h:form>
        </p:dialog>


        <p:dialog id="dlogoTitulo" widgetVar="dlogoTitulo" width="30%" position="center" draggable="false" header="Subir Documento(Titulo Emitido)"
                  modal="true" showEffect="fade" hideEffect="fade" resizable="false">
            <h:form id="formTitulo" prependId="false">
                <p:fileUpload fileUploadListener="#{liquidacionInquilinatoMB.handleFileUpload}"  style="width: 100%" 
                              accept=".pdf" skinSimple="true" allowTypes="/(\.|\/)(pdf)$/i" mode="advanced" dragDropSupport="false" 
                              label="Buscar" uploadLabel="Subir" cancelLabel="Cancelar" previewWidth="60"  
                              update="mainForm"/>
            </h:form>
        </p:dialog>

        <p:dialog header="Detalle Emision" widgetVar="dlgDetalle" resizable="false" closeOnEscape="true" modal="true" width="80%" position="center">
            <h:form id="formDetEmision">
                <dialog:detalleLiquidacion liquidacion="#{liquidacionInquilinatoMB.liquidacion}" mostrarCantidad="true" mostrarObservacion="true" />
                <center><p:commandButton value="Aceptar" oncomplete="PF('dlgDetalle').hide();" styleClass="btnStyle"/></center>
            </h:form>
        </p:dialog>

        <p:dialog id="dlgObservaciones" widgetVar="dlgObservaciones" width="25%" position="center" draggable="false" header="Observación" height="150"
                  modal="true" showEffect="fade" hideEffect="fade" resizable="false" >
            <h:form id="frmDlgObser" prependId="false">
                <p:outputPanel id="panelObsevacion" style="width: 100%;" >
                    <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                        <p:inputTextarea value="#{liquidacionInquilinatoMB.observacion.observacion}" onkeyup="toUpperCase(this)" rows="7" style="border: 1px solid;border-color: blue;text-transform: uppercase;width: 100%;border-radius: 5px 5px 5px 5px;"/>
                    </h:panelGroup> 
                    <center>
                        <p:commandButton icon="fa fa-check" value="Aceptar"  title="Culminar Tarea" process="frmDlgObser" update="frmDlgObser"
                                         actionListener="#{liquidacionInquilinatoMB.completarTarea()}" style="background:green;width: 100px;margin: 10px"  />
                        <p:commandButton icon="fa fa-close" value="Cerrar" onclick="PF('dlgObservaciones').hide()"
                                         style="background:red;width:100px;margin: 10px" />
                    </center> 
                </p:outputPanel>
            </h:form>  
        </p:dialog>


    </ui:define>
</ui:composition>
