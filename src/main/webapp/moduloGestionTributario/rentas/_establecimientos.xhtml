<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:p="http://primefaces.org/ui"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
    <style type="text/css">
        .forty-percent {
            width: 60%;
        }

        .sixty-percent {
            width: 40%;
        }

        .top-alignment {
            vertical-align: top;
        }
    </style>
    <h:panelGroup id="pnlGropuEstablecimiento" layout="block" class="Wid100 MarTop10 Container"  style="margin-bottom: 20px;">
        <h:panelGroup layout="block" class="Container Wid100">
            <div class="ContainerIndent">       
                <p:fieldset legend="Informaciòn del Establecimiento" id="fieldLocales" toggleable="true"> 
                    <p:accordionPanel widgetVar="basic" id="dataTabItems">
                        <p:tab title="Datos Ubicacion">
                            <p:panelGrid layout="grid" styleClass="ui-panelgrid-blank" columns="4">
                                <p:panelGrid columns="1">
                                    <p:outputLabel value="Predio" class="FontBold"/>
                                    <h:panelGroup layout="block">
                                        <p:inputText value="#{patenteView.predio.claveCat}" placeholder="Predio" readonly="true" />
                                        <p:commandButton id="btnPredio" actionListener="#{patenteView.openDlgPredios()}" update="frmPredios"
                                                         icon="fa fa-search" styleClass="ui-button-warning" immediate="true"/>
                                    </h:panelGroup>

                                </p:panelGrid>

                                <p:panelGrid columns="1">
                                    <p:outputLabel value="Num.Predio:" class="FontBold"/>
                                    <p:inputText placeholder="Num.Predio" readonly="true" value="#{patenteView.predio.numPredio}"/>
                                </p:panelGrid>

                                <p:panelGrid columns="1">
                                    <p:outputLabel value="Propietario" class="FontBold"/>
                                    <p:inputText style="width: 100%" readonly="true"  placeholder="asignar propietario"
                                                 value="#{patenteView.predio.nombrePropietarios}"/>
                                </p:panelGrid>
                                <p:panelGrid columns="1">
                                    <p:outputLabel value="Dirección" class="FontBold"/>
                                    <p:inputText style="width: 100%"  placeholder="Dirección" readonly="true" 
                                                 value="#{patenteView.predio.direccion}"/>
                                </p:panelGrid>
                            </p:panelGrid>
                        </p:tab>
                        <p:tab title="Local">
                            <h:panelGrid columns="3" style="width: 100%" id="dataLocal">
                                <h:panelGroup layout="block" class="Responsive100 Responsive" >
                                    <p:outputLabel for="nombreLocal" value="Nombre comercial:" class="DispBlock Wid100" 
                                                   style="font-weight: bolder !important; margin-bottom: 0px;" />
                                    <br/>
                                    <p:inputTextarea rows="4"   cols="70" id="nombreLocal" 
                                                     value="#{patenteView.local.nombreLocal}"/>
                                </h:panelGroup>
                                <h:panelGroup layout="block" class="Responsive100 Responsive">
                                    <p:outputLabel  value="# Establecimiento:" class="DispBlock Wid100" style="font-weight: bolder !important; margin-bottom: 0px;"  />
                                    <br/>
                                    <p:inputTextarea rows="4" cols="60" value="#{patenteView.local.numLocal}" style="font-weight: bolder !important; margin-bottom: 0px; text-transform: uppercase" >
                                        <p:keyFilter mask="num"/>
                                    </p:inputTextarea>
                                </h:panelGroup>
                                <h:panelGroup layout="block" class="Responsive100 Responsive">
                                    <p:outputLabel  value="Direcciòn:" class="DispBlock Wid100" style="font-weight: bolder !important; margin-bottom: 0px;"  />
                                    <br/>
                                    <p:inputTextarea rows="4" cols="70" value="#{patenteView.local.actividadComercial}" style="text-transform: uppercase"/>
                                </h:panelGroup>
                            </h:panelGrid>
                            <h:panelGrid columns="4" style="width: 100%" id="dataLocal2">
                                <h:panelGroup layout="block" class="Responsive100 Responsive">
                                    <p:outputLabel  value="Zona:" class="DispBlock Wid100" style="font-weight: bolder !important; margin-bottom: 0px;"  />
                                    <br/>
                                    <p:selectOneMenu   value="#{patenteView.local.factorUbicacion}" converter="entityConverter" style="width: 300px;">
                                        <f:selectItem itemLabel="Seleccione..." itemValue="#{null}"/>
                                        <f:selectItems value="#{patenteView.ubicacionList}" var="ubi" itemLabel="#{ubi.texto}" itemValue="#{ubi}"/>
                                    </p:selectOneMenu>
                                </h:panelGroup>

                                <h:panelGroup layout="block" class="Responsive100 Responsive">

                                    <p:selectOneRadio  value="#{patenteView.local.avenida}" unselectable="true">
                                        <f:selectItem itemLabel="Avenida" itemValue="true"/>
                                        <f:selectItem itemLabel="Calle" itemValue="false"/>

                                    </p:selectOneRadio>
                                </h:panelGroup>

                                <h:panelGroup layout="block" class="Responsive100 Responsive">
                                    <p:selectOneRadio value="#{patenteView.local.mediterraneo}" unselectable="true">
                                        <f:selectItem itemLabel="Mediterraneo" itemValue="true"/>
                                        <f:selectItem itemLabel="Esquinero" itemValue="false"/>

                                    </p:selectOneRadio>
                                </h:panelGroup>

                                <h:panelGroup layout="block" class="Responsive100 Responsive">
                                    <p:outputLabel  value="LLeva Contabilidad" class="DispBlock Wid100" style="font-weight: bolder !important; margin-bottom: 0px;"  />
                                    <br/>
                                    <p:selectBooleanCheckbox value="#{patenteView.local.contabilidad}" />
                                </h:panelGroup>
                            </h:panelGrid>
                        </p:tab>

                        <p:tab title="Datos Del Negocio">
                            <h:panelGrid columns="4" style="width: 100%">
                                <h:panelGroup layout="block" class="Responsive100 Responsive">
                                    <p:outputLabel for="estadoCmb"  value="Estado local:" class="DispBlock Wid100" style="font-weight: bolder !important; margin-bottom: 0px;"  />
                                    <br/>
                                    <p:selectOneMenu id="estadoCmb" value="#{patenteView.local.estadoLocalComercial}" style="font-size: 10px;" >
                                        <f:selectItem itemLabel="Estado Local" itemValue="#{null}" noSelectionOption="true"/>
                                        <f:selectItem itemLabel="HABILITADO" itemValue="#{1}" />
                                        <f:selectItem itemLabel="INHABILITADO" itemValue="#{2}" />
                                        <f:selectItem itemLabel="CLAUSURADO" itemValue="#{3}" />
                                    </p:selectOneMenu>
                                </h:panelGroup>
                                <h:panelGroup layout="block" class="Responsive100 Responsive">
                                    <p:outputLabel for="@next" value="Tipo Local:" class="DispBlock Wid100" 
                                                   style="font-weight: bolder !important; margin-bottom: 0px;"  />
                                    <br/>
                                    <p:inputText value="#{patenteView.tipoLocalCalculado.descripcion}" readonly="true" id="itemTipoLocal"/>
                                </h:panelGroup>
                                <h:panelGroup layout="block" class="Responsive100 Responsive">
                                    <p:outputLabel  value="Inicio de Actividades:" class="DispBlock Wid100" style="font-weight: bolder !important; margin-bottom: 0px;"  />
                                    <br/>
                                    <p:calendar value="#{patenteView.local.inicioActividad}" navigator="true" pattern="dd/MM/yyyy" />
                                </h:panelGroup>



                                <h:panelGroup layout="block" class="Responsive100 Responsive">
                                    <center>
                                        <p:outputLabel  value="Es Propio ?:" class="DispBlock Wid100" style="font-weight: bolder !important; margin-bottom: 0px;"  />
                                    </center>
                                    <br/>
                                    <center>
                                        <p:selectBooleanCheckbox  value="#{patenteView.local.esPropio}"/>
                                    </center>
                                </h:panelGroup>
                                <h:panelGroup layout="block" class="Responsive100 Responsive">
                                    <center>
                                        <p:outputLabel  value="Es Matriz ?:" class="DispBlock Wid100" style="font-weight: bolder !important; margin-bottom: 0px;"  />
                                    </center>
                                    <br/>
                                    <center>
                                        <p:selectBooleanCheckbox  value="#{patenteView.local.matriz}"/>
                                    </center>
                                </h:panelGroup>

                                <h:panelGroup layout="block" class="Responsive100 Responsive">
                                    <p:outputLabel  value="Ancho:" class="DispBlock Wid100" style="font-weight: bolder !important; margin-bottom: 0px;"  />
                                    <br/>
                                    <p:inputNumber value="#{patenteView.local.ancho}" id="ancho">
                                        <p:ajax event="keyup" process="ancho,altura" listener="#{patenteView.calcularTipoLocal()}" update="itemTipoLocal,areaCal"/>
                                    </p:inputNumber>
                                </h:panelGroup>
                                <h:panelGroup layout="block" class="Responsive100 Responsive">
                                    <p:outputLabel  value="Altura" class="DispBlock Wid100" style="font-weight: bolder !important; margin-bottom: 0px;"  />
                                    <br/>
                                    <p:inputNumber value="#{patenteView.local.altura}" id="altura">
                                        <p:ajax event="keyup" process="ancho,altura" listener="#{patenteView.calcularTipoLocal()}" update="itemTipoLocal,areaCal"/>
                                    </p:inputNumber>
                                </h:panelGroup>
                                <h:panelGroup layout="block" class="Responsive100 Responsive">
                                    <p:outputLabel  value="Area" class="DispBlock Wid100" style="font-weight: bolder !important; margin-bottom: 0px;"  />
                                    <br/>

                                    <p:inputNumber id="areaCal" value="#{patenteView.local.area}">
                                        <p:ajax event="keyup" listener="#{patenteView.calcularTipoLocal()}" update="itemTipoLocal,areaCal"/>
                                    </p:inputNumber>
                                </h:panelGroup>

                            </h:panelGrid>
                        </p:tab>

                        <p:tab title="Destino del negocio" >
                            <p:panelGrid layout="grid" columns="2" columnClasses="ui-g-6,ui-g-6" styleClass="ui-panelgrid-blank"  >
                                <p:panelGrid columns="1" layout="grid">
                                    <p:outputLabel value="Tipo Negocio" class="FontBold"/>
                                    <p:selectManyMenu value="#{patenteView.tipoNegoicoSeleccionados}"
                                                      converter="#{utilConverter}"
                                                      var="c" filter="true" filterMatchMode="contains" showCheckbox="true" styleClass="manymenu-advanced">
                                        <f:selectItems value="#{patenteView.tipoNegocioList}" var="i"
                                                       itemLabel="#{i.texto}" itemValue="#{i}"/>
                                        <p:column>
                                            <h:outputText value="#{c.texto}"/>
                                        </p:column>
                                    </p:selectManyMenu>
                                </p:panelGrid> 

                                <p:panelGrid columns="1" layout="grid" id="grupo_accesorios">
                                    <p:panel header="Accesorio">
                                        <p:panelGrid layout="grid" styleClass="ui-panelgrid-blank" columns="2" columnClasses="ui-g-6,ui-g-6">
                                            <h:panelGrid columns="1">
                                                <p:outputLabel value="Cantidad"/>
                                                <p:inputText type="number" value="#{patenteView.cantidad.cantidad}"/>
                                            </h:panelGrid>
                                            <h:panelGrid columns="1">
                                                <p:outputLabel value="Tipo"/>
                                                <p:selectOneMenu value="#{patenteView.cantidad.tipo}" converter="#{utilConverter}" filter="true">
                                                    <f:selectItem itemLabel="Seleccione" itemValue="#{null}"/>
                                                    <f:selectItems value="#{patenteView.tiposAccesorios}" var="ad" itemLabel="#{ad.texto}" itemValue="#{ad}"/>
                                                </p:selectOneMenu>
                                            </h:panelGrid>
                                        </p:panelGrid>
                                        <center>
                                            <p:commandButton value="Agregar" style="width: auto;"  process="grupo_accesorios"
                                                             actionListener="#{patenteView.agregarAccesorios(0,null)}" 
                                                             update="listAccesorios"/>
                                        </center>

                                    </p:panel>

                                    <p:dataTable rowIndexVar="index" rows="4" 
                                                 value="#{patenteView.listAccesorios}" var="ac" id="listAccesorios" widgetVar="listAccesorios">
                                        <f:facet name="header">
                                            ACCESORIOS
                                        </f:facet>
                                        <p:column headerText="No.">#{index+1} </p:column>
                                        <p:column headerText="Tipo"><h:outputText value="#{ac.tipo.texto}"/> </p:column>
                                        <p:column headerText="Cantidad"><h:outputText value="#{ac.cantidad}"/> </p:column>
                                        <p:column headerText="Anio"><h:outputText value="#{ac.anio}"/> </p:column>
                                        <p:column headerText="Fecha Ingreso">
                                            <h:outputText value="#{ac.fechaIngreso}">
                                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                                            </h:outputText> 
                                        </p:column>
                                        <p:column headerText="*****">
                                            <p:commandButton icon="fa fa-edit" process="@this" actionListener="#{patenteView.editAcc(index)}" 
                                                             update="dataTabItems:grupo_accesorios,listAccesorios"/>
                                            <p:commandButton icon="fa fa-close" process="@this" actionListener="#{patenteView.eliminarAcesorios(index)}" 
                                                             update="listAccesorios"/>
                                        </p:column>


                                    </p:dataTable>
                                </p:panelGrid>

                            </p:panelGrid>
                        </p:tab>

                        <p:tab title="Turismo">
                            <p:panelGrid layout="grid" columns="3" styleClass="ui-panelgrid-blank" id="destino_negocio" >
                                <h:panelGroup layout="block" class="Responsive100 Responsive">
                                    <center>
                                        <p:outputLabel  value="Es Turistico ?:" class="DispBlock Wid100" style="font-weight: bolder !important; margin-bottom: 0px;"/>

                                    </center>
                                    <br/>
                                    <center>
                                        <p:selectBooleanCheckbox  value="#{patenteView.local.turismo}">
                                            <p:ajax update="destino_negocio"/>
                                        </p:selectBooleanCheckbox>
                                    </center>
                                </h:panelGroup>
                                <p:panelGrid columns="1" layout="grid" id="listTursitca"  rendered="#{patenteView.local.turismo}">
                                    <p:outputLabel value="Tipo de Actividad Turistica" class="FontBold"/>
                                    <p:selectOneMenu  value="#{patenteView.padreTuristico}" converter="#{utilConverter}"
                                                      panelStyle="width:180px" effect="fade" style="width: 280px;"
                                                      filter="true" filterMatchMode="contains">
                                        <f:selectItem itemLabel="Seleccione" itemValue="#{null}"/>
                                        <f:selectItems value="#{patenteView.padreTuristicoList}" var="itemi"
                                                       itemLabel="#{itemi.descripcion}" itemValue="#{itemi}" />
                                        <p:ajax listener="#{patenteView.ajaxTipoActividadTuristica()}" update="listTursitcaHijos"/>
                                    </p:selectOneMenu>
                                </p:panelGrid>        


                                <p:panelGrid id="listTursitcaHijos" columns="1" layout="grid"   rendered="#{patenteView.local.turismo}">
                                    <p:outputLabel value="Categoria" class="FontBold"/>
                                    <p:selectOneMenu   value="#{patenteView.local.categoria}" converter="#{utilConverter}"
                                                       panelStyle="width:180px" effect="fade" style="width: 280px;"
                                                       filter="true" filterMatchMode="contains">
                                        <f:selectItem itemLabel="Seleccione" itemValue="#{null}"/>
                                        <f:selectItems value="#{patenteView.listaTuristicasActividad}" var="item"
                                                       itemLabel="#{item.descripcion}" itemValue="#{item}"/>
                                    </p:selectOneMenu>
                                </p:panelGrid>        
                            </p:panelGrid>
                        </p:tab>
                        <p:tab title="Información Adicional">


                            <p:panelGrid columns="2"  style="width: 100%;" columnClasses="ui-g-6,ui-g-6" styleClass="ui-panelgrid-blank">

                                <p:panelGrid columns="1" style="width: 100%" >
                                    <center>
                                        <h:outputLabel  value="Actividades Comerciales" class="FontBold"  />
                                    </center>

                                    <p:pickList id="PojoPickList" value="#{patenteView.dualListActividades}" var="act" 
                                                style="text-align: center;vertical-align: middle; width:100%" 
                                                itemValue="#{act}" itemLabel="#{act.descripcion}"  responsive="true"  
                                                addAllLabel="Agregar todas" addLabel="Adicionar" removeAllLabel="Eliminar todas" removeLabel="Eliminar"
                                                showSourceFilter="true" showTargetFilter="true" filterMatchMode="contains" converter="entityConverter">
                                        <f:facet name="sourceCaption">Actividades disponibles</f:facet>
                                        <f:facet name="targetCaption">Actividades del local</f:facet>
                                        <p:ajax event="transfer" listener="#{patenteView.onTranferActividad}" update="PojoPickList"/>0
                                        <p:column style="width:auto;">
                                            <h:outputText value="#{act.descripcion}" />
                                        </p:column>
                                    </p:pickList>
                                </p:panelGrid>

                                <p:panelGrid columns="1" style="width: 100%" id="listaFotos" >
                                    <h:outputLabel  value="Fotos" class="DispBlock Wid100" />

                                    <p:commandButton id="btnaddFoto" value="Agregar foto" onclick="PF('dlgSubida').show()" immediate="true" update=":frmSubFotos"/>
                                    <br></br>
                                    <br/>

                                    <p:dataTable var="f" value="#{patenteView.fotosLocalesComerciales}" rows="2" paginator="true" widgetVar="datGrFotos"
                                                 id="datGrFotos" rowIndexVar="i" style="width: 100%;"
                                                 emptyMessage="No existen fotos registradas en la tabla de datos"
                                                 paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                                 rowsPerPageTemplate="2,4,6">
                                        <p:column headerText="Nombre" >
                                            <h:outputText value="#{f.nombre}"/>
                                        </p:column>
                                        <p:column headerText="tipo" width="10%">
                                            <h:outputText value="#{f.contentType}"/>
                                        </p:column>
                                        <p:column headerText="tipo" width="10%">
                                            <h:outputText value="#{f.sisEnabled eq null?'Inactivo':(f.sisEnabled?'Activo':'Inactivo')}"/>
                                        </p:column>
                                        <p:column headerText="****" width="20%">
                                            <p:commandButton icon="fa fa-search" process="@this" actionListener="#{patenteView.loadValueFotoLocal(f, i)}"
                                                             oncomplete="PF('dlgFoto').show()" update=":frmFotos"/>

                                            <p:commandButton icon="fa fa-close" process="@this" actionListener="#{patenteView.eliminarFoto(f, i)}"
                                                             disabled="#{f.sisEnabled eq null?true:(!f.sisEnabled)}"
                                                             update="datGrFotos" style="background: red;"/>
                                        </p:column>
                                    </p:dataTable>
                                </p:panelGrid>
                            </p:panelGrid>
                        </p:tab>
                    </p:accordionPanel>
                    <center>
                        <p:commandLink id="btnAgregar"  actionListener="#{patenteView.guardarEstablecimiento()}"  style="padding-left: 5px" update="frmNew">
                            <p:commandButton value="Agregar" icon="fa fa-fw fa-save" type="button"/>
                        </p:commandLink>
                        <br/>
                    </center>
                </p:fieldset>
                <br/><br/>
                <p:dataTable id="dtLocales" value="#{patenteView.locales}" rowIndexVar="index"
                             var="local" rows="10" paginator="true" paginatorPosition="top" 
                             emptyMessage="No se han Agregado Locales Comerciales"
                             rowsPerPageTemplate="10, 20, 50, 100" filterEvent="enter" widgetVar="dtLocales" >
                    <f:facet name="header">
                        Establecimientos Agregados
                    </f:facet>

                    <p:column headerText="Número" filterBy="#{local.numLocal}" width="10%;"  filterStyle="width:60%;">
                        <center><h:outputText value="#{local.numLocal}"/></center>
                    </p:column>
                    <p:column headerText="Nombre" width="15%">
                        <center><h:outputText value="#{local.nombreLocal}"/></center>
                    </p:column>
                    <p:column headerText="Matriz" width="10%">
                        <center><h:outputText value="SI" rendered="#{local.matriz}"/></center>
                        <center><h:outputText value="NO" rendered="#{!local.matriz}"/></center>
                    </p:column>
                    <p:column headerText="Actividades" >
                        <center>
                            <ui:repeat id="actividadesLocales" value="#{local.renActividadComercialCollection}" var="act">
                                <p:outputLabel value="#{act.descripcion} ;" style="text-transform: uppercase; font-size: 11px"/>
                            </ui:repeat>    
                        </center>
                    </p:column>

                    <p:column headerText="Estado Local" width="15%" >
                        <center>
                            <h:outputText value="Habilitado" rendered="#{local.estadoLocalComercial eq 1}"   />
                            <h:outputText value="Inhabilitado" rendered="#{local.estadoLocalComercial eq 2}"   />
                            <h:outputText value="Clausurado" rendered="#{local.estadoLocalComercial eq 3}" />
                        </center>
                    </p:column>

                    <p:column headerText="Estado Logico" width="15%" >
                        <h:outputText value="#{local.estado eq null? 'Inactivo': (local.estado eq true?'Activo':'Inactivo')}"/>
                    </p:column>

                    <p:column headerText="Acción"  style="width: 8%;">
                        <center>
                            <p:commandButton icon="fa fa-edit"  title="Editar" process="@this" rendered="#{patenteView.patente.id ne null}"
                                             actionListener="#{patenteView.initEditarLocal(local)}" 
                                             update="pnlGropuEstablecimiento" />

                            <p:spacer width="10"/>
                            <p:commandButton  icon="fa fa-close" style="background: red;" title="Eliminar" process="@this"
                                              actionListener="#{patenteView.removeLocal(index)}" update="dtLocales"  />
                        </center>
                    </p:column>
                </p:dataTable>
            </div>
        </h:panelGroup>
    </h:panelGroup>

</html>