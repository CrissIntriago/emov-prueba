<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="/WEB-INF/template/template.xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core">
    <ui:define name="title">
        Emisiones Prediales
    </ui:define>
    <ui:param name="tittle" value="EMISIÓN PREDIAL" />
    <ui:define name="content">

        <div class="ui-g ui-fluid">

            <div class="ui-g-12">

                <h:form id="frmMain">
                    <div >
                        <p:tabView id="tbvValorizarProcess" >
                            <p:tab title="Emisión Predial" titleStyle="font-weight: bolder">
                                <h:panelGroup layout="block" class="Container Wid100 MarTop10" >

                                    <h:panelGroup  layout="block" class="ui-g-12">

                                        <p:dataTable id="prediosList" widgetVar="prediosList" var="pt" value="#{avaluosPrediales.predios}" selection="#{avaluosPrediales.prediosSeleccionados}"
                                                     rowKey="#{pt.id}" style="margin-bottom:0"
                                                     emptyMessage="No existen predios con un avaluos mayores a cero."
                                                     paginator="true" filterEvent="enter"
                                                     rows="10" lazy="true"
                                                     paginatorPosition="bottom"
                                                     rowsPerPageTemplate="10,20,40,50"
                                                     paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}">

                                            <p:ajax event="filter" update="prediosList" />

                                            <f:facet name="header">
                                                Listado de Predios
                                            </f:facet>
                                            <p:column selectionMode="multiple" style="width:2%;text-align:center" />

                                            <p:column headerText="Clave Castastral"   style="text-align: center; width: 10%" 
                                                      filterBy="#{pt.claveCat}"  filterMatchMode="contains">
                                                <h:outputText value="#{pt.claveCat}"/>
                                            </p:column>
                                            <p:column headerText="#Predio"   style="text-align: center; width: 3%"  filterStyle="width: 45%"
                                                      filterBy="#{pt.numPredio}"  filterMatchMode="contains">
                                                <h:outputText value="#{pt.numPredio}"/>
                                            </p:column>
                                            <p:column headerText="Parroquia" style="text-align: center; width: 3%" filterBy="#{pt.parroquia}" filterStyle="width: 45%">
                                                <h:outputText value="#{pt.parroquia}"  />
                                            </p:column>
                                            <p:column headerText="Zona" style="text-align: center; width: 3%" filterBy="#{pt.zona}"  filterStyle="width: 45%">
                                                <h:outputText value="#{pt.zona}"/>
                                            </p:column>
                                            <p:column headerText="Sector" style="text-align: center; width:3%" filterBy="#{pt.sector}" filterStyle="width: 45%">
                                                <h:outputText value="#{pt.sector}"/>
                                            </p:column>
                                            <p:column headerText="Mz." style="text-align: center; width: 3%" filterBy="#{pt.mz}"  filterStyle="width: 45%">
                                                <h:outputText value="#{pt.mz}"/>
                                            </p:column>
                                            <p:column headerText="Lote" style="text-align: center; width: 3%" filterBy="#{pt.solar}"   filterStyle="width: 45%">
                                                <h:outputText value="#{pt.solar}"/>
                                            </p:column>
                                            <p:column headerText="Avalúo Solar" style="text-align: center;width: 4%">
                                                <h:outputText value="#{pt.avaluoSolar}">
                                                    <f:convertNumber pattern="$ #,##0.00" />
                                                </h:outputText>
                                            </p:column>
                                            <p:column headerText="Avalúo de la Construcción" style="text-align: center;width: 4%">
                                                <h:outputText value="#{pt.avaluoConstruccion}">
                                                    <f:convertNumber pattern="$ #,##0.00" />
                                                </h:outputText>
                                            </p:column>
                                            <p:column headerText="Avalúo de la Propiedad" style="text-align: center;width: 4%">
                                                <h:outputText value="#{pt.avaluoMunicipal}">
                                                    <f:convertNumber pattern="$ #,##0.00" />
                                                </h:outputText>
                                            </p:column>
                                            <p:column headerText="Tipo" style="text-align: center;width: 4%" filterBy="#{pt.tipoPredio}">
                                                <f:facet name="filter">
                                                    <p:selectOneMenu  onchange="PF('prediosList').filter()" styleClass="custom-filter">
                                                        <f:selectItem itemLabel="Todos" itemValue="#{null}" noSelectionOption="true" />
                                                        <f:selectItem itemLabel="URBANO" itemValue="U"  />
                                                        <f:selectItem itemLabel="RUSTICO" itemValue="R"  />
                                                    </p:selectOneMenu>
                                                </f:facet>
                                                <h:outputText value="#{pt.tipoPredio}"/>
                                            </p:column>
                                            <p:column headerText="Estado Predio" filterBy="#{pt.estado}" filterMatchMode="contains" style="text-align: center;width: 4%">
                                                <h:outputText value="#{pt.estado}" >
                                                    <f:convertNumber pattern="$ #,##0.00" />
                                                </h:outputText>
                                            </p:column>
                                            <p:column headerText="Estado Activo" filterBy="#{pt.esActivo}" filterMatchMode="contains"  style="text-align: center;width: 4%">
                                                <h:outputText value="#{pt.esActivo}">
                                                    <f:convertNumber pattern="$ #,##0.00" />
                                                </h:outputText>
                                            </p:column>
                                        </p:dataTable>
                                    </h:panelGroup>

                                    <p:fieldset legend="Emitir" toggleable="true" toggleSpeed="500" style="margin-bottom: 10px;">
                                        <div align="center">
                                            <h:panelGrid columns="2" style="margin-top:5px" columnClasses="ui-g-4,ui-g-8">
                                                <p:row rendered="false"><p:column><h:outputText  value="Año: " style="font-weight: bolder"/></p:column></p:row>
                                                <p:row rendered="false"><p:column><h:outputText  value="Año Fin " style="font-weight: bolder"/></p:column></p:row>
                                                <p:row rendered="false">
                                                    <p:column style="width: 50%"><p:inputText id="anio"  value="#{avaluosPrediales.anioEmisionInicio}"
                                                                                              onkeypress="validateIntegerValueAndFocusNext(event, '')"
                                                                                              style="text-align: center; width: 89%" maxlength="4"/></p:column>
                                                </p:row>
                                                <p:row rendered="false">
                                                    <p:column style="width: 50%"><p:inputText value="#{avaluosPrediales.anioEmisionFin}"
                                                                                              onkeypress="validateIntegerValueAndFocusNext(event, '')"
                                                                                              style="text-align: center; width: 89%" maxlength="4"/></p:column>
                                                </p:row>
                                                <p:dataTable id="aniosEmitir" value="#{avaluosPrediales.aniosEmisionMax}"
                                                             var="pt"
                                                             selection="#{avaluosPrediales.aniosEmisionSeleccionados}"
                                                             emptyMessage="No se encontraron elementos..." rowKey="#{pt.id}">
                                                    <f:facet name="header">
                                                        Años a Emitir
                                                    </f:facet>
                                                    <p:column selectionMode="multiple" style="width:2%;text-align:center" />
                                                    <p:column headerText="Año" style="text-align: center; width: 6%" >
                                                        <h:outputText value="#{pt.anioEmision}"  />
                                                    </p:column>
                                                    <p:column headerText="Considera Construccion" style="text-align: center; width: 6%" rendered="false">
                                                        <p:selectBooleanCheckbox value="#{pt.consideraConstruccion}"/>
                                                    </p:column>
                                                </p:dataTable>


                                                <p:fieldset legend="Parametrización" style="font-weight: bold;">

                                                    <p:panelGrid columns="3" styleClass="ui-panelgrid-blank" style="width: 100%">

                                                        <p:column>
                                                            <p:commandButton style="width: 200px;background: purple" 
                                                                             icon="fa fa-refresh" actionListener="#{avaluosPrediales.startEmisionPredial(false,1)}"
                                                                             value="Emitir Predios Select. (U)">
                                                                <p:confirm header="" message="Esta Seguro de Continuar?" icon="fa fa-exclamation-triangle"  />
                                                            </p:commandButton>
                                                        </p:column>

                                                        <p:column>
                                                            <p:commandButton style="width: 200px;background: purple"
                                                                             icon="fa fa-refresh" actionListener="#{avaluosPrediales.startEmisionPredial(true,1)}"
                                                                             value="Emitir Todo (U)"  rendered="true">
                                                                <p:confirm header="" message="Esta Seguro de Continuar la Emision de TODO EL CATASTRO? " icon="fa fa-exclamation-triangle"  />                                                            
                                                            </p:commandButton>
                                                        </p:column>

                                                        <p:column>
                                                            <p:commandButton style="width: 200px"
                                                                             icon="fa fa-refresh" actionListener="#{avaluosPrediales.startEmisionPredial(false,2)}"
                                                                             value="Emitir Predios Selecct(U)">
                                                                <p:confirm header="" message="Esta Seguro de Continuar? " icon="fa fa-exclamation-triangle"  />
                                                            </p:commandButton>
                                                        </p:column>
                                                        <p:column>
                                                            <p:commandButton style="width: 200px"
                                                                             icon="fa fa-refresh" actionListener="#{avaluosPrediales.startEmisionPredial(true,2)}"
                                                                             value="Emitir Todo (U)"  rendered="true">
                                                                <p:confirm header="" message="Esta Seguro de Continuar la Emision de TODO EL CATASTRO? " icon="fa fa-exclamation-triangle"  />                                                            
                                                            </p:commandButton>
                                                        </p:column>


                                                        <p:column>
                                                            <p:commandButton style="width: 200px; background: green;"
                                                                             icon="fa fa-refresh" actionListener="#{avaluosPrediales.startEmisionPredial(false,3)}"
                                                                             value="Emitir Predios Select. (R)">
                                                                <p:confirm header="" message="Esta Seguro de Continuar? " icon="fa fa-exclamation-triangle"  />
                                                            </p:commandButton>
                                                        </p:column>

                                                        <p:column>
                                                            <p:commandButton style="width: 200px;background: green;"
                                                                             icon="fa fa-refresh" actionListener="#{avaluosPrediales.startEmisionPredial(true,3)}"
                                                                             value="Emitir Todo (R)"  rendered="true">
                                                                <p:confirm header="" message="Esta Seguro de Continuar la Emision de TODO EL CATASTRO? " icon="fa fa-exclamation-triangle"  />
                                                            </p:commandButton>
                                                        </p:column>

                                                        <p:column>
                                                            <p:commandButton style="width: 200px;height: 40px;;background: red;"
                                                                             icon="fa fa-refresh" actionListener="#{avaluosPrediales.bajaPredios(false)}"
                                                                             value="Baja de Titulos del Año Actual (Predios Seleccionado)">
                                                                <p:confirm header="" message="Esta Seguro de Continuar? " icon="fa fa-exclamation-triangle"  />
                                                            </p:commandButton>
                                                        </p:column>
                                                        <p:column>
                                                            <p:commandButton style="width: 200px;height: 40px; background: red;"
                                                                             icon="fa fa-refresh" actionListener="#{avaluosPrediales.bajaPredios(true)}"
                                                                             value="Baja de Titulos del Año Actual (Todo el Castastro)">
                                                                <p:confirm header="" message="Esta Seguro de Continuar? " icon="fa fa-exclamation-triangle"  />
                                                            </p:commandButton>
                                                        </p:column>
                                                    </p:panelGrid>
                                                    <br/> <br/>
                                                    <p:outputLabel value="Glosario" style="font-weight: bold;"/>
                                                    <hr/>

                                                    <p:panelGrid columns="2" columnClasses="ui-g-1, ui-g-11" style="width: 100%; color: #9e9e9e;font: italic" styleClass="ui-panelgrid-blank" >
                                                        <p:column>
                                                            <div style="width: 20px; height: 20px; background: purple;">                                                                
                                                            </div>
                                                        </p:column>
                                                        <p:column>
                                                            TODOS LOS PREDIOS URBANOS CON ESTADO DE PREDIO 'A' Y ESTADO ACTIVO 'A'
                                                        </p:column>
                                                        <p:column>
                                                            <div style="width: 20px; height: 20px; background: blue;">                                                                
                                                            </div>
                                                        </p:column>
                                                        <p:column>
                                                            TODOS LOS PREDIOS URBANOS CON ESTADO DE PREDIO 'A' Y ESTADO ACTIVO 'N'
                                                        </p:column>
                                                        <p:column>
                                                            <div style="width: 20px; height: 20px; background: green;">                                                                
                                                            </div>
                                                        </p:column>
                                                        <p:column>
                                                            TODOS LOS PREDIOS RUSTICO ESTADO ACTIVO 'A'
                                                        </p:column>

                                                        <p:column>
                                                            <div style="width: 20px; height: 20px; background: red;">                                                                
                                                            </div>
                                                        </p:column>
                                                        <p:column >
                                                            DAT DE BAJA A  TODOS LOS TITULOS EMITIDOS DEL AÑO ACTUAL DE LOS PREDIOS SELECCIONADO O TODO EL CATASTRO (U y R)
                                                        </p:column>
                                                    </p:panelGrid>
                                                </p:fieldset>
                                            </h:panelGrid>
                                        </div>
                                    </p:fieldset>
                                </h:panelGroup>
                            </p:tab>
                            <p:tab title="Impuesto Predial" titleStyle="font-weight: bolder" rendered="false">
                                <p:fieldset legend="Banda Impositiva - Valores" toggleable="true" toggleSpeed="500" style="margin-bottom: 10px;">
                                    <div align="center" style="width: 70%; margin: auto;"><center>
                                            <h:panelGrid columns="6" style="align-self:  center; margin-top:5px;" rendered="false">
                                                <h:outputText  value="Banda Impositiva:" style="font-weight: bolder"/>
                                                <h:outputText  value="Año Inicial:" style="font-weight: bolder"/>
                                                <h:outputText  value="Año Fin:" style="font-weight: bolder"/>
                                                <h:outputText  value="Avaluo desde:" style="font-weight: bolder"/>
                                                <h:outputText  value="Avaluo desde:" style="font-weight: bolder"/>
                                                <h:outputText  value="Tipo" style="font-weight: bolder;text-align: center"/>
                                                <p:inputNumber value="#{avaluosPrediales.avalBandaImpositiva.multiploImpuestoPredial}" minValue="0" decimalPlaces="5" maxlength="4"/>

                                                <p:inputText   value="#{avaluosPrediales.avalBandaImpositiva.anioInicio}" onkeypress="validateIntegerValueAndFocusNext(event, '')"
                                                               style="text-align: center; width: 89%" maxlength="4"/>
                                                <p:inputText  value="#{avaluosPrediales.avalBandaImpositiva.anioFin}" onkeypress="validateIntegerValueAndFocusNext(event, '')"
                                                              style="text-align: center; width: 89%" maxlength="4">
                                                    <p:ajax process="@form" />
                                                </p:inputText>

                                                <p:inputText   value="#{avaluosPrediales.avalBandaImpositiva.desdeUs}"
                                                               style="text-align: center; width: 89%" />
                                                <p:inputText  value="#{avaluosPrediales.avalBandaImpositiva.hastaUs}" 
                                                              style="text-align: center; width: 89%" />
                                                <h:panelGroup>

                                                    <p:selectOneRadio id="tipo" value="#{avaluosPrediales.avalBandaImpositiva.urbano}" unselectable="true">
                                                        <f:selectItem itemLabel="Urbano" itemValue="true"/>
                                                        <f:selectItem itemLabel="Rustico" itemValue="false"/>                                                        
                                                    </p:selectOneRadio>

                                                </h:panelGroup>
                                            </h:panelGrid>
                                            <br></br>
                                            <div>
                                                <center>
                                                    <p:commandButton rendered="false" id="btnGrabarBanda" value="Grabar" actionListener="#{avaluosPrediales.saveAvalBandaImpositiva(false)}" icon="fa fa-save"
                                                                     style="width: auto" update="frmMain, frmDefinirBase" disabled="#{!avaluosPrediales.controlPredeterminada}" process="frmMain"/>
                                                    <p:spacer height="5px"/>
                                                    <p:commandButton rendered="false" style="width: auto" id="btnDefinirPredeterminada" 
                                                                     value="Definir como Predeterminada" actionListener="#{avaluosPrediales.saveAvalBandaImpositiva(true)}" 
                                                                     update="frmMain" disabled="#{!avaluosPrediales.controlPredeterminada}"/>
                                                </center>

                                            </div>
                                            <br></br>
                                            <p:dataTable id="dtavalBandaImpositivaList" var="pt" value="#{avaluosPrediales.avalBandaImpositivaList}"
                                                         rowStyleClass="#{pt.predeterminada eq true ? 'olded' : ''}"
                                                         emptyMessage="No existen datos."
                                                         rows="20" lazy="true"
                                                         paginatorPosition="bottom"
                                                         rowsPerPageTemplate="20,40,50"
                                                         paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}">

                                                <f:facet name="header">
                                                    Tabla Base Imponible
                                                </f:facet>                
                                                <p:column  style="text-align: center; width: 10%" headerText="Base Imponible">
                                                    <h:outputText value="#{pt.multiploImpuestoPredial}"><f:convertNumber pattern="##############.####" locale="us"/></h:outputText>
                                                </p:column>
                                                <p:column  style="text-align: center; width: 7%" headerText="Años">
                                                    <h:outputText value="#{pt.anio}"></h:outputText>
                                                </p:column>
                                                <p:column headerText="Rango avaluo Desde" style="width: 15%">
                                                    <h:outputText value="#{pt.desdeUs}" style="float: right"/>
                                                </p:column>
                                                <p:column headerText="Rango avaluo Hasta" style="width: 15%">
                                                    <h:outputText value="#{pt.hastaUs}" style="float: right"/>
                                                </p:column>
                                                <p:column headerText="Tipo" style="text-align: center; width: 10%">
                                                    <h:outputText value="#{pt.urbano eq null? '':(pt.urbano?'URBANO':'RUSTICO')}"/>
                                                </p:column>
                                                <p:column  style="text-align: center; width: 3%" rendered="false">
                                                    <p:commandLink title="Definir como Predeterminada"  actionListener="#{avaluosPrediales.definirPredeterminadaBandaImpositiva(pt, true)}" update="frmMain:tbvValorizarProcess:btnDefinirPredeterminada frmMain:tbvValorizarProcess:btnGrabarBanda frmMain:tbvValorizarProcess:dtavalBandaImpositivaList frmDefinirBase:dtavalBandaImpositivaList ">
                                                        <i class="fa fa-fw fa-flag" style="font-size: 1.5em;" />
                                                    </p:commandLink>
                                                    <p:commandLink title="Quitar Predeterminada" actionListener="#{avaluosPrediales.definirPredeterminadaBandaImpositiva(pt, false)}"
                                                                   update="frmMain:tbvValorizarProcess:btnDefinirPredeterminada frmMain:tbvValorizarProcess:btnGrabarBanda frmMain:tbvValorizarProcess:dtavalBandaImpositivaList frmDefinirBase:dtavalBandaImpositivaList "
                                                                   disabled="#{!pt.predeterminada}">
                                                        <i class="fa fa-fw fa-trash" style="font-size: 1.5em;color: red;" />
                                                    </p:commandLink>
                                                    <p:commandLink title="Eliminar" actionListener="#{avaluosPrediales.inactivaBandaImpositviva(pt)}" update="  frmMain:tbvValorizarProcess:dtavalBandaImpositivaList frmDefinirBase:dtavalBandaImpositivaList ">
                                                        <i class="fa  fa-close" style="font-size: 1.5em;color: red;" />
                                                    </p:commandLink>
                                                </p:column>
                                            </p:dataTable>
                                        </center>
                                    </div>

                                </p:fieldset>
                                <p:fieldset rendered="false" legend="Cobro de Rubros por Parroquias - Zonas - Sector - Manzanas - Lotes" toggleable="true" toggleSpeed="500" style="margin-bottom: 10px;" id="pnlGroupValores">
                                    <div align="center" >

                                        <p:panelGrid id="sectoresValores" styleClass="noBorder">
                                            <p:row>
                                                <p:column><h:outputText value="Parroquias" style="font-size: 16px; font-weight: bolder;"/></p:column>
                                                <p:column><h:outputText value="Zonas" style="font-size: 16px; font-weight: bolder;"/></p:column>
                                                <p:column><h:outputText value="Sectores" style="font-size: 16px; font-weight: bolder;"/></p:column>
                                                <p:column><h:outputText value="Manzanas" style="font-size: 16px; font-weight: bolder;"/></p:column>
                                                <p:column><h:outputText value="Solares / Lotes" style="font-size: 16px; font-weight: bolder;"/></p:column>
                                            </p:row>
                                            <p:row>
                                                <p:column>
                                                    <p:selectOneMenu  value="#{avaluosPrediales.parroquia}"  style="width:150px" effect="fade" converter="entityConverter"  filter="true" filterMatchMode="contains">
                                                        <f:selectItem itemLabel="TODAS" itemValue="#{null}"/>
                                                        <f:selectItems value="#{avaluosPrediales.parroquias}" var="t" itemLabel="#{t.codigoParroquia} - #{t.descripcion}" itemValue="#{t}"/>
                                                        <p:ajax update="frmMain:tbvValorizarProcess:sectoresValores" listener="#{avaluosPrediales.loadZonas()}"/>
                                                    </p:selectOneMenu>
                                                </p:column>
                                                <p:column>
                                                    <p:selectOneMenu  value="#{avaluosPrediales.zona}" effect="fade"   style="width:150px;" disabled="#{empty avaluosPrediales.zonaList}">
                                                        <f:selectItem itemLabel="TODAS" itemValue="#{null}"/>
                                                        <f:selectItems value="#{avaluosPrediales.zonaList}" var="c" itemLabel="#{c}" itemValue="#{c}"/>
                                                        <p:ajax update="frmMain:tbvValorizarProcess:sectoresValores" listener="#{avaluosPrediales.loadSectorByZonas()}"/>
                                                    </p:selectOneMenu>
                                                </p:column>
                                                <p:column>
                                                    <p:selectOneMenu  value="#{avaluosPrediales.sector}" effect="fade"  style="width:150px;" disabled="#{empty avaluosPrediales.sectorList}">
                                                        <f:selectItem itemLabel="TODOS" itemValue="#{null}"/>
                                                        <f:selectItems value="#{avaluosPrediales.sectorList}" var="c" itemLabel="#{c}" itemValue="#{c}"/>
                                                        <p:ajax update="frmMain:tbvValorizarProcess:sectoresValores" listener="#{avaluosPrediales.loadMzBySector()}"/>
                                                    </p:selectOneMenu>
                                                </p:column>
                                                <p:column>
                                                    <p:selectOneMenu  value="#{avaluosPrediales.mz}" effect="fade"  style="width:150px;" disabled="#{empty avaluosPrediales.mzList}">
                                                        <f:selectItem itemLabel="TODAS" itemValue="#{null}"/>
                                                        <f:selectItems value="#{avaluosPrediales.mzList}" var="c" itemLabel="#{c}" itemValue="#{c}"/>
                                                        <p:ajax update="frmMain:tbvValorizarProcess:sectoresValores" listener="#{avaluosPrediales.loadLotesByMz()}"/>
                                                    </p:selectOneMenu>
                                                </p:column>
                                                <p:column>
                                                    <p:selectOneMenu  value="#{avaluosPrediales.lotes}"  style="width:150px;" disabled="#{empty avaluosPrediales.lotesList}">
                                                        <f:selectItem itemLabel="TODOS" itemValue="#{null}"/>
                                                        <f:selectItems value="#{avaluosPrediales.lotesList}" var="c" itemLabel="#{c}" itemValue="#{c}"/>
                                                        <p:ajax update="frmMain:tbvValorizarProcess:sectoresValores" />
                                                    </p:selectOneMenu>

                                                </p:column>
                                            </p:row>
                                        </p:panelGrid>
                                        <h:outputText  value="Año:" style="font-weight: bolder"/>
                                        <p:inputText   value="#{avaluosPrediales.avalImpuestoPredios.anioInicio}"
                                                       onkeypress="validateIntegerValueAndFocusNext(event, '')" 
                                                       style="text-align: center; width: 10%" maxlength="4"/>
                                        <div class="ui-g">
                                            <div class="ui-g-4">
                                                <p:dataTable id="dtRubrosSel" rows="10" paginator="true"  var="rubro" value="#{avaluosPrediales.rubrosList}"
                                                             rowKey="#{rubro.id}" selection="#{avaluosPrediales.rubrosSeleccionados}"
                                                             emptyMessage="No tiene datos" style="width: 99%; margin-top: 10px;">
                                                    <p:ajax event="rowSelect"  update="frmMain:tbvValorizarProcess:dtRubrosSel" />
                                                    <p:ajax event="rowUnselect"  update="frmMain:tbvValorizarProcess:dtRubrosSel"  />
                                                    <p:ajax event="rowSelectCheckbox"  update="frmMain:tbvValorizarProcess:dtRubrosSel" />
                                                    <p:ajax event="rowUnselectCheckbox"  update="frmMain:tbvValorizarProcess:dtRubrosSel" />
                                                    <p:ajax event="toggleSelect"  update="frmMain:tbvValorizarProcess:dtRubrosSel" />
                                                    <p:ajax event="filter" update="dtRubrosSel" />
                                                    <f:facet name="header">
                                                        Lista de Rubros Disponibles
                                                    </f:facet>
                                                    <p:column selectionMode="multiple" style="text-align:center;" width="10%"/>
                                                    <p:column headerText="Código rubro" width="27%">
                                                        <h:outputText value="#{rubro.codigoRubro}" />
                                                    </p:column>
                                                    <p:column headerText="Descripción" width="60%">
                                                        <h:outputText value="#{rubro.descripcion}"/>
                                                    </p:column>
                                                </p:dataTable>
                                            </div>
                                            <div class="ui-g-8">
                                                <p:dataTable id="bandaimpoSitivaListSectores" var="pt" value="#{avaluosPrediales.avalBandaImpositivaList}"
                                                             rowStyleClass="#{pt.predeterminada eq true ? 'olded' : ''}" style="width: 89%; margin-top: 10px;"
                                                             emptyMessage="No existen datos."
                                                             rows="20"   selection="#{avaluosPrediales.avalBandaImpositivaSeleccionada}"
                                                             rowKey="#{pt.id}" paginator="true"
                                                             paginatorPosition="bottom"
                                                             rowsPerPageTemplate="20,40,50"
                                                             currentPageReportTemplate="Mostrando {startRecord}-{endRecord} de {totalRecords}"                                                                                     
                                                             paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}">
                                                    <f:facet name="header">
                                                        Tabla Base Imponible
                                                    </f:facet>

                                                    <p:columnGroup type="header">
                                                        <p:row>
                                                            <p:column rowspan="2" headerText="Seleccione" />
                                                            <p:column rowspan="2" headerText="Base Imponible" />
                                                            <p:column rowspan="2" headerText="Tipo" />
                                                            <p:column colspan="2" headerText="Años" />
                                                            <p:column colspan="2" headerText="Rango avaluo" />
                                                        </p:row>
                                                        <p:row>
                                                            <p:column  headerText="Desde" />
                                                            <p:column  headerText="Hasta" />
                                                            <p:column  headerText="Desde" />
                                                            <p:column  headerText="Hasta" />
                                                        </p:row>
                                                    </p:columnGroup>
                                                    <p:column selectionMode="single" style="width:10px;text-align:center" />
                                                    <p:column  style="text-align: center; width: 3%" >
                                                        <h:outputText value="#{pt.multiploImpuestoPredial}"><f:convertNumber pattern="##############.####" locale="us"/></h:outputText>
                                                    </p:column>
                                                    <p:column  style="text-align: center; width: 3%" >
                                                        <h:outputText value="#{pt.urbano eq null? '':(pt.urbano?'URABNO':'RUSTICO')}"></h:outputText>
                                                    </p:column>
                                                    <p:column  style="text-align: center; width: 3%" >
                                                        <h:outputText value="#{pt.anioInicio}"/>
                                                    </p:column>
                                                    <p:column  style="text-align: center; width: 3%" >
                                                        <h:outputText value="#{pt.anioFin}"/>
                                                    </p:column>
                                                    <p:column >
                                                        <h:outputText value="#{pt.desdeUs}"/>
                                                    </p:column>
                                                    <p:column >
                                                        <h:outputText value="#{pt.hastaUs}"/>
                                                    </p:column>
                                                </p:dataTable>
                                            </div>
                                        </div>
                                        <center>
                                            <p:commandButton icon="fa fa-save" style="width: auto" value="Aceptar" actionListener="#{avaluosPrediales.saveTaxPaymentProperty()}" 
                                                             styleClass="btnStyle" update="frmMain:tbvValorizarProcess:pnlGroupValores frmMain:tbvValorizarProcess:prediosUrbanosRubros" >
                                                <p:confirm header="Confirmación " message="Esta Seguro de Continuar? "/>
                                            </p:commandButton>
                                        </center>
                                    </div>
                                </p:fieldset>
                            </p:tab>


                            <p:tab title="Tasa Seguridad" titleStyle="font-weight: bolder" rendered="false">
                                <div style="width: 70%; margin: auto;">
                                    <p:dataTable id="tasaSeguridadLazyList" var="ts" value="#{avaluosPrediales.lazyTasaSeguridad}"                                                             
                                                 emptyMessage="No existen datos." widgetVar="tasaSeguridadLazyList"
                                                 rows="20" lazy="true"         
                                                 currentPageReportTemplate="Mostrando {startRecord}-{endRecord} de {totalRecords}" 
                                                 paginatorPosition="bottom"
                                                 paginator="true"
                                                 rowsPerPageTemplate="20,40,50"
                                                 paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}">
                                        <f:facet name="header">
                                            Tabla Tasa Seguridad
                                        </f:facet>
                                        <p:column  style="text-align: center; width: 3%" headerText="Tarifa" >
                                            <h:outputText value="#{ts.tarifa}">
                                            </h:outputText>
                                        </p:column>
                                        <p:column  style="text-align: center; width: 3%" headerText="Periodo" >
                                            <h:outputText value="#{ts.periodo}">
                                            </h:outputText>
                                        </p:column>
                                        <p:column  style="text-align: center; width: 3%" headerText="Rango avaluo Desde" >
                                            <h:outputText value="#{ts.desde}">
                                            </h:outputText>
                                        </p:column>
                                        <p:column  style="text-align: center; width: 3%" headerText="Rango avaluo Hasta" >
                                            <h:outputText value="#{ts.hasta}">
                                            </h:outputText>
                                        </p:column>
                                        <p:column  style="text-align: center; width: 3%" headerText="Fecha de Ingreso">
                                            <h:outputText value="#{ts.fechaIngreso}">
                                                <f:convertDateTime pattern="dd-MM-yyyy"/>
                                            </h:outputText>
                                        </p:column>
                                        <p:column  style="text-align: center; width: 3%" headerText="Usuario de Ingreso">
                                            <h:outputText value="#{ts.userIngreso}"/>
                                        </p:column>

                                    </p:dataTable> 
                                </div>

                            </p:tab>


                            <p:tab title="Predios  Rubros a Cobrar" rendered="false">

                                <h:panelGroup id="prediosUrbanosRubros" layout="block" class="Container Wid100 MarTop10" >
                                    <div align="center">
                                        <h:panelGroup   layout="block" class="Container100" >
                                            <p:dataTable id="prediosManzanasRegistered" var="p" value="#{avaluosPrediales.impuestoPrediosList}"
                                                         paginator="true"   rowSelectMode="single"
                                                         emptyMessage="No se encontro ningun predio" rows="20" rowsPerPageTemplate="20,50,100" filterEvent="enter">
            <!--                                    <p:ajax event="rowSelect" listener="#{avaluosPrediales.onRowSelect}" update="frmAvaluo:accPAvaluo:tvAvaluo:pnlMzSelec prediosManzanasList" rendered="frmAvaluo:accPAvaluo:tvAvaluo:pnlMzSelec prediosManzanasList"/>
                                                <p:ajax event="rowUnselect" listener="#{avaluosPrediales.onRowUnselect}" update=":frmAvaluo:accPAvaluo:tvAvaluo:pnlMzSelec prediosManzanasList"  />
                                                <p:ajax event="filter" update="prediosManzanasRegistered" />-->
                                                <f:facet name="header">
                                                    Datos Registrados
                                                </f:facet>
                                                <p:column headerText="Parroquia" filterBy="#{p.parroquia}" filterStyle="width: 45%" filterMatchMode="contains" style="text-align: center" >
                                                    <h:outputText value="#{p.parroquia}" rendered="#{p.parroquia > -1}" />
                                                    <h:outputText value="TODAS" rendered="#{p.parroquia eq -1}" />
                                                </p:column>
                                                <p:column headerText="Zona" filterBy="#{p.zona}" filterStyle="width: 45%" filterMatchMode="contains" style="text-align: center" >
                                                    <h:outputText value="#{p.zona}" rendered="#{p.zona > -1}"/>
                                                    <h:outputText value="TODAS" rendered="#{p.zona eq -1}"/>
                                                </p:column>
                                                <p:column headerText="Sector" filterBy="#{p.sector}" filterStyle="width: 45%" filterMatchMode="contains"  style="text-align: center" >
                                                    <h:outputText value="#{p.sector}" rendered="#{p.sector > -1}" />
                                                    <h:outputText value="TODOS" rendered="#{p.sector eq -1}" />
                                                </p:column>
                                                <p:column headerText="Manzana" filterBy="#{p.mz}" filterStyle="width: 45%" filterMatchMode="contains"  style="text-align: center" >
                                                    <h:outputText value="#{p.mz}" rendered="#{p.mz > -1}" />
                                                    <h:outputText value="TODAS" rendered="#{p.mz eq -1}" />
                                                </p:column>
                                                <p:column headerText="Solares / Lotes" filterBy="#{p.mz}" filterStyle="width: 45%" filterMatchMode="contains"  style="text-align: center" >
                                                    <h:outputText value="#{p.solar}" rendered="#{p.solar > -1}" />
                                                    <h:outputText value="TODOS" rendered="#{p.solar eq -1}" />
                                                </p:column>
                                                <p:column headerText="Banda Impositiva"   style="text-align: center" >
                                                    <h:outputText value="#{p.bandaImpositiva.multiploImpuestoPredial}" />
                                                </p:column>
                                                <p:column headerText="Acciones"   style="text-align: center" >
                                                    <p:commandLink title="Eliminar" actionListener="#{avaluosPrediales.inactivaImpuestoPredial(p)}" update="prediosManzanasRegistered">
                                                        <i class="fa fa-fw fa-remove" style="font-size: 1.5em;color: red;" />
                                                    </p:commandLink>
                                                </p:column>
                                            </p:dataTable>
                                        </h:panelGroup>
                                    </div>
                                </h:panelGroup>

                            </p:tab>

                            <!--PARA EL REPORTE DE LA EMISION PREDIAL-->

                            <p:tab title="Reportes Emision" rendered="false">
                                <center>
                                    <p:fieldset legend="Totales de Emision" toggleable="true" toggleSpeed="500" style="margin-bottom: 10px;width: 30%;">
                                        <h:panelGroup layout="block">
                                            <h:outputText  value="Año Inicial:" style="font-weight: bolder"/>
                                            <p:inputText   value="#{avaluosPrediales.anioEmisionInicio}"
                                                           onkeypress="validateIntegerValueAndFocusNext(event, '')"
                                                           maxlength="4">
                                                <p:keyFilter mask="num"/>
                                            </p:inputText>
                                        </h:panelGroup>

                                        <p:commandButton value="Imprimir Excel" actionListener="#{avaluosPrediales.generarReporteEmision(true, 1)}"
                                                         styleClass="btnStyle" style="width: auto;float: center; font-size: 15px;" icon="fa fa-print"/>
                                        <p:spacer width="25"/>
                                        <p:commandButton  value="Imprimir PDF" actionListener="#{avaluosPrediales.generarReporteEmision(false, 2)}"
                                                          styleClass="btnStyle" style="width: auto;center: right; font-size: 15px;" icon="fa fa-print"/>

                                    </p:fieldset>
                                    <p:fieldset legend="Titulos Prediales" toggleable="true" toggleSpeed="500" style="margin-bottom: 10px;width: 30%;">
                                        <h:panelGroup layout="block">
                                            <h:outputText  value="Año" style="font-weight: bolder"/>
                                            <p:inputText    value="#{avaluosPrediales.anioEmisionInicio}"
                                                            onkeypress="validateIntegerValueAndFocusNext(event, '')"
                                                            maxlength="4">
                                                <p:keyFilter mask="num"/>
                                            </p:inputText>
                                        </h:panelGroup>
                                        <p:commandButton  value="Imprimir Excel" actionListener="#{avaluosPrediales.reportePredioTitulosPrediales(true)}"
                                                          styleClass="btnStyle" style="width: auto;float: center; font-size: 15px;" icon="fa fa-print"/>
                                        <p:spacer width="25"/>
                                        <p:commandButton   value="Imprimir PDF" actionListener="#{avaluosPrediales.reportePredioTitulosPrediales(false)}"
                                                           styleClass="btnStyle" style="width: auto;center: right; font-size: 15px;" icon="fa fa-print"/>

                                    </p:fieldset>
                                </center>
                            </p:tab>

                        </p:tabView>
                    </div>
                </h:form>
            </div>
        </div>


        <p:dialog header="Base Impositiva" widgetVar="dlgDefinirBase" resizable="false" closeOnEscape="true" modal="true" width="70%" appendTo="@(body)">
            <h:form id="frmDefinirBase">

                <p:fieldset legend="Sectorización" toggleable="true" toggleSpeed="500" style="margin-bottom: 10px;">
                    <center>
                        <h:panelGrid columns="8" style="align-self:  center; margin-top:5px;">
                            <p:selectOneRadio  value="#{avaluosPrediales.tipoDefinicion}"  >
                                <f:selectItem itemLabel="Por Parroquia" itemValue="P" />
                                <f:selectItem itemLabel="Por Zona"  itemValue="Z"  />
                                <f:selectItem itemLabel="Por Sector" itemValue="S" />
                                <f:selectItem itemLabel="Por Manzana" itemValue="M"  />
                            </p:selectOneRadio>
                        </h:panelGrid>
                        <h:panelGrid columns="6" style="align-self:  center; margin-top:5px;">
                            <h:outputText  value="Cobro de Bomberos:" style="font-weight: bolder"/>
                            <p:selectBooleanCheckbox value="# {avaluosPrediales.avalImpuestoPredios.cobroBombrero}" />
                            <h:outputText  value="Cobro de Mejoras:" style="font-weight: bolder"/>
                            <p:selectBooleanCheckbox value="# {avaluosPrediales.avalImpuestoPredios.cobroMejoras}" />
                            <h:outputText  value="Pago Solar No Edificado:" style="font-weight: bolder"/>
                            <p:selectBooleanCheckbox value="# {avaluosPrediales.avalImpuestoPredios.pagoSolarNoEdificado}" />

                        </h:panelGrid>
                        <h:panelGrid columns="6" style="align-self:  center; margin-top:5px;">
                            <h:outputText  value="Año Inicial:" style="font-weight: bolder"/>
                            <p:column><p:inputText   value="#{avaluosPrediales.avalImpuestoPredios.anioInicio}"
                                                     onkeypress="validateIntegerValueAndFocusNext(event, '')"
                                                     style="text-align: center; width: 89%" maxlength="4"/></p:column>
                            <p:spacer height="5px"/>
                            <h:outputText  value="Año Fin:" style="font-weight: bolder"/>
                            <p:column><p:inputText  value="#{avaluosPrediales.avalImpuestoPredios.anioFin}"
                                                    onkeypress="validateIntegerValueAndFocusNext(event, '')"
                                                    style="text-align: center; width: 89%" maxlength="4"/></p:column>
                        </h:panelGrid>
                    </center>
                </p:fieldset>

                <br></br>
                <p:dataTable id="dtavalBandaImpositivaList" var="pt" value="#{avaluosPrediales.avalBandaImpositivaList}"
                             emptyMessage="No existen datos." selection="#{avaluosPrediales.avalBandaImpositivaSeleccionada}" rowKey="#{pt.id}" selectionMode="single"
                             rows="20" lazy="true"
                             paginatorPosition="bottom"
                             rowsPerPageTemplate="20,40,50"
                             paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}">

                    <f:facet name="header">
                        Tabla Base Imponible
                    </f:facet>
                    <p:columnGroup type="header">
                        <p:row>
                            <p:column colspan="2" headerText="Base Imponible" />
                            <p:column colspan="2" headerText="Años" />
                        </p:row>

                        <p:row>
                            <p:column  headerText="Desde" />
                            <p:column  headerText="Hasta" />
                        </p:row>


                    </p:columnGroup>

                    <p:column  style="text-align: center; width: 3%" >
                        <h:outputText value="#{pt.multiploImpuestoPredial}"><f:convertNumber pattern="##############.####" locale="us"/></h:outputText>
                    </p:column>
                    <p:column  style="text-align: center; width: 3%" >
                        <h:outputText value="#{pt.anioInicio}"/>
                    </p:column>
                    <p:column  style="text-align: center; width: 3%" >
                        <h:outputText value="#{pt.anioFin}"/>
                    </p:column>

                </p:dataTable>
                <br></br>
                <center>
                    <p:commandButton  style="width: auto" value="Aceptar" actionListener="#{avaluosPrediales.definirBaseImpositivaPorParroquiaSectorMz(null)}"
                                      oncomplete="PF('dlgDefinirBase').hide()" styleClass="btnStyle" icon="fa fa-check">
                        <p:confirm header="Confirmación " message="Esta Seguro de Continuar? "/>
                    </p:commandButton>
                    <p:spacer height="5px"/>
                    <p:commandButton style="width: auto" value="Cancelar" oncomplete="PF('dlgDefinirBase').hide()" styleClass="btnStyle"/>
                </center>
            </h:form>
        </p:dialog>


        <p:dialog header="Detalle del calculo" widgetVar="dlgRecalculo" resizable="false" closeOnEscape="true" modal="true" width="60%" appendTo="@(body)">
            <h:form id="frmRecalculo">
                <p:panelGrid styleClass="noBorder" columns="4" layout="grid">
                    <p:outputLabel value="Avaluo Solar :" style="font-size: 14px;font-weight: bolder;"/>
                    <h:outputText value="# {avaluosPrediales.valoracion.avaluoSolar}" />
                    <p:outputLabel value="Avaluo Construccion :" style="font-size: 14px;font-weight: bolder;"/>
                    <h:outputText value="# {avaluosPrediales.valoracion.avaluoEdificacion}" />
                    <p:outputLabel value="Avaluo Municipal:" style="font-size: 14px;font-weight: bolder;"/>
                    <h:outputText value="# {avaluosPrediales.valoracion.avaluoMunicipal}" />
                    <p:outputLabel value="Impuesto predial :" style="font-size: 14px;font-weight: bolder;"/>
                    <h:outputText value="# {avaluosPrediales.valoracion.ipAct}" />
                    <p:outputLabel value="Tasa mantenimiento :" style="font-size: 14px;font-weight: bolder;"/>
                    <h:outputText value="# {avaluosPrediales.valoracion.tasaMant}" />
                    <p:outputLabel value="Bomberos :" style="font-size: 14px;font-weight: bolder;"/>
                    <h:outputText value="# {avaluosPrediales.valoracion.rbAct}" />
                    <p:outputLabel value="Recargo solar no edificado :" style="font-size: 14px;font-weight: bolder;"/>
                    <h:outputText value="# {avaluosPrediales.valoracion.sneAct}" />
                    <p:outputLabel value="Banda Impositiva :" style="font-size: 14px;font-weight: bolder;"/>
                    <h:outputText value="# {avaluosPrediales.valoracion.bandaImpositiva}" />
                    <p:outputLabel value="Factor Correlacion :" style="font-size: 14px;font-weight: bolder;"/>
                    <h:outputText value="# {avaluosPrediales.valoracion.factCorrelacion}" />
                    <p:outputLabel value="Valor M2 :" style="font-size: 14px;font-weight: bolder;"/>
                    <h:outputText value="# {avaluosPrediales.valoracion.valorM2Subsector}" />
                    <p:outputLabel value="Factor geometrico :" style="font-size: 14px;font-weight: bolder;"/>
                    <h:outputText value="# {avaluosPrediales.valoracion.factGeometrico}" />
                </p:panelGrid>
                <center>
                    <p:commandButton value="Actualizar Predio" actionListener="# {avaluosPrediales.actualizarPredio()}" oncomplete="PF('dlgRecalculo').hide()" styleClass="btnStyle" style="width: auto"/>
                    <p:commandButton value="Emitir avaluo" actionListener="# {avaluosPrediales.emitirAvaluo()}" oncomplete="PF('dlgRecalculo').hide()" styleClass="btnStyle" style="width: auto"/>
                </center>
            </h:form>
        </p:dialog>

        <p:dialog header="Detalle de las Emisiones" widgetVar="dlgEmisiones" resizable="false" closeOnEscape="true" modal="true" width="40%" appendTo="@(body)">
            <h:form id="frmEmisiones">
                <p:carousel  value="#{avaluosPrediales.liquidacionesGeneradas}" var="emision" itemStyle="height:200px;text-align:center" numVisible="1" easing="easeOutBounce" >
                    <h:panelGrid columns="2" style="width:100%" columnClasses="label,value">

                        <h:outputText value="Propietario(s)"/>
                        <p:outputLabel value="#{emision.comprador==null?emision.nombreComprador :emision.comprador.apellido}
                                       #{emision.comprador.nombre}
                                       #{emision.comprador.razonSocial}#{emision.comprador.nombreComercial}"
                                       title="#{emision.comprador.identificacionCompleta}"/>
                        <h:outputText value="Total a pagar"/>
                        <p:inputText value="#{emision.totalPago}" readonly="true"/>

                    </h:panelGrid>

                    <center>
                        <h1 style="color: blue; font-size: 20px;margin-top: 20px;">#{emision.idLiquidacion}</h1>    
                    </center>
                    <!--<p:dataList value="# {emision.renDetLiquidacionCollection}" var="t2" type="ordered" >
                        <f:facet name="header">
                            Rubros
                        </f:facet>
                        # {t2.rubro.descripcion}: # {t2.valor}
                    </p:dataList>-->
                </p:carousel>
            </h:form>

        </p:dialog>
    </ui:define>
</ui:composition>