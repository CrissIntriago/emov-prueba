<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:sigef="http://xmlns.jcp.org/jsf/composite/sigef/components"
                template="/WEB-INF/template/template.xhtml">
    <f:view encoding="UTF-8"></f:view>
    <ui:define name="title">
        Genenerar formulario 107
    </ui:define>
    <ui:param name="tittle" value="Genenerar formulario 107" />
    <ui:define name="content">
        <div class="ui-g ui-fluid">
            <div class="ui-g-12" >
                <h:form id="formMain" prependId="false">
                    <p:panelGrid columns="2" layout="grid" styleClass="ui-panelgrid-blank form-group">
                        <p:fieldset legend="Datos de la entidad">
                            <p:panelGrid columns="3" layout="grid" styleClass="ui-panelgrid-blank form-group">
                                <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                    <p:outputLabel for="@next" value="RUC:" style="width: 100%;"/>
                                    <p:inputText id="ruc" class="panelInput" style="width: 100%" onkeypress="focusNextOnEnter(event, 'ruc')"
                                                 value="#{thFormulario107View.datosGeneralesEntidad.ruc}" readonly="true">
                                    </p:inputText>
                                </h:panelGroup>
                                <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                    <p:outputLabel for="@next" value="Provincia:" style="width: 100%;"/>
                                    <p:inputText id="provincia" class="panelInput" style="width: 100%" onkeypress="focusNextOnEnter(event, 'provincia')"
                                                 value="#{thFormulario107View.datosGeneralesEntidad.provincia.provincia}" readonly="true">
                                    </p:inputText>
                                </h:panelGroup>
                                <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                    <p:outputLabel for="@next" value="Cantón:" style="width: 100%;"/>
                                    <p:inputText id="canton" class="panelInput" style="width: 100%" onkeypress="focusNextOnEnter(event, 'canton')"
                                                 value="#{thFormulario107View.datosGeneralesEntidad.canton.canton}" readonly="true">
                                    </p:inputText>
                                </h:panelGroup>                                
                            </p:panelGrid>
                            <p:panelGrid columns="1" layout="grid" styleClass="ui-panelgrid-blank form-group">
                                <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                    <p:outputLabel for="@next" value="Razón social:" style="width: 100%;"/>
                                    <p:inputText id="nombreEntidad" class="panelInput" style="width: 100%" onkeypress="focusNextOnEnter(event, 'nombreEntidad')"
                                                 value="#{thFormulario107View.datosGeneralesEntidad.nombreEntidad}" readonly="true">
                                    </p:inputText>
                                </h:panelGroup>
                            </p:panelGrid>
                        </p:fieldset>
                        <p:fieldset legend="Configuración">
                            <p:panelGrid columns="3" layout="grid" styleClass="ui-panelgrid-blank form-group">
                                <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                    <p:outputLabel for="@next" value="Periodo fiscal:" style="font-weight: bold"/>
                                    <p:selectOneMenu id="thPeriodo" value="#{thFormulario107View.opcionBusqueda.anio}"
                                                     filter="true" filterMatchMode="contains" style="width: 100%">
                                        <f:selectItem itemLabel="-Seleccionar-" itemValue="#{null}" noSelectionOption="true" />
                                        <f:selectItems value="#{thFormulario107View.periodos}" var="item" itemValue="#{item}"/>
                                        <p:ajax process="@this" />
                                    </p:selectOneMenu>
                                </h:panelGroup>
                                <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                    <p:outputLabel for="@next" value="Fecha de emisión:" style="font-weight: bold"/>
                                    <p:calendar id="fechaEmision"  pattern="dd/MM/yyyy" navigator="true" yearRange="c-100:c+100" locale="es" 
                                                readonlyInput="true" onkeypress="focusNextOnEnter(event, 'fechaEmision')"
                                                value="#{thFormulario107View.fechaEmision}" style="width: 100%">
                                        <p:ajax event="dateSelect"/>
                                    </p:calendar> 
                                </h:panelGroup>
                                <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                    <p:commandButton value="Cargar establecimiento" process="@this"
                                                     icon="fa fa-plus" actionListener="#{thFormulario107View.findEstablecimiento()}"
                                                     styleClass="Fs16" style="width: 100%;background: green"/>
                                </h:panelGroup>
                            </p:panelGrid>
                            <p:panelGrid columns="1" layout="grid" styleClass="ui-panelgrid-blank form-group" id="idPanelEntidad">
                                <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                    <p:outputLabel for="@next" value="Establecimiento:" style="width: 100%;"/>
                                    <p:inputText id="establecimiento" class="panelInput" style="width: 100%" onkeypress="focusNextOnEnter(event, 'establecimiento')"
                                                 value="#{thFormulario107View.entidad.establecimiento} - #{thFormulario107View.entidad.nombreEntidad}" readonly="true">
                                    </p:inputText>
                                </h:panelGroup>
                            </p:panelGrid>
                        </p:fieldset>
                    </p:panelGrid>
                    <p:panelGrid columns="6" layout="grid" styleClass="ui-panelgrid-blank form-group">
                        <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                            <p:commandButton value="Generar XML" process="@this" rendered="true"
                                             icon="fa fa-file-o" actionListener="#{thFormulario107View.generarXML()}"
                                             styleClass="Fs16" style="width: 100%;"/>
                        </h:panelGroup>
                    </p:panelGrid>
                    <p:panelGrid columns="1" layout="grid" styleClass="ui-panelgrid-blank form-group">
                        <p:dataTable  id="servidorTable" widgetVar="servidorTable" var="servidor" value="#{thFormulario107View.servidorLazy}" 
                                      paginator="true" rows="50" style="width: 100%;" rowKey="#{servidor.id}"
                                      paginatorPosition="bottom" currentPageReportTemplate="Mostrando {startRecord}-{endRecord} de {totalRecords}"
                                      paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                      rowsPerPageTemplate="50,60,70,100" lazy="true" selectionMode="single" 
                                      emptyMessage="No existen datos con el criterio de búsqueda especificado">
                            <f:facet name="header">
                                Listado de servidores registrados
                            </f:facet>
                            <p:column headerText="Identificación" style="width: 10%;text-align: center" filterBy="#{servidor.persona.identificacion}" filterMatchMode="contains">
                                <h:outputText value="#{servidor.persona.identificacion}" />
                            </p:column>
                            <p:column headerText="Nombres y apellido" style="width: 20%;" filterBy="#{servidor.persona.nombreCompleltoSql}" filterMatchMode="contains">
                                <h:outputText value="#{servidor.persona.nombreCompleltoSql}" />
                            </p:column>
                            <p:column headerText="Fecha de ingreso" style="width: 10%;text-align: center" sortBy="#{servidor.fechaIngreso}">
                                <h:outputText value="#{servidor.fechaIngreso}" >
                                    <f:convertDateTime pattern="dd-MM-yyyy"/>
                                </h:outputText>
                            </p:column>
                            <p:column headerText="Fecha de salida" style="width: 10%;text-align: center" sortBy="#{servidor.fechaSalida}">
                                <h:outputText value="#{servidor.fechaSalida}" >
                                    <f:convertDateTime pattern="dd-MM-yyyy"/>
                                </h:outputText>
                            </p:column>
                            <p:column headerText="Estado" style="width: 10%;text-align: center" filterBy="#{servidor.estado}">
                                <f:facet name="filter">
                                    <p:selectOneMenu onchange="PF('servidorTable').filter()" styleClass="custom-filter">
                                        <f:converter converterId="javax.faces.Boolean" />
                                        <f:selectItem itemLabel="Todos" itemValue=""/>
                                        <f:selectItem itemLabel="ACTIVO" itemValue="true" />
                                        <f:selectItem itemLabel="INACTIVO" itemValue="false" />
                                    </p:selectOneMenu>
                                </f:facet>
                                <h:outputText value="#{servidor.estado?'ACTIVO':'INACTIVO'}" />
                            </p:column>
                            <p:column headerText="Jubilado" style="width: 10%;text-align: center" filterBy="#{servidor.jubilado}">
                                <f:facet name="filter">
                                    <p:selectOneMenu onchange="PF('servidorTable').filter()" styleClass="custom-filter">
                                        <f:converter converterId="javax.faces.Boolean" />
                                        <f:selectItem itemLabel="Todos" itemValue=""/>
                                        <f:selectItem itemLabel="SI" itemValue="true" />
                                        <f:selectItem itemLabel="NO" itemValue="false" />
                                    </p:selectOneMenu>
                                </f:facet>
                                <h:outputText value="#{servidor.jubilado?'SI':'NO'}" />
                            </p:column>
                            <p:column headerText="Acciones" style="width: 10%;text-align: center">
                                <p:commandLink title="Generar formulario" process="@this" actionListener="#{thFormulario107View.printReport(servidor,false)}">
                                    <i class="fa fa-file-pdf-o" style="font-size: 1.5em; margin-right: 8px; color: red;"></i>
                                </p:commandLink> 
                                <p:commandLink title="Generar reporte detallado" process="@this" actionListener="#{thFormulario107View.printReport(servidor,true)}">
                                    <i class="fa fa-file-pdf-o" style="font-size: 1.5em; margin-right: 8px; color: red;"></i>
                                </p:commandLink> 
                            </p:column>
                        </p:dataTable>
                    </p:panelGrid>
                </h:form>
            </div>
        </div>
        <p:dialog id="entidadDlg" header="Listado de establecimientos" widgetVar="entidadDlg" position="center"
                  modal="true" showEffect="fade" hideEffect="fade" resizable="false" width="40%">
            <h:form prependId="false" id="entidadForm">
                <p:dataTable  id="entidadesTable" widgetVar="entidadesTable" var="entidades" 
                              value="#{thFormulario107View.entidadLazy}" 
                              scrollable="true" scrollHeight="auto" lazy="true" rows="2000000" style="width: 100%" rowKey="#{entidades.id}"
                              emptyMessage="No existen cuentas con el criterio de búsqueda especificado">
                    <p:column headerText="No. establecimiento" filterBy="#{entidades.establecimiento}" filterMatchMode="contains" style="width: 15%;text-align: center">
                        <h:outputText value="#{entidades.establecimiento}" />
                    </p:column>
                    <p:column headerText="Nom. establecimiento" filterBy="#{entidades.nombreEntidad}" filterMatchMode="contains" style="width: 70%;">
                        <h:outputText value="#{entidades.nombreEntidad}" />
                    </p:column>
                    <p:column headerText="Seleccionar"  style="width: 15%;text-align: center">
                        <p:commandLink actionListener="#{thFormulario107View.entidadSeleccionada(entidades)}" title="Seleccionar" process="@this">
                            <i class="fa fa-plus-circle" style="font-size: 1.5em; margin-right: 8px; color: #33cc00;"></i>
                        </p:commandLink>
                    </p:column>  
                </p:dataTable>
            </h:form>       
        </p:dialog>
    </ui:define>
</ui:composition>
