<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:sigef="http://xmlns.jcp.org/jsf/composite/sigef/components"
                template="/WEB-INF/template/template.xhtml">
    <ui:define name="title">
        Registro de facturas
    </ui:define>
    <ui:param name="tittle" value="Registro de facturas"/>
    <ui:define name="content">
        <div class="ui-g ui-fluid">
            <div class="ui-g-12" >
                <h:form id="formMain" prependId="false">
                    <p:outputPanel id="createEditPanel" >
                        <p:fieldset id="fieldset" legend="Formulario de registro" collapsed="#{contFacturasView.collapsed}" toggleable="true" toggleSpeed="500" style="margin-bottom: 15px">
                            <p:panelGrid columns="3" layout="grid" styleClass="ui-panelgrid-blank form-group">
                                <p:panelGrid columns="3" layout="grid" styleClass="ui-panelgrid-blank form-group">
                                    <h:panelGroup layout="block" style="width: 100%;">
                                        <p:outputLabel for="@next" value="No. de entidad"  style="font-weight: bold"/>
                                        <p:inputText  id="entidad"
                                                      placeholder="001"
                                                      maxlength="3"
                                                      style="width: 100%;margin-right: 15px"
                                                      value="#{contFacturasView.factura.entidad}"
                                                      onkeypress="focusNextOnEnter(event, 'entidad')">
                                            <p:ajax process="entidad" update="entidad"
                                                    listener="#{contFacturasView.formatNumeroComprobante()}"/> 
                                        </p:inputText>
                                    </h:panelGroup>
                                    <h:panelGroup layout="block" style="width: 100%;">
                                        <p:outputLabel for="@next" value="No. de establecimiento"  style="font-weight: bold"/>
                                        <p:inputText  id="establecimiento"
                                                      placeholder="001"
                                                      maxlength="3"
                                                      style="width: 100%;margin-right: 15px"
                                                      value="#{contFacturasView.factura.establecimiento}"
                                                      onkeypress="focusNextOnEnter(event, 'establecimiento')">
                                            <p:ajax process="establecimiento" update="establecimiento"
                                                    listener="#{contFacturasView.formatNumeroComprobante()}"/> 
                                        </p:inputText>
                                    </h:panelGroup>
                                    <h:panelGroup layout="block" style="width: 100%;">
                                        <p:outputLabel for="@next" value="No. secuencia"  style="font-weight: bold"/>
                                        <p:inputText  id="secuencia"
                                                      placeholder="00000001"
                                                      maxlength="9"
                                                      style="width: 100%;margin-right: 15px"
                                                      value="#{contFacturasView.factura.secuencia}"
                                                      onkeypress="focusNextOnEnter(event, 'secuencia')">
                                            <p:ajax process="secuencia" update="secuencia"
                                                    listener="#{contFacturasView.formatNumeroComprobante()}"/> 
                                        </p:inputText>
                                    </h:panelGroup>
                                </p:panelGrid>
                                <p:panelGrid columns="1" layout="grid" styleClass="ui-panelgrid-blank form-group">
                                    <h:panelGroup layout="block" style="width: 100%;">
                                        <p:outputLabel for="@next" value="No. Autorización:"  style="font-weight: bold"/>
                                        <p:inputText id="numAutorizacion" value="#{contFacturasView.factura.numAutorizacion}"
                                                     style="width: 100%" onkeypress="focusNextOnEnter(event, 'numAutorizacion')">
                                            <p:keyFilter regEx="/[\d]/" preventPaste="false"/>
                                        </p:inputText>
                                    </h:panelGroup>
                                </p:panelGrid>
                                <p:panelGrid columns="2" layout="grid" styleClass="ui-panelgrid-blank form-group">
                                    <h:panelGroup layout="block" style="width: 100%;">
                                        <p:outputLabel for="@next" value="Fecha de emisión:"  style="font-weight: bold"/>
                                        <p:calendar id="fechaFactura" pattern="dd/MM/yyyy" readonly="false" navigator="true" yearRange="c-100:c+100"
                                                    value="#{contFacturasView.factura.fechaFactura}" style="width: 60%" locale="es"/>
                                    </h:panelGroup>
                                    <h:panelGroup layout="block" style="width: 100%;">
                                        <p:outputLabel for="@next" value="Fecha de caducidad:"  style="font-weight: bold"/>
                                        <p:calendar id="fechaCaducidad" pattern="dd/MM/yyyy" readonly="false" navigator="true" yearRange="c-100:c+100"
                                                    value="#{contFacturasView.factura.fechaCaducidad}" style="width: 60%" locale="es"/>
                                    </h:panelGroup>
                                </p:panelGrid>
                            </p:panelGrid>
                            <p:panelGrid columns="2" layout="grid" styleClass="ui-panelgrid-blank form-group">
                                <p:fieldset legend="Datos del proveedor">
                                    <p:panelGrid columns="3" layout="grid" styleClass="ui-panelgrid-blank form-group" id="gridProveedor">
                                        <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                            <p:commandButton value="Agregar Proveedor" icon="fa fa-user" actionListener="#{contFacturasView.openDlgProveedor()}"
                                                             styleClass="Fs16" style="width: 100%;" update="dataTableProveedor"/> 
                                        </h:panelGroup>
                                        <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                            <p:outputLabel for="@next" value="RUC/C.I.:"  style="font-weight: bold"/>
                                            <p:inputText id="identificacion" value="#{contFacturasView.factura.proveedor.cliente.identificacionCompleta}"
                                                         style="width: 100%" onkeypress="focusNextOnEnter(event, 'identificacion')" readonly="true">
                                                <p:keyFilter regEx="/[\d]/" preventPaste="false"/>
                                            </p:inputText>
                                        </h:panelGroup>
                                        <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                            <p:outputLabel for="@next" value="Proveedor:"  style="font-weight: bold"/>
                                            <p:inputText id="nombreCompleltoSql" value="#{contFacturasView.factura.proveedor.cliente.nombreCompleltoSql}"
                                                         style="width: 100%" onkeypress="focusNextOnEnter(event, 'nombreCompleltoSql')" readonly="true">
                                            </p:inputText>
                                        </h:panelGroup>
                                    </p:panelGrid>
                                </p:fieldset>
                                <p:fieldset legend="Datos Adicionales de la Factura:" id="gridAdicionales">
                                    <p:panelGrid columns="4" layout="grid" styleClass="ui-panelgrid-blank form-group">
                                        <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                            <p:outputLabel for="@next" value="Retenido:"  style="font-weight: bold"/><br/>
                                            <p:selectBooleanCheckbox id="retenida" value="#{contFacturasView.factura.retenida}"/>
                                        </h:panelGroup>
                                        <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                            <p:outputLabel for="@next" value="Factura Electronica:"  style="font-weight: bold"/><br/>
                                            <p:selectBooleanCheckbox id="facturaElectronica" value="#{contFacturasView.factura.facturaElectronica}"/>
                                        </h:panelGroup>
                                        <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                            <p:outputLabel for="@next" value="IVA:"  style="font-weight: bold"/><br/>
                                            <p:inputNumber id="retencionIva"  style="width: 100%"
                                                           value="#{contFacturasView.factura.retencionIva}" readonly="true"
                                                           decimalSeparator="," thousandSeparator="." symbol="$"
                                                           onkeypress="focusNextOnEnter(event, 'retencionIva')">
                                            </p:inputNumber>
                                        </h:panelGroup>
                                        <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                            <p:outputLabel for="@next" value="RENTA:"  style="font-weight: bold"/><br/>
                                            <p:inputNumber id="retencionRenta"  style="width: 100%"
                                                           value="#{contFacturasView.factura.retencionRenta}" readonly="true"
                                                           decimalSeparator="," thousandSeparator="." symbol="$"
                                                           onkeypress="focusNextOnEnter(event, 'retencionRenta')">
                                            </p:inputNumber>
                                        </h:panelGroup>
                                    </p:panelGrid> 
                                </p:fieldset>
                            </p:panelGrid>
                            <p:panelGrid columns="1" layout="grid" styleClass="ui-panelgrid-blank form-group">
                                <p:fieldset legend="Datos Adicionales de la Factura:" id="idValoresfactura">
                                    <p:panelGrid columns="6" layout="grid" styleClass="ui-panelgrid-blank form-group">
                                        <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                            <p:outputLabel for="@next" value="Base imponible IVA 0%:" style="font-weight: bold"/>
                                            <p:inputNumber id="baseImponibleIva"  style="width: 100%"
                                                           value="#{contFacturasView.factura.baseImponibleIva}"
                                                           decimalSeparator="," thousandSeparator="." symbol="$"
                                                           readonly="false" onkeypress="focusNextOnEnter(event, 'baseImponibleIva')">
                                                <p:ajax update="subtotalRenta" process="baseImponibleIva" listener="#{contFacturasView.calcularSubTotal(false)}"/>
                                            </p:inputNumber>
                                        </h:panelGroup>
                                        <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                            <p:outputLabel for="@next" value="Base imponible IVA diferente de 0%:" style="font-weight: bold"/>
                                            <p:inputNumber id="baseImponibleDiferente"  style="width: 100%"
                                                           value="#{contFacturasView.factura.baseImponibleDiferente}"
                                                           decimalSeparator="," thousandSeparator="." symbol="$"
                                                           readonly="false" onkeypress="focusNextOnEnter(event, 'baseImponibleDiferente')">
                                                <p:ajax update="subtotalRenta,montoIva" process="baseImponibleDiferente" listener="#{contFacturasView.calcularSubTotal(true)}"/>
                                            </p:inputNumber>
                                        </h:panelGroup>
                                        <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                            <p:outputLabel for="@next" value="Subtotal:"  style="font-weight: bold"/><br/>
                                            <p:inputNumber id="subtotalRenta"  style="width: 100%"
                                                           value="#{contFacturasView.factura.subtotalRenta}" readonly="true"
                                                           decimalSeparator="," thousandSeparator="." symbol="$"
                                                           onkeypress="focusNextOnEnter(event, 'subtotalRenta')">
                                            </p:inputNumber>
                                        </h:panelGroup>
                                        <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                            <p:outputLabel for="@next" value="Monto IVA:"  style="font-weight: bold"/><br/>
                                            <p:inputNumber id="montoIva"  style="width: 100%"
                                                           value="#{contFacturasView.factura.montoIva}" readonly="true"
                                                           decimalSeparator="," thousandSeparator="." symbol="$"
                                                           onkeypress="focusNextOnEnter(event, 'montoIva')"/>
                                        </h:panelGroup>
                                        <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                            <p:outputLabel for="@next" value="Monto ICE:"  style="font-weight: bold"/><br/>
                                            <p:inputNumber id="montoIce"  style="width: 100%"
                                                           value="#{contFacturasView.factura.montoIce}"
                                                           decimalSeparator="," thousandSeparator="." symbol="$"
                                                           readonly="false" onkeypress="focusNextOnEnter(event, 'montoIce')"/>
                                        </h:panelGroup>
                                        <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                            <p:outputLabel for="@next" value="Sustento comprobante:"  style="font-weight: bold"/>
                                            <p:selectOneMenu id="idSustento" value="#{contFacturasView.factura.codSustento}"
                                                             filter="true" filterMatchMode="startsWith" style="width: 100%">
                                                <f:selectItem itemLabel="-Seleccionar-" itemValue="#{null}" noSelectionOption="true" />
                                                <f:selectItems value="#{contFacturasView.sustentosComprobantes}"  var="sustcomp"
                                                               itemLabel="#{sustcomp.codigo} - #{sustcomp.tipoSustento}"
                                                               itemValue="#{sustcomp.codigo}"/>
                                            </p:selectOneMenu>
                                        </h:panelGroup>
                                    </p:panelGrid>
                                </p:fieldset>
                            </p:panelGrid>
                            <p:panelGrid columns="1" layout="grid" styleClass="ui-panelgrid-blank form-group">
                                <p:fieldset legend="Forma de pago">
                                    <p:panelGrid columns="2" layout="grid" styleClass="ui-panelgrid-blank form-group">
                                        <p:panelGrid columns="2" layout="grid" styleClass="ui-panelgrid-blank form-group">
                                            <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                                <p:outputLabel for="pagos_A"  value="Pago a:" style="width: 100%"/><br/>
                                                <p:selectOneMenu id="pagos_A" style="width: 100%"
                                                                 value="#{contFacturasView.factura.pagoExterior.pagoLocExt}" required="true">
                                                    <f:selectItem itemLabel="PAGO A RESIDENTE/ESTABLECIMIENTO PERMANENTE" 
                                                                  itemValue="01"/>
                                                    <f:selectItem itemLabel="PAGO A NO RESIDENTE" 
                                                                  itemValue="02"/>
                                                    <p:ajax listener="#{contFacturasView.loadDatosPago}" process="pagos_A"

                                                            update="typereg,paisRegimenGeneral,paisParaisoFiscal,
                                                            denomi,paisesPago,dobleTributacion,normaLegal"/>
                                                </p:selectOneMenu>
                                            </h:panelGroup>
                                            <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                                <p:outputLabel for="typereg"  value="Tipo Régimen:" style="width: 100%"/><br/>
                                                <p:selectOneMenu id="typereg" style="width: 100%"
                                                                 value="#{contFacturasView.factura.pagoExterior.tipoRegi}"
                                                                 disabled="#{contFacturasView.disabledPago}">
                                                    <f:selectItem itemLabel="Seleccione" itemValue="#{null}" 
                                                                  noSelectionOption="true" />
                                                    <f:selectItem itemLabel="Régimen general" 
                                                                  itemValue="01"/>
                                                    <f:selectItem itemLabel="Paraíso fiscal" 
                                                                  itemValue="02"/>
                                                    <f:selectItem itemLabel="Régimen fiscal preferente o jurisdicción de menor imposición" 
                                                                  itemValue="03"/>
                                                    <p:ajax listener="#{contFacturasView.loadDatosRegimenExterior}" 
                                                            update="typereg,paisRegimenGeneral,paisParaisoFiscal,
                                                            denomi,paisesPago,dobleTributacion,normaLegal"/>
                                                </p:selectOneMenu>
                                            </h:panelGroup>
                                            <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                                <p:outputLabel for="paisRegimenGeneral"  value="Régimen General:" style="width: 100%"/>
                                                <p:selectOneMenu id="paisRegimenGeneral" style="width: 100%"
                                                                 value="#{contFacturasView.factura.pagoExterior.paisEfecPagoGen}"
                                                                 disabled="#{contFacturasView.disabledRegimenGeneral}"
                                                                 filter="true" filterMatchMode="startsWith">
                                                    <f:selectItem itemLabel="Seleccione" itemValue="#{null}" 
                                                                  noSelectionOption="true" />
                                                    <f:selectItems value="#{contFacturasView.paises}"
                                                                   var="paises"
                                                                   itemLabel="#{paises.descripcion}"
                                                                   itemValue="#{paises.codigo}"/>
                                                </p:selectOneMenu>
                                            </h:panelGroup>
                                            <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                                <p:outputLabel for="paisParaisoFiscal"  value="Paraíso Fiscal:" style="width: 100%"/><br/>
                                                <p:selectOneMenu id="paisParaisoFiscal" style="width: 100%"
                                                                 value="#{contFacturasView.factura.pagoExterior.paisEfecPagoParFis}"
                                                                 disabled="#{contFacturasView.disabledParaisoFiscal}"
                                                                 filter="true" filterMatchMode="startsWith">
                                                    <f:selectItem itemLabel="Seleccione" itemValue="#{null}" 
                                                                  noSelectionOption="true" />
                                                    <f:selectItems value="#{contFacturasView.paisParaisoFiscal}"
                                                                   var="paisParaisoFiscal"
                                                                   itemLabel="#{paisParaisoFiscal.paisElegir}"
                                                                   itemValue="#{paisParaisoFiscal.codigo}"/>
                                                </p:selectOneMenu>
                                            </h:panelGroup>
                                            <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                                <p:outputLabel for="denomi"  value="Denominación" style="width: 100%"/><br/>
                                                <p:inputText id="denomi" value="#{contFacturasView.factura.pagoExterior.denopago}" style="width: 100%"
                                                             disabled="#{contFacturasView.disabledDenominacion}"/>
                                            </h:panelGroup>
                                            <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                                <p:outputLabel for="paisesPago"  value="País" style="width: 100%"/><br/>
                                                <p:selectOneMenu id="paisesPago" style="width: 100%"
                                                                 value="#{contFacturasView.factura.pagoExterior.paisEfecPago}"
                                                                 disabled="#{contFacturasView.disabledDenominacion}"
                                                                 filter="true" filterMatchMode="startsWith">
                                                    <f:selectItem itemLabel="Seleccione" itemValue="#{null}" 
                                                                  noSelectionOption="true" />
                                                    <f:selectItems value="#{contFacturasView.paises}"
                                                                   var="paisEfecP"
                                                                   itemLabel="#{paisEfecP.descripcion}"
                                                                   itemValue="#{paisEfecP.codigo}"/>
                                                </p:selectOneMenu>
                                            </h:panelGroup>
                                            <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                                <p:outputLabel for="dobleTributacion"  
                                                               value="¿Aplica convenio de doble tributación?" 
                                                               style="width: 100%"/>
                                                <p:selectOneRadio id="dobleTributacion" 
                                                                  value="#{contFacturasView.factura.pagoExterior.aplicConvDobTrib}" 
                                                                  unselectable="true"
                                                                  disabled="#{contFacturasView.disabledPago}">
                                                    <f:selectItem itemLabel="SI" itemValue="NO" />
                                                    <f:selectItem itemLabel="NO" itemValue="SI" />
                                                </p:selectOneRadio>
                                            </h:panelGroup>
                                            <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                                <p:outputLabel for="normaLegal"  
                                                               value="¿Pago sujeto a retención en aplicación de la norma legal?" 
                                                               style="width: 100%"/>
                                                <p:selectOneRadio id="normaLegal" 
                                                                  value="#{contFacturasView.factura.pagoExterior.pagExtSujRetNorLeg}"
                                                                  unselectable="true"
                                                                  disabled="#{contFacturasView.disabledPago}">
                                                    <f:selectItem itemLabel="SI" itemValue="NO" />
                                                    <f:selectItem itemLabel="NO" itemValue="SI"/>
                                                </p:selectOneRadio>
                                            </h:panelGroup>
                                        </p:panelGrid>
                                        <p:panelGrid columns="1" layout="grid" styleClass="ui-panelgrid-blank form-group">
                                            <p:panelGrid columns="2" layout="grid" styleClass="ui-panelgrid-blank form-group">
                                                <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                                    <p:outputLabel value="Formas de Pago" 
                                                                   style="width: 100%"/>
                                                    <p:selectOneMenu id="select-forma-pago" style="width: 100%"
                                                                     value="#{contFacturasView.formaPagoSelection}"
                                                                     converter="#{utilConverter}">
                                                        <f:selectItem itemLabel="Seleccione" itemValue="#{null}" 
                                                                      noSelectionOption="true" />
                                                        <f:selectItems value="#{contFacturasView.formasPagos}"
                                                                       var="formaPagos"
                                                                       itemLabel="#{formaPagos.descripcion}"
                                                                       itemValue="#{formaPagos}"/>
                                                        <p:ajax update="select-forma-pago,dataTableFormasPago" listener="#{contFacturasView.aggFormasPago}"
                                                                process="select-forma-pago"/>
                                                    </p:selectOneMenu>
                                                </h:panelGroup>
                                            </p:panelGrid>
                                            <p:panelGrid columns="1" layout="grid" styleClass="ui-panelgrid-blank form-group">
                                                <p:dataTable  id="dataTableFormasPago" rowIndexVar="index"
                                                              widgetVar="dataTableFormasPago"
                                                              var="formasPago"  
                                                              value="#{contFacturasView.facturaFormasPago}"
                                                              style="font-size: 11px" tableStyle="table-layout:auto">
                                                    <p:column headerText="Codigo">
                                                        <h:outputText value="#{formasPago.formaPago.codigo}" />
                                                    </p:column>
                                                    <p:column headerText="No Autorización">
                                                        <h:outputText value="#{formasPago.formaPago.descripcion}" />
                                                    </p:column>
                                                    <p:column headerText="Acciones" style="font-weight: 500;" width="100"
                                                              rendered="#{contFacturasView.renderedBotones}">
                                                        <center>
                                                            <p:commandLink title="Eliminar" process="@this" update="dataTableFormasPago"
                                                                           actionListener="#{contFacturasView.eliminarFormasPago(formasPago,index)}">
                                                                <i class="fa fa-trash" style="font-size: 1.5em; margin-right: 8px; color: red;"></i>
                                                                <p:confirm header="Confirmación de eliminación"
                                                                           message="¿Está seguro de eliminar la forma de pago?"
                                                                           icon="fa fa-exclamation-triangle" />
                                                            </p:commandLink>        
                                                        </center>
                                                    </p:column>                                                  
                                                </p:dataTable>
                                            </p:panelGrid>
                                        </p:panelGrid>
                                    </p:panelGrid>
                                </p:fieldset>
                            </p:panelGrid>
                            <p:fieldset legend="Detalle de la factura:" style="margin: 15px">
                                <p:commandButton value="Nuevo detalle" class="nuevo" update="retencionesTable"
                                                 process="baseImponibleDiferente, baseImponibleIva"
                                                 icon="ui-icon-plus" actionListener="#{contFacturasView.openDlgConfRetenciones()}"
                                                 styleClass="Fs16" style="width: auto;margin-bottom: 15px"/>
                                <p:dataTable id="retencionesTable" widgetVar="retencionesTable" var="detalle" style="width: 100%;" 
                                             lazy="false" rows="50" editable="true" editMode="cell" rowKey="#{registroContableDetalle.index}" rowIndexVar="index"
                                             paginator="true" paginatorPosition="bottom" value="#{contFacturasView.contFacturaDetalleList}"
                                             currentPageReportTemplate="Mostrando {startRecord}-{endRecord} de {totalRecords}"
                                             paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                             emptyMessage="No existen datos con los parámetros especificados">
                                    <p:column headerText="Cuenta" style="width: 20%;" filterBy="#{detalle.idConfRetencion.contContable.codigo}">
                                        <h:outputText value="#{detalle.idConfRetencion.contContable.codigo}"/>   
                                    </p:column>
                                    <p:column headerText="Nombre" style="width: 20%" filterBy="#{detalle.idConfRetencion.contContable.descripcion}">
                                        <h:outputText value="#{detalle.idConfRetencion.contContable.descripcion}"/>   
                                    </p:column>
                                    <p:column headerText="Rubro" style="width: 10%;text-align: center">
                                        <h:outputText value="#{detalle.idConfRetencion.retencion.codigo}"/>   
                                    </p:column>
                                    <p:column headerText="% de rubro" style="width: 20%;text-align: center">
                                        <h:outputText value="#{detalle.idConfRetencion.retencion.valor}"/>   
                                    </p:column>
                                    <p:column headerText="Base" style="width: 20%">
                                        <p:cellEditor>
                                            <f:facet name="output">
                                                <h:outputText value="#{detalle.valorBase}" style="float: right"> 
                                                    <f:convertNumber type="currency" currencySymbol="$" currencyCode="USD" locale="es_EC"/>
                                                </h:outputText>
                                            </f:facet>
                                            <f:facet name="input">
                                                <p:inputNumber value="#{detalle.valorBase}">
                                                    <p:ajax listener="#{contFacturasView.calcularValorRubro(detalle)}" process="@this" update="retencionesTable"/>
                                                </p:inputNumber>
                                            </f:facet>
                                        </p:cellEditor>
                                    </p:column>
                                    <p:column headerText="Valor de retención(IVA/RENTA)" style="width: 20%;text-align: center">
                                        <h:outputText value="#{detalle.valorDetalle}" style="float: right"> 
                                            <f:convertNumber type="currency" currencySymbol="$" currencyCode="USD" locale="es_EC"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="Acción" style="width: 10%;text-align: center">
                                        <p:commandLink title="Eliminar" process="@this" actionListener="#{contFacturasView.deleteDetalle(detalle,index)}">
                                            <i class="fa fa-trash" style="font-size: 1.5em; margin-right: 8px; color: red;"></i>
                                        </p:commandLink>
                                    </p:column>
                                </p:dataTable>
                            </p:fieldset>
                            <center>
                                <p:commandButton value="Guardar" icon="fa fa-save" actionListener="#{contFacturasView.save()}"
                                                 styleClass="Fs16" style="width: auto;margin: 15px"/>
                                <p:commandButton value="Cerrar" icon="fa fa-close" actionListener="#{contFacturasView.closeForm()}"
                                                 update="createEditPanel,fieldset" process="@this"
                                                 styleClass="Fs16" style="width: auto;margin: 15px;background: #ff3333"/>
                            </center>
                        </p:fieldset>       
                    </p:outputPanel>
                    <p:commandButton value="Limpiar filtros"
                                     icon="ui-icon-refresh" onclick="PF('dataTableFactura').clearFilters()" update="dataTableFactura"
                                     styleClass="Fs16" style="width: auto;margin-bottom: 15px"/>
                    <p:dataTable  id="dataTableFactura" widgetVar="dataTableFactura" var="factura" value="#{contFacturasView.facturaLazy}" 
                                  paginator="true" rows="50" style="width: 100%;" rowKey="#{factura.id}"
                                  paginatorPosition="bottom" currentPageReportTemplate="Mostrando {startRecord}-{endRecord} de {totalRecords}"
                                  paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                  rowsPerPageTemplate="50,60,70,100" lazy="true" selectionMode="single" 
                                  emptyMessage="No existen datos con el criterio de búsqueda especificado">
                        <p:column headerText="No. Factura" style="width: 10%;text-align: center" filterBy="#{factura.numFactura}" filterMatchMode="contains">
                            <h:outputText value="#{factura.numFactura}" />
                        </p:column>
                        <p:column headerText="Fecha Factura" style="width: 8%;text-align: center" sortBy="#{factura.fechaFactura}">
                            <h:outputText value="#{factura.fechaFactura}" >
                                <f:convertDateTime pattern="dd-MM-yyyy"/>
                            </h:outputText>
                        </p:column>
                        <p:column headerText="No. Autorización" style="width: 26%;" filterBy="#{factura.numAutorizacion}" filterMatchMode="contains">
                            <h:outputText value="#{factura.numAutorizacion}" />
                        </p:column>
                        <p:column headerText="RUC/C.I. Proveedor" style="width: 8%;text-align: center" filterBy="#{factura.proveedor.cliente.identificacionCompleta}" filterMatchMode="contains">
                            <h:outputText value="#{factura.proveedor.cliente.identificacionCompleta}" />
                        </p:column>
                        <p:column headerText="Proveedor" style="width: 18%;" filterBy="#{factura.proveedor.cliente.nombreCompleltoSql}" filterMatchMode="contains">
                            <h:outputText value="#{factura.proveedor.cliente.nombreCompleltoSql}" />
                        </p:column>
                        <p:column headerText="Tipo" style="width: 8%;text-align: center" filterBy="#{factura.facturaElectronica}">
                            <f:facet name="filter">
                                <p:selectOneMenu onchange="PF('dataTableFactura').filter()" styleClass="custom-filter" style="width: 100%">
                                    <f:converter converterId="javax.faces.Boolean" />
                                    <f:selectItem itemLabel="Todos" itemValue=""/>
                                    <f:selectItem itemLabel="ELECTRONICA" itemValue="true" />
                                    <f:selectItem itemLabel="FISICA" itemValue="false" />
                                </p:selectOneMenu>
                            </f:facet>
                            <h:outputText value="#{factura.facturaElectronica?'ELECTRONICA':'FISICA'}" />
                        </p:column>
                        <p:column headerText="Retenido" style="width: 8%;text-align: center" filterBy="#{factura.retenida}">
                            <f:facet name="filter">
                                <p:selectOneMenu onchange="PF('dataTableFactura').filter()" styleClass="custom-filter" style="width: 100%">
                                    <f:converter converterId="javax.faces.Boolean" />
                                    <f:selectItem itemLabel="Todos" itemValue=""/>
                                    <f:selectItem itemLabel="SI" itemValue="true" />
                                    <f:selectItem itemLabel="NO" itemValue="false" />
                                </p:selectOneMenu>
                            </f:facet>
                            <h:outputText value="#{factura.retenida?'SI':'NO'}" />
                        </p:column>
                        <p:column headerText="Reg. Cont." style="width: 8%;text-align: center" filterBy="#{factura.idConDiario.numRegistro}" sortBy="#{factura.idConDiario.numRegistro}">
                            <h:outputText value="#{factura.idConDiario.numRegistro}" />
                        </p:column>
                        <p:column headerText="Acción" style="width: 8%;text-align: center">
                            <p:commandLink title="Editar" process="@this" actionListener="#{contFacturasView.openDlg(factura)}" update="createEditPanel">
                                <i class="fa fa-edit" style="font-size: 1.5em; margin-right: 8px; color: #0D47A1;"></i>
                            </p:commandLink>
                            <p:commandLink title="Eliminar" actionListener="#{contFacturasView.delete(factura)}" process="@this" update="dataTableFactura">
                                <i class="fa fa-trash" style="font-size: 1.5em; margin-right: 5px; color: red;"></i>
                                <p:confirm header="Confirmación de eliminación" 
                                           message="¿Esta seguro de eliminar la factura #{factura.numAutorizacion} ?" 
                                           icon="fa fa-exclamation-triangle" />
                            </p:commandLink>
                        </p:column>
                    </p:dataTable>
                    <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                        <p:commandButton value="Si" type="button" styleClass="ui-confirmdialog-yes GreenButton" icon="fa fa-check" />
                        <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no RedButton" icon="fa fa-times" />
                    </p:confirmDialog>
                </h:form>   
            </div>
        </div>
        <p:dialog id="dlgProveedor" header="Listado Proveedor" widgetVar="dlgProveedor" width="50%" draggable="false"
                  modal="true" showEffect="fade" hideEffect="fade" resizable="false" position="center" blockScroll="true" >
            <h:form prependId="false">
                <p:outputPanel id="formProveedor" style="width: 100%;" >
                    <p:dataTable  id="dataTableProveedor" widgetVar="dataTableProveedor" var="proveedor" value="#{contFacturasView.proveedorLazy}" 
                                  paginator="true" rows="15" style="width: 100%;" rowKey="#{proveedor.id}"
                                  paginatorPosition="bottom" currentPageReportTemplate="Mostrando {startRecord}-{endRecord} de {totalRecords}"
                                  paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                  rowsPerPageTemplate="15" lazy="true" selectionMode="single" 
                                  emptyMessage="No existen datos con el criterio de búsqueda especificado">
                        <p:column headerText="RUC/C.I. Proveedor" style="width: 30%;text-align: center" filterBy="#{proveedor.cliente.identificacionCompleta}" filterMatchMode="contains">
                            <h:outputText value="#{proveedor.cliente.identificacionCompleta}" />
                        </p:column>
                        <p:column headerText="Proveedor" style="width: 60%;text-align: center" filterBy="#{proveedor.cliente.nombreCompleltoSql}" filterMatchMode="contains">
                            <h:outputText value="#{proveedor.cliente.nombreCompleltoSql}" />
                        </p:column>
                        <p:column headerText="Acción" style="width: 10%;text-align: center">
                            <p:commandLink title="Seleccionar" process="@this" update="gridProveedor"
                                           actionListener="#{contFacturasView.closeDlgProveedor(proveedor)}">
                                <i class="fa fa-plus-circle" style="font-size: 1.5em; margin-right: 8px; color: green;"></i>
                            </p:commandLink>
                        </p:column>
                    </p:dataTable>
                </p:outputPanel>
            </h:form>    
        </p:dialog>
        <p:dialog id="dlgRetenciones" header="Listado configuración de retenciones" widgetVar="dlgRetenciones" width="60%" draggable="false"
                  modal="true" showEffect="fade" hideEffect="fade" resizable="false" position="center" blockScroll="true" >
            <h:form prependId="false">
                <p:dataTable id="dataTableRetenciones" 
                             widgetVar="dataTableRetenciones"
                             value="#{contFacturasView.retencionesLazy}"
                             var="retencion" 
                             reflow="true" 
                             paginator="true" 
                             lazy="true" rows="10" 
                             rowsPerPageTemplate="10,20,50,100" 
                             paginatorPosition="bottom"
                             currentPageReportTemplate="Mostrando {startRecord}-{endRecord} de {totalRecords}"
                             paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} 
                             {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                             filterEvent="enter"
                             emptyMessage="No existen registros para mostrar">
                    <p:column headerText="Cuenta" style="width: 15%;" filterBy="#{retencion.contContable.codigo}">
                        <h:outputText value="#{retencion.contContable.codigo}"/>   
                    </p:column>
                    <p:column headerText="Nombre" style="width: 25%" filterBy="#{retencion.contContable.descripcion}">
                        <h:outputText value="#{retencion.contContable.descripcion}"/>   
                    </p:column>
                    <p:column headerText="Rubro" style="width: 10%;text-align: center" filterBy="#{retencion.retencion.codigo}" sortBy="#{retencion.retencion.codigo}">
                        <h:outputText value="#{retencion.retencion.codigo}"/>   
                    </p:column>
                    <p:column headerText="Valor" style="width: 10%;text-align: center" filterBy="#{retencion.retencion.valor}" sortBy="#{retencion.retencion.valor}">
                        <h:outputText value="#{retencion.retencion.valor}"/>   
                    </p:column>
                    <p:column headerText="Descripción" style="width: 30%" filterBy="#{retencion.retencion.descripcion}" sortBy="#{retencion.retencion.descripcion}">
                        <h:outputText value="#{retencion.retencion.descripcion}"/>   
                    </p:column>
                    <p:column headerText="Acción" style="width: 10%;text-align: center">
                        <p:commandLink title="Seleccionar" process="@this" actionListener="#{contFacturasView.closeDlgConfRetenciones(retencion)}">
                            <i class="fa fa-plus-circle" style="font-size: 1.5em; margin-right: 8px; color: green;"></i>
                        </p:commandLink>
                    </p:column>
                </p:dataTable>   
            </h:form>    
        </p:dialog>
    </ui:define>
</ui:composition>