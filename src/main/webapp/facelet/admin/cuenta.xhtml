<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="/WEB-INF/template/template.xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:comp="http://xmlns.jcp.org/jsf/composite/comp">

    <ui:define name="title">
        Datos de usuario
    </ui:define>
    <ui:param name="tittle" value="Información de la Cuenta" />
    <ui:define name="content">
        <div class="ui-g ui-fluid">
            <div class="ui-g-12" >
                <h:form id="frmMain" >
                    <div class="ui-g-12">
                        <!--<p:graphicImage name="bg_emot.jpg" library="images" style="width: 100%;height: 310px"/>-->
                    </div>
                    <div class="ui-g-12">
                        <div class="ui-g-6">
                            <p:fieldset legend="DATOS DEL USUARIO" style="font-weight: bold;margin-top: 10px">
                                <div class="ui-g-4">
                                    <p:panelGrid columns="1" layout="grid" styleClass="ui-panelgrid-blank form-group">
                                        <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                            <p:graphicImage name="#{userSession.usuario.funcionario.persona.genero.codigo=='M'?'avatar_hombre.png':'avatar_mujer.png'}" library="images" style="width: 100%"/>
                                        </h:panelGroup>
                                    </p:panelGrid>
                                </div>
                                <div class="ui-g-8">
                                    <p:panelGrid columns="2" layout="grid" styleClass="ui-panelgrid-blank form-group">
                                        <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                            <p:outputLabel value="C.I.:"  style="font-weight: bold"/>
                                            <br/>
                                            <p:outputLabel value="#{userSession.usuario.funcionario.persona.identificacion}" style="font-weight: normal"/>
                                            <p:outputLabel value="#{userSession.usuario.funcionario.persona.genero.codigo}" style="font-weight: normal"/>
                                        </h:panelGroup>
                                        <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                            <p:outputLabel value="APELLIDOS Y NOMBRES:"  style="font-weight: bold"/>
                                            <br/>
                                            <p:outputLabel value="#{userSession.usuario.funcionario.persona.nombreCompleto}" style="font-weight: normal"/>
                                        </h:panelGroup>
                                        <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                            <p:outputLabel value="ESTADO CIVIL:"  style="font-weight: bold"/>
                                            <br/>
                                            <p:outputLabel value="#{userSession.usuario.funcionario.estadoCivil.texto}" style="font-weight: normal"/>
                                        </h:panelGroup>
                                        <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                            <p:outputLabel value="DIRECCIÓN:"  style="font-weight: bold"/>
                                            <br/>
                                            <p:outputLabel value="#{userSession.usuario.funcionario.persona.direccion}" style="font-weight: normal"/>
                                        </h:panelGroup>
                                        <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                            <p:outputLabel value="TELÉFONO:"  style="font-weight: bold"/>
                                            <br/>
                                            <p:outputLabel value="#{userSession.usuario.funcionario.persona.telefono}" style="font-weight: normal"/>
                                        </h:panelGroup>
                                        <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                            <p:outputLabel value="CELULAR:"  style="font-weight: bold"/>
                                            <br/>
                                            <p:outputLabel value="#{userSession.usuario.funcionario.persona.celular}" style="font-weight: normal"/>
                                        </h:panelGroup>
                                        <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                            <p:outputLabel value="E-MAIL PERSONAL:"  style="font-weight: bold"/>
                                            <br/>
                                            <p:outputLabel value="#{userSession.usuario.funcionario.fechaIngreso}" style="font-weight: normal"/>
                                        </h:panelGroup>
                                        <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                            <p:outputLabel value="E-MAIL INSTITUCIONAL:"  style="font-weight: bold"/>
                                            <br/>
                                            <p:outputLabel value="#{userSession.usuario.funcionario.emailInstitucion}" style="font-weight: normal"/>
                                        </h:panelGroup>
                                        <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                            <p:outputLabel value="FECHA DE INGRESO:"  style="font-weight: bold"/>
                                            <br/>
                                            <p:outputLabel value="#{userSession.usuario.funcionario.fechaIngreso}" style="font-weight: normal">
                                                <f:convertDateTime pattern="dd-MM-yyyy" />
                                            </p:outputLabel>
                                        </h:panelGroup>
                                        <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                            <p:commandLink id="recuperarPassword" style="text-decoration:underline" action="#{cuentaController.cambiarContraseña()}">
                                                <i class="fa-icon fa fa-key"></i>
                                                <h:outputText value="Cambiar Contraseña"/>
                                            </p:commandLink>
                                        </h:panelGroup>
                                    </p:panelGrid>
                                </div>
                            </p:fieldset>
                        </div>
                        <div class="ui-g-6">
                            <p:fieldset legend="Firma electrónica" >
                                <h:panelGrid columns="3"   style="width: 100%">
                                    <h:panelGroup> 
                                        <p:outputLabel  id="fElecotronica" 
                                                        style="font-weight: bolder; width: 80% !important; font-size: 8px" /><br></br>
                                        <p:fileUpload id="firma" fileUploadListener="#{cuentaController.upload}"
                                                      label="Firma Electrónica" update="fElecotronica"
                                                      style="background: white !important; width: 80%"

                                                      uploadLabel="Subir" cancelLabel="Cancelar"  
                                                      auto="true" skinSimple="true" fileLimit="1" dragDropSupport="false"  
                                                      sizeLimit="10000000000" allowTypes="/(\.|\/)(p12|pfx)$/" />
                                    </h:panelGroup>  
                                    <h:panelGroup>
                                        <p:outputLabel value="Contraseña*" for="clave" style="font-weight: bolder;" /><br></br>
                                        <p:password id="clave" value="#{cuentaController.claveFirma}"  class="panelInput" />
                                    </h:panelGroup>
                                    <h:panelGroup>
                                        <p:outputLabel value=""  style="font-weight: bolder;"/><br></br>
                                        <p:commandButton value="Validar firma electrónica" icon="fa fa-check" update="datosFirma, pnlBtn" styleClass="success-button rounded-button p-mr-2 p-mb-2"
                                                         actionListener="#{cuentaController.validarFirmaElectronica()}"  />
                                    </h:panelGroup>
                                </h:panelGrid><br></br>
                                <h:panelGrid columns="2" id="datosFirma"   style="width: 100%">
                                    <h:panelGroup>
                                        <p:outputLabel value="Ubicación"  style="font-weight: bolder;"/><br></br>
                                        <p:inputText   readonly="#{!cuentaController.firmaValidada}" value="#{cuentaController.firmaElectronica.ubicacion}" style="width: 90% !important"/>
                                    </h:panelGroup>
                                    <h:panelGroup>
                                        <p:outputLabel value="Estado Firma"  style="font-weight: bolder;"/><br></br>
                                        <p:inputText readonly="true"  value="#{cuentaController.firmaElectronica.estadoFirma}" style="width: 90% !important"/>
                                    </h:panelGroup>
                                    <h:panelGroup>
                                        <p:outputLabel value="UID"  style="font-weight: bolder;"/><br></br>
                                        <p:inputText readonly="true"  value="#{cuentaController.firmaElectronica.uid}"  style="width: 90% !important"/>
                                    </h:panelGroup>
                                    <h:panelGroup>
                                        <p:outputLabel value="CN"  style="font-weight: bolder;"/><br></br>
                                        <p:inputText readonly="true"  value="#{cuentaController.firmaElectronica.cn}"  style="width: 90% !important"/>
                                    </h:panelGroup>
                                    <h:panelGroup>
                                        <p:outputLabel value="Emisión"  style="font-weight: bolder;"/><br></br>
                                        <p:inputText readonly="true"  value="#{cuentaController.firmaElectronica.emision}"  style="width: 90% !important"/>
                                    </h:panelGroup>
                                    <h:panelGroup>
                                        <p:outputLabel value="ISUSER"  style="font-weight: bolder;"/><br></br>
                                        <p:inputText readonly="true"  value="#{cuentaController.firmaElectronica.isuser}"  style="width: 90% !important"/>
                                    </h:panelGroup>
                                    <h:panelGroup>
                                        <p:outputLabel value="Fecha Emisión*"  style="font-weight: bolder;"/><br></br>
                                        <p:inputText readonly="true"  value="#{cuentaController.firmaElectronica.fechaEmision}"  style="width: 90% !important">
                                            <f:convertDateTime pattern="yyyy-MM-dd"/>  
                                        </p:inputText>
                                    </h:panelGroup>
                                    <h:panelGroup>
                                        <p:outputLabel value="Fecha Expiración*"  style="font-weight: bolder;"/><br></br>
                                        <p:inputText readonly="true"  value="#{cuentaController.firmaElectronica.fechaExpiracion}"  style="width: 90% !important">
                                            <f:convertDateTime pattern="yyyy-MM-dd"/>  
                                        </p:inputText>
                                    </h:panelGroup>
                                    <h:panelGroup>
                                        <p:outputLabel value="Tipo firma"  style="font-weight: bolder" /><br></br>
                                        <p:selectOneMenu value="#{cuentaController.firmaElectronica.tipoFirma}" 

                                                         style="width: 87% !important;" disabled="#{!cuentaController.firmaValidada}" >
                                            <f:selectItem itemLabel="Seleccione..." itemValue="#{null}" />
                                            <f:selectItem itemLabel="QR" itemValue="QR" />
                                            <f:selectItem itemLabel="information1" itemValue="information1" />
                                            <f:selectItem itemLabel="information2" itemValue="information2" />

                                        </p:selectOneMenu>    
                                    </h:panelGroup>
                                    <!--                            <h:panelGroup>  
                                                                    <h:panelGrid columns="1" style="width: 50%; float: right">
                                                                        <p:fileUpload id="firmaDigital" 
                                                                                      label="Firma Digital" update="firmaDigital"
                                                                                      listener="# {cuentaController.uploadFirmaDigital}"
                                                                                      uploadLabel="Subir" cancelLabel="Cancelar"  
                                                                                      auto="true" skinSimple="true" fileLimit="1" dragDropSupport="false"  
                                                                                      sizeLimit="10000000000" allowTypes="/(\.|\/)(jpg|png)$/" /> 
                                                                    </h:panelGrid>
                                                                </h:panelGroup>  -->
                                </h:panelGrid>
                                <center>
                                    <h:panelGroup id="pnlBtn">
                                        <p:commandButton value="Grabar" process="@form" styleClass="info-button rounded-button p-mr-2 p-mb-2" icon="fa fa-save" update="frmMain" disabled="#{!cuentaController.firmaValidada}"
                                                         actionListener="#{cuentaController.guardarActualizarFirmaElectronica()}"  />

                                    </h:panelGroup>
                                </center>
                                <br></br>
                            </p:fieldset>
                        </div>
                        <div class="ui-g-6">
                            <p:fieldset legend="DATOS DE LA CUENTA" style="font-weight: bold;margin-top: 10px">
                                <p:panelGrid columns="3" layout="grid" styleClass="ui-panelgrid-blank form-group">
                                    <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                        <p:outputLabel value="NOMBRE DE USUARIO:"  style="font-weight: bold"/>
                                        <br/>
                                        <p:outputLabel value="#{userSession.usuario.usuario}"  style="font-weight: normal"/>
                                    </h:panelGroup>
                                    <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                        <p:outputLabel value="¿SU CLAVE CADUCA?"  style="font-weight: bold"/>
                                        <br/>
                                        <p:outputLabel value="#{userSession.usuario.caducarClave eq true? 'Si' : 'No'}" style="font-weight: normal"/>
                                    </h:panelGroup>
                                    <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                        <p:outputLabel value="¿FECHA DE CADUCIDAD:"  style="font-weight: bold"/>
                                        <br/>
                                        <p:outputLabel value="#{userSession.usuario.fechaCaducidad}" style="font-weight: normal">
                                            <f:convertDateTime pattern="dd-MM-yyyy" />
                                        </p:outputLabel>
                                    </h:panelGroup>
                                </p:panelGrid>
                                <p:dataTable value="#{userSession.usuario.roles}" var="rl1" paginator="true" rows="10" 
                                             paginatorPosition="top" paginatorAlwaysVisible="false" id="tdRolesUsuario" 
                                             style="font-size: 10px;margin-bottom: 20px;text-align: center"
                                             rowKey="#{rl1.id}" rowIndexVar="index" filterBy="#{rl1.eliminado}">
                                    <f:facet name="header">
                                        <p:outputLabel value="ROLES ACTUALES" class="Fs16 FontBold" />
                                    </f:facet>
                                    <p:column colspan="2" headerText="Unidad Administrativa">
                                        <h:outputText value="#{rl1.rol.unidadAdministrativa.nombre}" />
                                    </p:column>
                                    <p:column headerText="Nombre" >
                                        <p:outputLabel value="#{rl1.rol.nombre}" />
                                    </p:column>
                                </p:dataTable>
                            </p:fieldset>
                        </div>
                    </div>
                </h:form>
            </div>
        </div>


        <p:dialog header="Cambio de Clave" modal="true" widgetVar="dlgCambioClave" closable="false" >
            <h:form id="frmCambioClave" style="width: 100%;" >
                <p:panelGrid columns="2" layout="grid" styleClass="ui-panelgrid-blank form-group">
                   
                    <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                        <p:outputLabel value="Contraseña" style="width: 100%" />
                        <p:password value="#{cuentaController.pass1}" style="width: 100%"
                                    placeholder="Ingresar Contraseña" />
                    </h:panelGroup>
                    <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                        <p:outputLabel value="Confirmar Contraseña" style="width: 100%" />
                        <p:password value="#{cuentaController.pass2}" style="width: 100%" readonly="false" placeholder="Confirme Contraseña" />
                    </h:panelGroup>
                </p:panelGrid>
                <br/>
                <br/>
                <center>
                    <p:commandButton title="Guardar Rol" icon="fa fa-save" actionListener="#{cuentaController.actualizarClave()}" update="frmCambioClave"  /> 
                    <p:spacer width="10" />
                    <p:commandButton title="Cerrar" icon="fa fa-close edit" onclick="PF('dlgCambioClave').hide();" /> 
                </center>
            </h:form>
        </p:dialog>

    </ui:define>

</ui:composition>
