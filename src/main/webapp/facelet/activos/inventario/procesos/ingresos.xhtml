<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="/WEB-INF/template/template.xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:u="http://xmlns.jcp.org/jsf/composite/comp"
                xmlns:f="http://xmlns.jcp.org/jsf/core">

    <ui:define name="title">
        INGRESOS A BODEGA
    </ui:define>
    <ui:define name="content">
        <div class="ui-g ui-fluid">
            <u:titleTask task="#{procesoIngresoInvView.tarea}" tramite="#{procesoIngresoInvView.tramite}" />
            <div class="ui-g-12" >
                <h:form id="frmMain">
                    <div class="ui-g-12">
                        <div class="ui-g-12">
                            <p:panelGrid columns="2" layout="grid" styleClass="ui-panelgrid-blank form-group">
                                <p:panelGrid columns="2" layout="grid" styleClass="ui-panelgrid-blank form-group" id="ingresoCabecera1">
                                    <h:panelGroup layout="block" style="width: 100%;" class="panelInput">
                                        <p:commandButton value="Nuevo Ingreso" disabled="#{procesoIngresoInvView.botonNew}"
                                                         icon="fa fa-plus" process="@this" id="btnNuevoIngreso"
                                                         update="frmMain" actionListener="#{procesoIngresoInvView.nuevoIngreso()}"
                                                         style="width: 150px">
                                        </p:commandButton>
                                    </h:panelGroup>
                                    <h:panelGroup layout="block" style="width: 100%;" class="panelInput">
                                        <p:outputLabel value="INGRESO NO:" style="width: 100%;font-weight: bold;font-size: 15px" /><br/>
                                        <p:outputLabel value="Generado automaticamente por el sistema" style="width: 100%;font-weight: bold;font-size: 12px" />

                                    </h:panelGroup>
                                </p:panelGrid>
                                <p:panelGrid columns="4" layout="grid" styleClass="ui-panelgrid-blank form-group" id="ingresoCabecera2">
                                    <h:panelGroup layout="block" style="width: 100%;" class="panelInput">
                                        <p:outputLabel value="FECHA EGRESO:" style="width: 100%;font-weight: bold;font-size: 15px" />
                                        <p:calendar id="fechaEgreso" pattern="yyyy-MM-dd" mask="true" required="true" 
                                                    navigator="true" yearRange="c-100:c+100" locale="es" style="width: 100%"
                                                    value="#{procesoIngresoInvView.inventario.fechaMovimiento}">
                                            <p:ajax event="dateSelect" listener="#{procesoIngresoInvView.setPeriodoSeleccionado()}" update="anioEgreso"/>
                                        </p:calendar>
                                    </h:panelGroup>
                                    <h:panelGroup layout="block" style="width: 100%;" class="panelInput"/>
                                    <h:panelGroup layout="block" style="width: 100%;" class="panelInput">
                                        <p:outputLabel value="PERÍODO:" style="width: 100%;font-weight: bold;font-size: 15px" /><br/>
                                        <p:inputText  id="anioEgreso" class="panelInput" readonly="true" required="false" 
                                                      value="#{procesoIngresoInvView.inventario.anio}" style="width:100%">
                                        </p:inputText>
                                    </h:panelGroup>
                                </p:panelGrid>
                            </p:panelGrid>
                        </div>
                    </div>
                    <div class="ui-g-12">
                        <div class="ui-g-6">
                            <p:fieldset legend="DATOS DEL INGRESO" style="font-weight: bold">
                                <p:outputPanel id="outPanelMedidaUno" style="width: 100%">
                                    <p:panelGrid columns="3"  layout="grid" styleClass="ui-panelgrid-blank form-group" style="width: 100%">
                                        <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                            <p:outputLabel value="RESPONSABLE:" for="responsableIngreso" style="width: 100%;"/>
                                            <p:inputText  id="responsableIngreso" style="text-transform: uppercase; width: 100%;"
                                                          class="panelInput" readonly="true" value="#{procesoIngresoInvView.inventario.usuarioOriginador}">
                                            </p:inputText>
                                        </h:panelGroup>
                                        <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                            <p:outputLabel value="TIPO MOVIMIENTO:" for="tipoMovimiento" style="width: 100%;"/>
                                            <p:inputText  id="tipoMovimiento" style="text-transform: uppercase" 
                                                          class="panelInput" readonly="true" 
                                                          value="#{procesoIngresoInvView.inventario.tipoMovimiento}">
                                            </p:inputText>
                                        </h:panelGroup>
                                        <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                            <p:outputLabel value="MOTIVO:" style="width: 100%;"/>
                                            <p:selectOneMenu style="width:100% !important" value="#{procesoIngresoInvView.inventario.motivoMovimiento}" 
                                                             disabled="true" converter="entityConverter">
                                                <f:selectItem itemLabel="Seleccione" itemValue="#{null}"/>
                                                <f:selectItems value="#{procesoIngresoInvView.motivoMovimiento}" var="medidaUno"
                                                               itemLabel="#{medidaUno.texto}" itemValue="#{medidaUno}"/>
                                                <p:ajax listener="#{procesoIngresoInvView.mostrarBtn()}" update="frmMain"/>
                                            </p:selectOneMenu>
                                        </h:panelGroup>
                                    </p:panelGrid>
                                    <p:panelGrid columns="1" columnClasses="ui-grid-col-12" layout="grid" styleClass="ui-panelgrid-blank form-group" style="width: 100%">
                                        <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                            <p:outputLabel value="Observación" for="observacion"/>
                                            <p:inputTextarea id="observacion" rows="3" 
                                                             class="panelInput" 
                                                             readonly="false" disabled="#{procesoIngresoInvView.habilitar}"
                                                             style="width: 100%; text-transform: uppercase" 
                                                             value="#{procesoIngresoInvView.inventario.observacion}"/>
                                        </h:panelGroup>
                                    </p:panelGrid>
                                </p:outputPanel>
                            </p:fieldset>
                            <p:fieldset legend="DATOS DE PROVEEDOR" style="font-weight: bold" id="datosProv" rendered="#{procesoIngresoInvView.rendFactura}">
                                <p:outputPanel id="outPanelMedidaCuatro" style="width: 100%">                                                        
                                    <p:panelGrid columns="2" layout="grid" styleClass="ui-panelgrid-blank form-group" style="width: 100%">
                                        <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                            <p:outputLabel value="IDENTIFICACIÓN:" style="width: 100%" />
                                            <p:inputText id="identifica" 
                                                         class="panelInput" value="#{procesoIngresoInvView.proveedor.cliente.identificacion}" 
                                                         maxlength="13" style=" width: 100%;" required="true" readonly="true"/>  
                                        </h:panelGroup>
                                        <h:panelGroup layout="block" style="width: 100%;" class="panelInput"/>
                                        <h:panelGroup layout="block" style="width: 100%;" class="panelInput">
                                            <p:outputLabel value="RAZÓN SOCIAL:" for="razon" style="width: 100%;"/>
                                            <p:inputText  value="#{procesoIngresoInvView.proveedor.cliente.nombre}"
                                                          id="razon" style="text-transform: uppercase; width: 100%" 
                                                          class="panelInput" readonly="true">
                                            </p:inputText>
                                        </h:panelGroup>
                                        <h:panelGroup layout="block" style="width: 100%;" class="panelInput">
                                            <p:outputLabel value="NOMBRE COMERCIAL:" for="nombreCom" style="width: 100%;"/>
                                            <p:inputText  value="#{procesoIngresoInvView.proveedor.cliente.apellido}"
                                                          id="nombreCom" style="text-transform: uppercase; width: 100%" 
                                                          class="panelInput" readonly="true">
                                            </p:inputText>
                                        </h:panelGroup>
                                    </p:panelGrid>
                                </p:outputPanel>
                            </p:fieldset>
                        </div>
                        <div class="ui-g-6">
                            <p:fieldset legend="DATOS DE ADQUISICIÓN" style="font-weight: bold" rendered="#{procesoIngresoInvView.rendOrden}">
                                <p:outputPanel id="outPanelMedidaTres" style="width: 100%">
                                    <p:panelGrid columns="1" layout="grid" styleClass="ui-panelgrid-blank form-group">
                                        <p:commandButton value="Adicionar"
                                                         icon="fa fa-plus"
                                                         process="@this"
                                                         id="btnOrden"
                                                         disabled="#{procesoIngresoInvView.habilitar}"
                                                         actionListener="#{procesoIngresoInvView.openDlgAdquisicion()}"
                                                         update="frmOrden"
                                                         style=" float: right; width: 130px">
                                        </p:commandButton>
                                        <p:dataTable id="dtOrden" 
                                                     var="ord" rows="7" rowsPerPageTemplate="7" 
                                                     value="#{procesoIngresoInvView.listAdq}" paginator="true"
                                                     paginatorPosition="bottom" currentPageReportTemplate="Mostrando {startRecord}-{endRecord} de {totalRecords}"
                                                     paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                                     emptyMessage="Ninguna documento escogido.">
                                            <f:facet name="header">
                                                DATOS DE ADQUISICIÓN
                                            </f:facet>
                                            <p:column headerText="Num. Orden" style="font-weight: bold; width: 40%" >
                                                <h:outputText value="#{ord.idProceso}"/>   
                                            </p:column>
                                            <p:column headerText="Fecha Emisión" style="font-weight: bold;text-align: center;width: 20%">
                                                <h:outputText value="#{ord.fechaEmision}">
                                                    <f:convertDateTime pattern="yyyy-MM-dd"/>
                                                </h:outputText>  
                                            </p:column>
                                            <p:column headerText="Fecha Aceptación" style="font-weight: bold;width: 20%;text-align: center;">
                                                <h:outputText value="#{ord.fechaAceptacion}">
                                                    <f:convertDateTime pattern="yyyy-MM-dd"/>
                                                </h:outputText>   
                                            </p:column>

                                            <p:column headerText="Acciones" style="font-weight: bold; width: 20%;text-align: center;">
                                                <p:commandLink title="Eliminar" process="@this" actionListener="#{procesoIngresoInvView.borrarElementoAdq(ord)}"
                                                               update="frmMain:dtOrden">
                                                    <i class="fa fa-trash" style="font-size: 1.5em; margin-right: 5px; color: red;"></i>
                                                    <p:confirm header="Confirmación de eliminación" message="Esta seguro de eliminar el item?" icon="fa fa-exclamation-triangle" />
                                                </p:commandLink>         
                                            </p:column>
                                        </p:dataTable>
                                    </p:panelGrid>
                                </p:outputPanel>
                            </p:fieldset>
                            <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                                <p:commandButton value="Si" type="button" styleClass="ui-confirmdialog-yes GreenButton" icon="fa fa-check" />
                                <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no RedButton" icon="fa fa-times" />
                            </p:confirmDialog>
                            <p:fieldset legend="FACTURAS RELACIONADAS A NUEVO INGRESO" style="font-weight: bold" rendered="#{procesoIngresoInvView.rendFactura}">
                                <p:outputPanel id="outPanelMedidaCinco" style="width: 100%">
                                    <p:panelGrid columns="1" layout="grid" styleClass="ui-panelgrid-blank form-group">
                                        <p:commandButton value="Adicionar"
                                                         process="@this" 
                                                         id="btnFactura"
                                                         disabled="#{procesoIngresoInvView.habilitar}"
                                                         icon="fa fa-plus"
                                                         update="frmFactura"
                                                         actionListener="#{procesoIngresoInvView.abrirDialogoFacturaCambios(null, null)}"
                                                         style=" float: right; width: 130px">
                                        </p:commandButton>
                                        <p:dataTable id="dtFactura" var="fac" reflow="true" paginator="true" rows="7" value="#{procesoIngresoInvView.listFactura}"
                                                     rowsPerPageTemplate="7" rowIndexVar="can" paginatorPosition="bottom" filterEvent="keyup"
                                                     currentPageReportTemplate="Mostrando {startRecord}-{endRecord} de {totalRecords}"
                                                     paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                                     emptyMessage="No se encontró ninguna factura para mostrar.">
                                            <f:facet name="header">
                                                FACTURAS RELACIONADA A INGRESO
                                            </f:facet>
                                            <p:column headerText="Número Factura" style="font-weight: bold;text-align: center;width: 20%" >
                                                <h:outputText value="#{fac.numFactura}"/>   
                                            </p:column>
                                            <p:column headerText="Fecha Emisión" style="font-weight: bold;text-align: center;width: 15%">
                                                <h:outputText value="#{fac.fechaFactura}">
                                                    <f:convertDateTime pattern="yyyy-MM-dd"/>
                                                </h:outputText>  
                                            </p:column>
                                            <p:column headerText="Fecha Caducidad" style="font-weight: bold;text-align: center;width: 15%">
                                                <h:outputText value="#{fac.fechaCaducidad}">
                                                    <f:convertDateTime pattern="yyyy-MM-dd"/>
                                                </h:outputText>  
                                            </p:column>
                                            <p:column headerText="Número Autorización" style="font-weight: bold;text-align: center;width: 40%" >
                                                <h:outputText value="#{fac.numAutorizacion}"/>   
                                            </p:column>
                                            <p:column headerText="Acciones" style="font-weight: bold; text-align: center;width: 10%">
                                                <p:commandLink title="Editar" update="frmFactura" 
                                                               actionListener="#{procesoIngresoInvView.abrirDialogoFacturaCambios(fac, can)}" process="@this">
                                                    <i class="fa fa-edit" style="font-size: 1.5em; margin-right: 8px; color: #0D47A1;"></i>
                                                </p:commandLink> 
                                                <p:commandLink title="Eliminar" process="@this" actionListener="#{procesoIngresoInvView.borrarElementoFactura(can)}"
                                                               update="dtFactura">
                                                    <i class="fa fa-trash" style="font-size: 1.5em; margin-right: 5px; color: red;"></i>
                                                    <p:confirm header="Confirmación de eliminación" message="Esta seguro de eliminar el item?" icon="fa fa-exclamation-triangle" />
                                                </p:commandLink>
                                            </p:column>
                                        </p:dataTable>
                                    </p:panelGrid>
                                </p:outputPanel>
                            </p:fieldset>
                            <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                                <p:commandButton value="Si" type="button" styleClass="ui-confirmdialog-yes GreenButton" icon="fa fa-check" />
                                <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no RedButton" icon="fa fa-times" />
                            </p:confirmDialog>
                            <p:fieldset legend="DATO EGRESO" id="carEgreso" style="font-weight: bold" rendered="#{procesoIngresoInvView.mostrar}" >
                                <p:outputPanel id="outPanelCargarEgreso" style="width: 100%">
                                    <p:panelGrid columns="3" layout="grid" styleClass="ui-panelgrid-blank form-group">
                                        <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                            <p:commandButton value="CARGAR EGRESO"
                                                             process="@this" 
                                                             icon="fa fa-search"
                                                             id="btnCargarEgreso"
                                                             actionListener="#{procesoIngresoInvView.abrirDialogoEgreso()}"
                                                             style="width: 100%">
                                                <p:ajax event="dialogReturn" 
                                                        listener="#{procesoIngresoInvView.selectDatosEgreso}" 
                                                        update="egresoRel"/>
                                            </p:commandButton>
                                        </h:panelGroup>
                                        <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                            <p:outputLabel value="EGRESO RELACIONADO:" for="egresoRel" style="width: 100%;"/>
                                            <p:inputText  id="egresoRel" style="text-transform: uppercase" 
                                                          class="panelInput" readonly="true" 
                                                          value="#{procesoIngresoInvView.inventarioEgreso.codigo}">
                                            </p:inputText>
                                        </h:panelGroup>
                                        <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                            <p:outputLabel value="FECHA DE EGRESO:" for="egresoRel" style="width: 100%;"/>
                                            <p:inputText  id="fechaEgresoRel" style="text-transform: uppercase" 
                                                          class="panelInput" readonly="true" 
                                                          value="#{procesoIngresoInvView.inventarioEgreso.motivoMovimiento.texto}">
                                            </p:inputText>
                                        </h:panelGroup>
                                    </p:panelGrid>                                                                       
                                </p:outputPanel>
                            </p:fieldset>
                            <p:fieldset legend="DATOS CONSTATACIÓN FÍSICA INVENTARIO" style="font-weight: bold" id="datosCons" rendered="#{procesoIngresoInvView.rendCons}">
                                <p:outputPanel id="outPanelCons" style="width: 100%">
                                    <p:panelGrid columns="1" layout="grid" styleClass="ui-panelgrid-blank form-group">
                                        <p:commandButton value="Adicionar"
                                                         icon="fa fa-plus"
                                                         process="@this" 
                                                         actionListener="#{procesoIngresoInvView.abrirDialogCons()}"
                                                         style=" float: right; width: 130px">
                                            <p:ajax event="dialogReturn" 
                                                    listener="#{procesoIngresoInvView.selectDatosCons}"
                                                    update="dtCons"/>
                                        </p:commandButton>
                                        <p:dataTable id="dtCons" var="con" reflow="true" paginator="true" rows="10" rowsPerPageTemplate="10,50,100" 
                                                     paginatorPosition="bottom" value="#{procesoIngresoInvView.listCons}" filterEvent="keyup"
                                                     emptyMessage="No se encontró ninguna constatación seleccionada.">
                                            <f:facet name="header">
                                                LISTA DE CONSTATACIÓN FÍSICA DE INVENTARIO
                                            </f:facet>
                                            <p:column headerText="Número Constatación" style="font-weight: bold" >
                                                <h:outputText value="#{con.codigo}"/>   
                                            </p:column>
                                            <p:column headerText="Fecha Constatación" style="font-weight: bold">
                                                <h:outputText value="#{con.fechaConstatacion}">
                                                    <f:convertDateTime pattern="yyyy-MM-dd"/>
                                                </h:outputText>  
                                            </p:column>
                                            <p:column headerText="Originador" style="font-weight: bold" >
                                                <h:outputText value="#{con.usuarioCreacion}"/>   
                                            </p:column>
                                            <p:column headerText="Estado" style="font-weight: bold" >
                                                <h:outputText value="#{con.estado}"/>   
                                            </p:column>
                                            <p:column headerText="Acciones" style="font-weight: bold">
                                                <center>
                                                    <p:commandLink title="Eliminar" process="@this" actionListener="#{procesoIngresoInvView.borrarElementoCons(con)}"
                                                                   update="dtCons">
                                                        <i class="fa fa-trash" style="font-size: 1.5em; margin-right: 5px; color: red;"></i>
                                                        <p:confirm header="Confirmación de eliminación" message="Esta seguro de eliminar elemento seleccionado?" icon="fa fa-exclamation-triangle" />
                                                    </p:commandLink>        
                                                </center>
                                            </p:column>
                                        </p:dataTable>
                                    </p:panelGrid>
                                </p:outputPanel>
                            </p:fieldset>
                            <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                                <p:commandButton value="Si" type="button" styleClass="ui-confirmdialog-yes GreenButton" icon="fa fa-check" />
                                <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no RedButton" icon="fa fa-times" />
                            </p:confirmDialog>
                        </div>
                    </div>
                    <div class="ui-g-12">
                        <p:fieldset legend="DETALLE ITEM" style="margin-bottom:20px; font-weight: bold" id="listaItem">
                            <p:outputPanel id="outPanelMedidaSeis" style="width: 100%" >
                                <p:commandButton value="Adicionar"
                                                 process="@this" 
                                                 id="btnItem"
                                                 icon="fa fa-plus"
                                                 actionListener="#{procesoIngresoInvView.abrirDialogo()}"
                                                 style="width: 150px;margin-bottom: 15px">
                                    <p:ajax event="dialogReturn" 
                                            listener="#{procesoIngresoInvView.selectDatosItem}" 
                                            update="dtItemIngreso"/>
                                </p:commandButton>
                                <p:remoteCommand name="onCellEdit" update="dtItemIngreso"/>
                                <p:dataTable 
                                    emptyMessage="Ningún Item para mostrar" 
                                    rowsPerPageTemplate="10,20" paginatorPosition="bottom"
                                    currentPageReportTemplate="Mostrando {startRecord}-{endRecord} de {totalRecords}"
                                    paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                    reflow="true" paginator="true"  rows="10" 
                                    id="dtItemIngreso" rowIndexVar="can" editable="true" editMode="cell" 
                                    value="#{procesoIngresoInvView.listDetalle}"
                                    var="med" widgetVar="dtIngg">
                                    <f:facet name="header" >
                                        DETALLES ITEMS
                                    </f:facet>
                                    <p:column headerText="#" style=" width: 10px" >
                                        <h:outputText value="#{can +1 }"/>   
                                    </p:column>
                                    <p:column headerText="Cod. Item" >
                                        <h:outputText value="#{med.codigoAgrupado}"/>  
                                    </p:column>
                                    <p:column headerText="Descripción" style=" width: 200px"  >
                                        <h:outputText value="#{med.descripcion}"/>  
                                    </p:column>

                                    <p:column headerText="Cuenta Contable" style=" width: 100px; text-align: center" >
                                        <h:outputText value="#{med.cuentaContable.codigo}"/>  
                                    </p:column>
                                    <p:column headerText="Estante" style=" width: 60px;text-align: center">
                                        <p:cellEditor disabled="#{procesoIngresoInvView.mostrar3}">
                                            <f:facet name="output"><h:outputText  value="#{med.estante}" /></f:facet>
                                            <f:facet name="input"><p:inputText value="#{med.estante}" style="width:100%"/></f:facet>
                                        </p:cellEditor>
                                    </p:column>
                                    <p:column headerText="Fila" style=" width: 60px;text-align: center">
                                        <p:cellEditor disabled="#{procesoIngresoInvView.mostrar3}" >
                                            <f:facet name="output"><h:outputText  value="#{med.fila}" /></f:facet>
                                            <f:facet name="input"><p:inputText value="#{med.fila}" style="width:100%"/></f:facet>
                                        </p:cellEditor>
                                    </p:column>
                                    <p:column headerText="Columna" style=" width: 60px;text-align: center">
                                        <p:cellEditor disabled="#{procesoIngresoInvView.mostrar3}" >
                                            <f:facet name="output"><h:outputText  value="#{med.columna}" /></f:facet>
                                            <f:facet name="input"><p:inputText value="#{med.columna}" style="width:100%"/></f:facet>
                                        </p:cellEditor>
                                    </p:column>
                                    <p:column headerText="Cajón" style=" width: 60px;text-align: center">
                                        <p:cellEditor disabled="#{procesoIngresoInvView.mostrar3}" >
                                            <f:facet name="output"><h:outputText  value="#{med.cajon}" /></f:facet>
                                            <f:facet name="input"><p:inputText value="#{med.cajon}" style="width:100%"/></f:facet>
                                        </p:cellEditor>
                                    </p:column>
                                    <p:column headerText="Cuadrante" style=" width: 60px;text-align: center">
                                        <p:cellEditor disabled="#{procesoIngresoInvView.mostrar3}" >
                                            <f:facet name="output"><h:outputText  value="#{med.cuadrante}" /></f:facet>
                                            <f:facet name="input"><p:inputText value="#{med.cuadrante}" style="width:100%"/></f:facet>
                                        </p:cellEditor>
                                    </p:column>
                                    <p:column headerText="Medida" style="text-align: center">
                                        <h:outputText value="#{med.tipoMedida.descripcion}"/>  
                                    </p:column>
                                    <p:column headerText="Cantidad a ingresar" style="text-align: center">
                                        <p:cellEditor disabled="#{procesoIngresoInvView.mostrar3}">
                                            <f:facet name="output"><h:outputText  value="#{med.cantidadTemp}" /></f:facet>
                                            <f:facet name="input">
                                                <p:inputText value="#{med.cantidadTemp}" style="width:100%">
                                                    <p:keyFilter mask="num" />
                                                    <p:ajax update="dtItemIngreso" listener="#{procesoIngresoInvView.calcularIvaDetalle(med)}" />
                                                </p:inputText>
                                            </f:facet>
                                        </p:cellEditor>
                                    </p:column>
                                    <p:column headerText="Precio Unitario" rendered="#{procesoIngresoInvView.mostrarAccObs}">
                                        <p:cellEditor disabled="#{procesoIngresoInvView.mostrar3}" >
                                            <f:facet name="output">
                                                <h:outputText  value="#{med.precioTemp}" style="float: right">
                                                    <f:convertNumber type="currency" currencySymbol="$" currencyCode="USD" locale="es_EC" maxFractionDigits="4"/>
                                                </h:outputText></f:facet>
                                            <f:facet name="input">
                                                <p:inputNumber value="#{med.precioTemp}" decimalPlaces="4">
                                                    <p:ajax update="dtItemIngreso" listener="#{procesoIngresoInvView.calcularIvaDetalle(med)}" />
                                                </p:inputNumber>
                                            </f:facet>
                                        </p:cellEditor>
                                    </p:column>
                                    <p:column headerText="IVA %" rendered="#{procesoIngresoInvView.mostrarAccObs}" style="text-align: center">
                                        <p:cellEditor disabled="#{procesoIngresoInvView.mostrar3}" >
                                            <f:facet name="output">
                                                <h:outputText  value="#{med.ivaTemp}%" />
                                            </f:facet>
                                            <f:facet name="input">
                                                <p:inputNumber value="#{med.ivaTemp}" symbol="%" symbolPosition="s" maxlength="2" decimalPlaces="0">
                                                    <p:ajax update="dtItemIngreso" listener="#{procesoIngresoInvView.calcularIvaDetalle(med)}" />
                                                </p:inputNumber>
                                            </f:facet>
                                        </p:cellEditor>
                                    </p:column>
                                    <p:column  headerText="Total" rendered="#{procesoIngresoInvView.mostrarAccObs}">
                                        <h:outputText value="#{med.totalTemp}" style="float: right">
                                            <f:convertNumber type="currency" currencySymbol="$" currencyCode="USD" locale="es_EC" maxFractionDigits="4"/>
                                        </h:outputText>  
                                    </p:column>
                                    <p:column headerText="Observación" rendered="#{!procesoIngresoInvView.mostrarAccObs}">
                                        <p:cellEditor>
                                            <f:facet name="output"><h:outputText  value="#{med.observacionTemp}" /></f:facet>
                                            <f:facet name="input"><p:inputText value="#{med.observacionTemp}" style="width:100%" 
                                                                               onkeyup="javascript:this.value = this.value.toUpperCase();"/></f:facet>
                                        </p:cellEditor>
                                    </p:column>
                                    <p:column headerText="Acciones" style=" width: 80px" rendered="#{procesoIngresoInvView.mostrarAccObs}">
                                        <center>
                                            <p:commandLink title="Eliminar" id="elim" process="@this" actionListener="#{procesoIngresoInvView.borrarElementoLista(med)}"
                                                           update="dtItemIngreso">
                                                <i class="fa fa-trash" style="font-size: 1.5em; margin-right: 5px; color: red;"></i>
                                                <p:confirm header="Confirmación de eliminación" message="Esta seguro de eliminar el item?" icon="fa fa-exclamation-triangle" />
                                            </p:commandLink>        
                                        </center>
                                    </p:column>
                                </p:dataTable>
                                <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                                    <p:commandButton value="Si" type="button" styleClass="ui-confirmdialog-yes GreenButton" icon="fa fa-check" />
                                    <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no RedButton" icon="fa fa-times" />
                                </p:confirmDialog>
                            </p:outputPanel>
                        </p:fieldset>
                    </div>
                    <center>
                        <p:commandButton value="Continuar Ingreso"
                                         rendered="#{!procesoIngresoInvView.genOrConIngreso}"
                                         icon="fa fa-save"
                                         disabled="#{procesoIngresoInvView.botonCompletartarea}"
                                         id="btnConIng"
                                         process="outPanelMedidaUno"  
                                         actionListener="#{procesoIngresoInvView.guardarAdicional()}" 

                                         style=" width: 170px">
                        </p:commandButton>
                        <p:spacer width="10" />
                        <p:commandButton value="Generar Ingreso"
                                         rendered="#{procesoIngresoInvView.genOrConIngreso}"
                                         icon="fa fa-save"
                                         id="btnGen"
                                         disabled="#{procesoIngresoInvView.botonProcesos eq true ? procesoIngresoInvView.habilitar : 'true'}"
                                         process="outPanelMedidaUno"  
                                         actionListener="#{procesoIngresoInvView.guardar()}" update="btnContinuar,btnNuevoIngreso"
                                         style=" width: 170px">
                        </p:commandButton>
                        <p:spacer width="10" />
                        <p:commandButton value="Continuar y terminar Tarea"
                                         icon="fa fa-check"
                                         id="btnContinuar"
                                         disabled="#{procesoIngresoInvView.botonCompletartarea}"
                                         process="outPanelMedidaUno"  
                                         actionListener="#{procesoIngresoInvView.continuarEstadoProcesos()}" update="btnContinuar,aprob,desprob,btnConIng,btnItem"
                                         style=" width: 170px">
                        </p:commandButton>
                        <p:spacer width="10" />
                        <p:commandButton value="Aprobar" disabled="#{procesoIngresoInvView.botonProcesos}" id="aprob" 
                                         icon="fa fa-arrow-circle-right"  actionListener="#{procesoIngresoInvView.ingresarObservaciones(true)}"  update="frmMain"    style="width: 170px; background: #0081cb;"  
                                         />
                        <p:spacer width="10" />
                        <p:commandButton disabled="#{procesoIngresoInvView.botonProcesos}" value="Rechazar" id="desprob"
                                         icon="ui-icon-clear" styleClass="red-btn"
                                         process="@this" update="frmMain"
                                         actionListener="#{procesoIngresoInvView.ingresarObservaciones(false)}"
                                         style="width: 170px; background:red">
                        </p:commandButton>
                        <p:spacer width="10" />
                    </center>
                </h:form>
            </div>
        </div>
        
        <p:dialog id="dlgObservaciones" widgetVar="dlgObservaciones" width="30%" position="center" draggable="false" header="Observación"
                  modal="true" showEffect="fade" hideEffect="fade" resizable="false" >
            <div class="ui-g-12" >
                <h:form id="frmDlgObser">
                    <p:outputPanel id="panelObsevacion" style="width: 100%;" >
                        <p:panelGrid  columns="1" styleClass="form-group ui-panelgrid-blank" layout="grid" >
                            <h:panelGroup layout="block" style="width: 100%;" class="panelInput" >
                                <p:inputTextarea value="#{procesoIngresoInvView.observaciones}" onkeyup="toUpperCase(this)"
                                                 rows="7" style="border: 1px solid;text-transform: uppercase;width: 100%;border-radius: 5px 5px 5px 5px;"/>
                            </h:panelGroup> 
                        </p:panelGrid>
                        <center>
                            <p:commandButton icon="fa fa-thumbs-o-up" value="Aprobar"  title="Culminar Tarea" process="frmDlgObser" update="frmDlgObser"
                                             actionListener="#{procesoIngresoInvView.aprobacionPrcoeso(1)}" rendered="#{procesoIngresoInvView.botonRechazado}"
                                             style="width: 150px;margin: 10px"  />
                            <p:commandButton icon="fa fa-thumbs-o-down" value="Rechazado"  title="Culminar Tarea" process="frmDlgObser" update="frmDlgObser"
                                             actionListener="#{procesoIngresoInvView.aprobacionPrcoeso(0)}" rendered="#{procesoIngresoInvView.botonAprobaciones}"
                                             style="width: 150px;margin: 10px"  />
                            <p:commandButton icon="fa fa-thumbs-o-remove" value="Cerrar" onclick="PF('dlgObservaciones').hide()"
                                             style="background: red; width: 150px;margin: 10px" />
                        </center> 
                    </p:outputPanel>
                </h:form>  
            </div>
        </p:dialog>

        <p:dialog header="Formulario Datos de Orden de Compra por Catálogo Electrónico"
                  widgetVar="dlgOrdenElectronico"
                  modal="true"
                  resizable="false"
                  showEffect="fade"
                  hideEffect="fade"
                  id="dlgOrdenElectronicos">
            <h:form prependId="false" id="frmOrden">
                <p:growl id="msgs" showDetail="true"/>
                <div class="ui-g">
                    <div class="ui-g-12"> 
                        <p:outputPanel id="outPanelOrden" style="width: 100%">   
                            <p:fieldset legend="DATOS" style="margin-bottom:40px; font-weight: bold" id="datosOrdenCambios">
                                <p:panelGrid columns="2" columnClasses="ui-grid-col-6" layout="grid" styleClass="ui-panelgrid-blank form-group">
                                    <p:panelGrid columns="1" >
                                        <p:outputLabel value="Número de orden" for="numOrden" style="width: 100%;"/>
                                        <p:inputText  id="numOrden" style="text-transform: uppercase" 
                                                      value="#{procesoIngresoInvView.ordenCompra.numeroOrden}" class="panelInput" readonly="false" >
                                        </p:inputText>
                                    </p:panelGrid>

                                    <p:panelGrid  columns="1"  >
                                        <p:outputLabel value="Fecha Emisión" style="width: 100%;"></p:outputLabel>
                                        <p:calendar id="fecOrden" pattern="dd-MM-yyyy" mask="true" required="true" 
                                                    value="#{procesoIngresoInvView.ordenCompra.fechaOrden}"/>
                                    </p:panelGrid>
                                    <p:panelGrid  columns="1"  >
                                        <p:outputLabel value="Fecha Aceptación" style="width: 100%;"></p:outputLabel>
                                        <p:calendar id="fecAcepOrden" pattern="dd-MM-yyyy" mask="true" required="true" 
                                                    value="#{procesoIngresoInvView.ordenCompra.fechaAceptacion}"/>
                                    </p:panelGrid>
                                </p:panelGrid>
                            </p:fieldset>
                            <center>
                                <p:spacer width="10" />
                                <p:commandButton value="Guardar"
                                                 icon="fa fa-save"
                                                 actionListener="#{procesoIngresoInvView.guardarOrdenCatalogoElec()}"
                                                 process="@form" update="frmMain:dtOrden"
                                                 rendered="#{procesoIngresoInvView.nuevo}">
                                </p:commandButton>
                                <p:spacer width="10" />
                                <p:commandButton value="Editar"
                                                 actionListener="#{procesoIngresoInvView.editarOrdenCatalogoElec()}"
                                                 icon="fa fa-edit"
                                                 process="@form" update="frmMain:dtOrden"
                                                 rendered="#{!procesoIngresoInvView.nuevo}">
                                </p:commandButton>
                                <p:spacer width="10" />
                                <p:commandButton value="Cerrar"
                                                 onclick="PF('dlgOrdenElectronico').hide()"
                                                 actionListener="#{procesoIngresoInvView.limpiarVariableOrdenCatalogoElec()}"
                                                 process="@this">

                                </p:commandButton>
                            </center>
                        </p:outputPanel>

                    </div>
                </div>
            </h:form>
        </p:dialog>
        <p:dialog header="#{procesoIngresoInvView.condContrato eq true ? 'Formulario Datos oficio' : 'Formulario Datos oficio De Donación'}"
                  widgetVar="dlgOficio"
                  modal="true"
                  resizable="false"
                  showEffect="fade"
                  hideEffect="fade"    
                  id="dlgOficios">
            <h:form prependId="false" id="frmOficio">
                <p:growl id="msgs1" showDetail="true"/>
                <div class="ui-g">
                    <div class="ui-g-12"> 
                        <p:outputPanel id="outPanelOficio" style="width: 100%">   
                            <p:fieldset legend="DATOS" style="margin-bottom:40px; font-weight: bold" id="datosOficioCambios">
                                <p:panelGrid columns="2" columnClasses="ui-grid-col-6" layout="grid" styleClass="ui-panelgrid-blank form-group">
                                    <p:panelGrid columns="1" >
                                        <p:outputLabel value="#{procesoIngresoInvView.condContrato eq true ? 'Número de oficio':'NUm. Oficio Donación'}" for="numOficio" style="width: 100%;"/>
                                        <p:inputText  id="numOficio" style="text-transform: uppercase" 
                                                      value="#{procesoIngresoInvView.oficio.numeroOficio}" class="panelInput" readonly="false" >
                                        </p:inputText>
                                    </p:panelGrid>

                                    <p:panelGrid  columns="1"  >
                                        <p:outputLabel value="#{procesoIngresoInvView.condContrato eq true ? 'Fecha oficio':'Fecha Oficio Donación'}" style="width: 100%;"></p:outputLabel>
                                        <p:calendar id="fecOficio" pattern="dd-MM-yyyy" mask="true" required="true" 
                                                    value="#{procesoIngresoInvView.oficio.fechaOficio}"/>
                                    </p:panelGrid>
                                </p:panelGrid>
                            </p:fieldset>

                            <p:fieldset legend="PROVEEDOR" style="margin-bottom:40px; font-weight: bold" id="datosProvOficioCambios" rendered="false">
                                <p:panelGrid columns="2" columnClasses="ui-grid-col-6" layout="grid" styleClass="ui-panelgrid-blank form-group">
                                    <p:panelGrid columns="2">
                                        <p:outputLabel value="IDENTIFICACION" style="width: 100%" />
                                        <div class="ui-inputgroup">
                                            <p:inputText id="identifica3" 
                                                         class="panelInput" value="#{procesoIngresoInvView.proveedor.cliente.identificacion}" 
                                                         maxlength="13" style=" width: 120px" required="true"/>  
                                            <p:commandButton 
                                                title="Buscar Proveedor" 
                                                icon="fa fa-search"
                                                id="btnProveedorCambiosOficio"
                                                styleClass="green-button button-group"
                                                actionListener="#{procesoIngresoInvView.buscarProveedor()}"
                                                process="@this, identifica3" update="datosProvOficioCambios">
                                                <p:ajax event="dialogReturn" listener="#{procesoIngresoInvView.selectDatos}" update="identifica3, datoRazon2"/>
                                            </p:commandButton>
                                        </div>
                                    </p:panelGrid>
                                </p:panelGrid>
                                <p:panelGrid columns="2" columnClasses="ui-grid-col-6" layout="grid"  styleClass="ui-panelgrid-blank form-group" id="datoRazon2" >
                                    <p:panelGrid columns="1">
                                        <p:outputLabel value="Razón social" for="razonCambioOficio" style="width: 100%;"/>
                                        <p:inputText  value="#{procesoIngresoInvView.proveedor.cliente.nombre}"
                                                      id="razonCambioOficio" style="text-transform: uppercase" 
                                                      class="panelInput" readonly="true">
                                        </p:inputText>
                                    </p:panelGrid>
                                    <p:panelGrid columns="1">
                                        <p:outputLabel value="Nombre Comercial" for="nombreComCambioOficio" style="width: 100%;"/>
                                        <p:inputText  value="#{procesoIngresoInvView.proveedor.cliente.apellido}"
                                                      id="nombreComCambioOficio" style="text-transform: uppercase" 
                                                      class="panelInput" readonly="true">
                                        </p:inputText>
                                    </p:panelGrid> 
                                </p:panelGrid>

                            </p:fieldset>


                            <center>
                                <p:spacer width="10" />
                                <p:commandButton value="Guardar"
                                                 icon="fa fa-save"
                                                 actionListener="#{procesoIngresoInvView.guardarOficio()}"
                                                 process="@form" update="frmMain"
                                                 rendered="#{procesoIngresoInvView.nuevo}">
                                </p:commandButton>
                                <p:spacer width="10" />
                                <p:commandButton value="Editar"
                                                 actionListener="#{procesoIngresoInvView.editarOficio()}"
                                                 icon="fa fa-edit"
                                                 process="@form" update="frmMain"
                                                 rendered="#{!procesoIngresoInvView.nuevo}">
                                </p:commandButton>
                                <p:spacer width="10" />
                                <p:commandButton value="Cerrar"
                                                 onclick="PF('dlgOficio').hide()"
                                                 actionListener="#{procesoIngresoInvView.limpiarVariableOficio()}"
                                                 process="@this">

                                </p:commandButton>
                            </center>
                        </p:outputPanel>

                    </div>
                </div>
            </h:form>
        </p:dialog>
        <p:dialog header="Formulario Datos de Factura" widgetVar="dlgFactura"   modal="true"   id="dlgFacturas" width="400">
            <h:form prependId="false" id="frmFactura">
                <p:growl id="msgss" showDetail="true"/>
                <div class="ui-g">
                    <div class="ui-g-12"> 
                        <p:outputPanel id="outPanelfactura">   
                            <p:fieldset legend="DATOS" style=" font-weight: bold" id="datosFacturaCambios">
                                <p:panelGrid columns="2" columnClasses="ui-grid-col-6" layout="grid" styleClass="ui-panelgrid-blank form-group">
                                    <h:panelGroup layout="block">
                                        <p:outputLabel value="Número Factura" for="numFacturaCambio"/><br/>
                                        <p:inputMask mask="999-999-999999999" id="numFacturaCambio" placeholder="999-999-999999999" required="true"
                                                     value="#{procesoIngresoInvView.factura.numFactura}"/>
                                    </h:panelGroup>
                                    <h:panelGroup layout="block">
                                        <p:outputLabel value="Fecha Emisión" for="fecFactura"/><br/>
                                        <p:calendar id="fecFactura" required="true" value="#{procesoIngresoInvView.factura.fechaFactura}" 
                                                    locale="es" readonlyInput="true"
                                                    pattern="dd-MM-yyyy"
                                                    maxdate="#{procesoIngresoInvView.factura.fechaCaducidad}" navigator="true">
                                            <p:ajax event="dateSelect" update="fecFacturaCad"/>
                                        </p:calendar>
                                    </h:panelGroup>
                                    <h:panelGroup layout="block">
                                        <p:outputLabel value="Fecha Caducidad"/><br/>
                                        <p:calendar id="fecFacturaCad" required="false" value="#{procesoIngresoInvView.factura.fechaCaducidad}" 
                                                    locale="es" readonlyInput="true"
                                                    pattern="dd-MM-yyyy"
                                                    mindate="#{procesoIngresoInvView.factura.fechaFactura}" navigator="true"/>

                                    </h:panelGroup>
                                    <h:panelGroup layout="block">
                                        <p:outputLabel value="Número Autorización" for="numAut" /><br/>
                                        <p:inputText  id="numAut" style="text-transform: uppercase" 
                                                      value="#{procesoIngresoInvView.factura.numAutorizacion}" class="panelInput">
                                        </p:inputText>
                                    </h:panelGroup>

                                </p:panelGrid>

                                <br/>    <br/>

                                <center>

                                    <p:commandButton value="Guardar" style="width: 100px;"
                                                     icon="fa fa-save"
                                                     actionListener="#{procesoIngresoInvView.guardarFactura()}"
                                                     process="@form" update="frmMain:dtFactura"
                                                     rendered="#{procesoIngresoInvView.nuevo}">
                                    </p:commandButton>
                                    <p:spacer width="10" />
                                    <p:commandButton value="Editar" style="width: 100px;"
                                                     actionListener="#{procesoIngresoInvView.editarFactura()}"
                                                     icon="fa fa-edit"
                                                     process="@form" update="frmMain:dtFactura"
                                                     rendered="#{!procesoIngresoInvView.nuevo}">
                                    </p:commandButton>
                                    <p:spacer width="10" />
                                    <p:commandButton value="Cerrar" icon="fa fa-remove" style="width: 100px;"
                                                     onclick="PF('dlgFactura').hide()" class="red-btn"
                                                     actionListener="#{procesoIngresoInvView.limpiarVariableFactura()}"
                                                     process="@this">

                                    </p:commandButton>
                                </center>
                            </p:fieldset>


                        </p:outputPanel>

                    </div>
                </div>
            </h:form>
        </p:dialog>

        <p:dialog header="DATOS DE ADQUISICIÓN"
                  widgetVar="dlgAdquisiciones"
                  modal="true" width="80%"
                  resizable="false"
                  showEffect="fade"
                  hideEffect="fade"
                  id="dlgAdquisiciones">
            <h:form  id="frmDlgAdquisicion" prependId="false">
                <br/>
                <p:dataTable id="dtAdquisiciones" var="ord" reflow="true"  paginator="true" 
                             rows="10" rowsPerPageTemplate="10" 
                             paginatorPosition="bottom" currentPageReportTemplate="Mostrando {startRecord}-{endRecord} de {totalRecords}"
                             paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                             filterEvent="keyup" value="#{procesoIngresoInvView.listaAdaqui}"
                             emptyMessage="No se encontró ningun orden de compra en el sistema.">
                    <f:facet name="header">
                        LISTA DE ORDEN DE ADQUISICIÓN
                    </f:facet>
                    <p:column headerText="N° Proceso" style="width: 10%;  font-size: 12px;" filterBy="#{ord.idProceso}" filterMatchMode="contains">
                        <h:outputText value="#{ord.idProceso}" />
                    </p:column>
                    <p:column headerText="Tipo de Proceso" style="width: 10%;  font-size: 12px;" >
                        <h:outputText  value="#{ord.tipoProceso}"/>
                    </p:column>
                    <p:column headerText="N° Contrato" style="width: 10%;  font-size: 12px;" filterBy="#{ord.numeroContrato}" filterMatchMode="contains">
                        <h:outputText  value="#{ord.numeroContrato}"/>
                    </p:column>
                    <p:column headerText="Fecha Contrato" style="width: 10%;  font-size: 12px;text-align: center" >
                        <h:outputText  value="#{ord.fechaContrato}">
                            <f:convertDateTime pattern="dd-MM-yyyy"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Monto" style="width: 10%; font-size: 12px;" >
                        <h:outputText  value="#{ord.valorContratado}" style="float: right">
                            <f:convertNumber type="currency" currencySymbol="$" currencyCode="USD" locale="es_EC"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Descripción" style="width: 42%;  font-size: 12px;" >
                        <h:outputText  value="#{ord.descripcion}"/>
                    </p:column>
                    <p:column headerText="Acciones" style="text-align: center; width: 8%">
                        <p:commandLink  title="Seleccionar" actionListener="#{procesoIngresoInvView.closeSelectAdquisicion(ord)}" process="@this">
                            <i class="fa fa-arrow-circle-o-right" style="font-size: 2.5em; color: #00796B;"></i>
                        </p:commandLink>
                    </p:column>
                </p:dataTable>
                <br/>
                <br/>

            </h:form>
        </p:dialog>


    </ui:define>
</ui:composition>
